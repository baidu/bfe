{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"","title":"HOME"},{"location":"SUMMARY/","text":"Summary About Introduction Overview Comparsion to similar systems Design overview Terminology Traffic fowarding model Traffic routing Traffic balancing Getting help Version History Getting Started Install User Guides Traffic forwarding Traffic blocking Request redirect Request rewrite TLS mutual authentication Installation Install from source Install using binaries Install using go Install using snap Configuration Overview Core Protocol SSL/TLS Certificate Session ticket key Routing Host rule Vip rule Route rule Backend Cluster Load Balancing Sub-clusters balancing Instances balancing Name Service Naming Modules mod_access mod_auth_basic mod_auth_jwt mod_block mod_compress mod_doh mod_errors mod_geo mod_header mod_http_code mod_key_log mod_logid mod_prison mod_redirect mod_rewrite mod_static mod_tag mod_trace mod_trust_clientip mod_userid Operations Command line options Environment variables System signals Configuration reload System metrics Log Rotation Traffic tapping Performance How to Contribute Contribute codes Local development Sumbit PR Contribute documents Releasing process Development guides Source code layout BFE module development BFE callback introduction How to write a module FAQ Installation Configuration Performance Development Appendix A: Monitor Protocol SSL/TLS HTTP HTTP2 SPDY WebSocket Stream Routing Host table Load Balancing Balance details Balance error Proxy Proxy state Modules Lentency Lentency histogram Appendix B: Condition Condition Concept and Grammar Condition Naming Convention Condition Primitives Index Request related Condition Primitives Method URI Protocol Header Cookie Tag IP Response related Condition Primitives Code Header Session related Condition Primitives IP System related Condition Primitives Time Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"Summary"},{"location":"SUMMARY/#summary","text":"About Introduction Overview Comparsion to similar systems Design overview Terminology Traffic fowarding model Traffic routing Traffic balancing Getting help Version History Getting Started Install User Guides Traffic forwarding Traffic blocking Request redirect Request rewrite TLS mutual authentication Installation Install from source Install using binaries Install using go Install using snap Configuration Overview Core Protocol SSL/TLS Certificate Session ticket key Routing Host rule Vip rule Route rule Backend Cluster Load Balancing Sub-clusters balancing Instances balancing Name Service Naming Modules mod_access mod_auth_basic mod_auth_jwt mod_block mod_compress mod_doh mod_errors mod_geo mod_header mod_http_code mod_key_log mod_logid mod_prison mod_redirect mod_rewrite mod_static mod_tag mod_trace mod_trust_clientip mod_userid Operations Command line options Environment variables System signals Configuration reload System metrics Log Rotation Traffic tapping Performance How to Contribute Contribute codes Local development Sumbit PR Contribute documents Releasing process Development guides Source code layout BFE module development BFE callback introduction How to write a module FAQ Installation Configuration Performance Development Appendix A: Monitor Protocol SSL/TLS HTTP HTTP2 SPDY WebSocket Stream Routing Host table Load Balancing Balance details Balance error Proxy Proxy state Modules Lentency Lentency histogram Appendix B: Condition Condition Concept and Grammar Condition Naming Convention Condition Primitives Index Request related Condition Primitives Method URI Protocol Header Cookie Tag IP Response related Condition Primitives Code Header Session related Condition Primitives IP System related Condition Primitives Time Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"Summary"},{"location":"condition/condition_grammar/","text":"Condition Grammar Basic Concepts Condition Primitive Basic conditional judgment unit, which defines the primitive of comparison req_host_in(\"www.bfe-networks.com|bfe-networks.com\") Condition Expression Expression using \"and/or/not\" to connect condition primitive req_host_in(\"bfe-networks.com\") && req_method_in(\"GET\") Condition Variable Variable that is defined by Condition Expression bfe_host = req_host_in(\"bfe-networks.com\") Advanced Condition Expression Expression using \"and/or/not\" to connect condition primitive and condition variable In advanced condition expression, condition variable is identified by \"$\" prefix $news_host && req_method_in(\"GET\") Condition Primitive Grammar Basic conditional judgment unit, format is shown as follows: \u200b FuncName( params ) Condition primitive like function definition: FuncName is name of condition primitive; params are input parameters Return value type of Condition Primitive is bool Note: All builtin condition primitives Condition Expression Grammar Condition Expression grammar is defined as follows: Priority and combination rule of \"&&/||/!\" is same as them in C language Expression description Condition Expression(CE) -> CE && CE | CE || CE | ( CE ) | ! CE | Condition Primitive Advanced Condition Expression Grammar Advanced Condition Expression grammar is defined as follows: Priority and combination rule of \"&&/||/!\" is same as them in C language Expression description Advanced Condition Expression(ACE) -> ACE && ACE | ACE || ACE | ( ACE) | ! ACE | Condition Primitive | Condition Variable","title":"Concept and grammar"},{"location":"condition/condition_grammar/#condition-grammar","text":"","title":"Condition Grammar"},{"location":"condition/condition_grammar/#basic-concepts","text":"","title":"Basic Concepts"},{"location":"condition/condition_grammar/#condition-primitive","text":"Basic conditional judgment unit, which defines the primitive of comparison req_host_in(\"www.bfe-networks.com|bfe-networks.com\")","title":"Condition Primitive"},{"location":"condition/condition_grammar/#condition-expression","text":"Expression using \"and/or/not\" to connect condition primitive req_host_in(\"bfe-networks.com\") && req_method_in(\"GET\")","title":"Condition Expression"},{"location":"condition/condition_grammar/#condition-variable","text":"","title":"Condition Variable"},{"location":"condition/condition_grammar/#variable-that-is-defined-by-condition-expression","text":"bfe_host = req_host_in(\"bfe-networks.com\")","title":"Variable that is defined by Condition Expression"},{"location":"condition/condition_grammar/#advanced-condition-expression","text":"Expression using \"and/or/not\" to connect condition primitive and condition variable In advanced condition expression, condition variable is identified by \"$\" prefix $news_host && req_method_in(\"GET\")","title":"Advanced Condition Expression"},{"location":"condition/condition_grammar/#condition-primitive-grammar","text":"Basic conditional judgment unit, format is shown as follows: \u200b FuncName( params ) Condition primitive like function definition: FuncName is name of condition primitive; params are input parameters Return value type of Condition Primitive is bool Note: All builtin condition primitives","title":"Condition Primitive Grammar"},{"location":"condition/condition_grammar/#condition-expression-grammar","text":"Condition Expression grammar is defined as follows: Priority and combination rule of \"&&/||/!\" is same as them in C language Expression description Condition Expression(CE) -> CE && CE | CE || CE | ( CE ) | ! CE | Condition Primitive","title":"Condition Expression Grammar"},{"location":"condition/condition_grammar/#advanced-condition-expression-grammar","text":"Advanced Condition Expression grammar is defined as follows: Priority and combination rule of \"&&/||/!\" is same as them in C language Expression description Advanced Condition Expression(ACE) -> ACE && ACE | ACE || ACE | ( ACE) | ! ACE | Condition Primitive | Condition Variable","title":"Advanced Condition Expression Grammar"},{"location":"condition/condition_naming_convention/","text":"Condition Naming Convention Name prefix of condition primitive: Name prefix of request related primitive is \" req_ \" e.g. req_host_in() Name prefix of response related primitive is \" res_ \" e.g. res_code_in() Name prefix of session related primitive is \" ses_ \" e.g. ses_vip_in() Name prefix of system related primitive is \" bfe_ \" e.g. bfe_time_range () Name of compare actions: match \uff1aexact match In this situation, the only one parameter is given eg. req_tag_match() in \uff1aif the value is in the configured set eg. req_host_in() prefix_in \uff1aif the value prefix is in the configured set eg. req_path_prefix_in() suffix_in \uff1aif the value suffix is in the configured set eg. req_path_suffix_in() key_exist \uff1aif the key exists eg. req_query_key_exist() value_in \uff1afor the configured key, judge if the value is in the configured value set eg. req_query_key_exist() value_prefix_in \uff1afor the configured key, judge if the value prefix is in the configured set eg. req_header_value_prefix_in() value_suffix_in \uff1afor the configured key, judge if the value suffix is in the configured set eg. req_header_value_suffix_in() range : range match eg. req_cip_range() regmatch \uff1aregular match eg. req_url_regmatch() contain : string match eg. req_cookie_value_contain()","title":"Naming convention"},{"location":"condition/condition_naming_convention/#condition-naming-convention","text":"","title":"Condition Naming Convention"},{"location":"condition/condition_naming_convention/#name-prefix-of-condition-primitive","text":"Name prefix of request related primitive is \" req_ \" e.g. req_host_in() Name prefix of response related primitive is \" res_ \" e.g. res_code_in() Name prefix of session related primitive is \" ses_ \" e.g. ses_vip_in() Name prefix of system related primitive is \" bfe_ \" e.g. bfe_time_range ()","title":"Name prefix of condition primitive:"},{"location":"condition/condition_naming_convention/#name-of-compare-actions","text":"match \uff1aexact match In this situation, the only one parameter is given eg. req_tag_match() in \uff1aif the value is in the configured set eg. req_host_in() prefix_in \uff1aif the value prefix is in the configured set eg. req_path_prefix_in() suffix_in \uff1aif the value suffix is in the configured set eg. req_path_suffix_in() key_exist \uff1aif the key exists eg. req_query_key_exist() value_in \uff1afor the configured key, judge if the value is in the configured value set eg. req_query_key_exist() value_prefix_in \uff1afor the configured key, judge if the value prefix is in the configured set eg. req_header_value_prefix_in() value_suffix_in \uff1afor the configured key, judge if the value suffix is in the configured set eg. req_header_value_suffix_in() range : range match eg. req_cip_range() regmatch \uff1aregular match eg. req_url_regmatch() contain : string match eg. req_cookie_value_contain()","title":"Name of compare actions:"},{"location":"condition/condition_primitive_index/","text":"Condition Primitive Index Request Primitive req_cip_hash_in(value_list) req_cip_range(start_ip, end_ip) req_cip_trusted() req_cookie_key_in(key_list) req_cookie_value_contain(key, value, case_insensitive) req_cookie_value_in(key, value_list, case_insensitive) req_cookie_value_hash_in(key, value_list, case_insensitive) req_cookie_value_prefix_in(key, value_prefix_list, case_insensitive) req_cookie_value_suffix_in(key, value_suffix_list, case_insensitive) req_header_key_in(key_list) req_header_value_contain(key, value_list, case_insensitive) req_header_value_in(header_name, value_list, case_insensitive) req_header_value_hash_in(header_name, value_list, case_insensitive) req_header_value_prefix_in(header_name, value_prefix_list, case_insensitive) req_header_value_suffix_in(header_name, value_suffix_list, case_insensitive) req_host_in(host_list) req_method_in(method_list) req_proto_secure() req_tag_match(tagName, tagValue) req_path_in(path_list, case_insensitive) req_path_prefix_in(prefix_list, case_insensitive) req_path_suffix_in(suffix_list, case_insensitive) req_query_key_in(key_list) req_query_key_prefix_in(prefix_list) req_query_value_in(key, value_list, case_insensitive) req_query_value_hash_in(key, value_list, case_insensitive) req_query_value_prefix_in(key, prefix_list, case_insensitive) req_query_value_suffix_in(key, suffix_list, case_insensitive) req_port_in(port_list) req_url_regmatch(reg_exp) req_vip_in(vip_list) req_vip_range(start_ip, end_ip) Response Primitive res_code_in(codes) res_header_key_in(key_list) res_header_value_in(key, value_list, case_insensitive) Session Primitive ses_sip_range(start_ip, end_ip) ses_vip_range(start_ip, end_ip) ses_tls_sni_in(host_list) ses_tls_client_auth() ses_tls_client_ca_in(ca_list) System Primitive bfe_time_range(start_time, end_time)","title":"Primitives index"},{"location":"condition/condition_primitive_index/#condition-primitive-index","text":"","title":"Condition Primitive Index"},{"location":"condition/condition_primitive_index/#request-primitive","text":"req_cip_hash_in(value_list) req_cip_range(start_ip, end_ip) req_cip_trusted() req_cookie_key_in(key_list) req_cookie_value_contain(key, value, case_insensitive) req_cookie_value_in(key, value_list, case_insensitive) req_cookie_value_hash_in(key, value_list, case_insensitive) req_cookie_value_prefix_in(key, value_prefix_list, case_insensitive) req_cookie_value_suffix_in(key, value_suffix_list, case_insensitive) req_header_key_in(key_list) req_header_value_contain(key, value_list, case_insensitive) req_header_value_in(header_name, value_list, case_insensitive) req_header_value_hash_in(header_name, value_list, case_insensitive) req_header_value_prefix_in(header_name, value_prefix_list, case_insensitive) req_header_value_suffix_in(header_name, value_suffix_list, case_insensitive) req_host_in(host_list) req_method_in(method_list) req_proto_secure() req_tag_match(tagName, tagValue) req_path_in(path_list, case_insensitive) req_path_prefix_in(prefix_list, case_insensitive) req_path_suffix_in(suffix_list, case_insensitive) req_query_key_in(key_list) req_query_key_prefix_in(prefix_list) req_query_value_in(key, value_list, case_insensitive) req_query_value_hash_in(key, value_list, case_insensitive) req_query_value_prefix_in(key, prefix_list, case_insensitive) req_query_value_suffix_in(key, suffix_list, case_insensitive) req_port_in(port_list) req_url_regmatch(reg_exp) req_vip_in(vip_list) req_vip_range(start_ip, end_ip)","title":"Request Primitive"},{"location":"condition/condition_primitive_index/#response-primitive","text":"res_code_in(codes) res_header_key_in(key_list) res_header_value_in(key, value_list, case_insensitive)","title":"Response Primitive"},{"location":"condition/condition_primitive_index/#session-primitive","text":"ses_sip_range(start_ip, end_ip) ses_vip_range(start_ip, end_ip) ses_tls_sni_in(host_list) ses_tls_client_auth() ses_tls_client_ca_in(ca_list)","title":"Session Primitive"},{"location":"condition/condition_primitive_index/#system-primitive","text":"bfe_time_range(start_time, end_time)","title":"System Primitive"},{"location":"condition/request/cookie/","text":"Request Cookie Related Primitives req_cookie_key_in(key_list) Description: Judge if cookie key matches configured patterns Parameters Parameter Descrption key_list String a list of cookie keys which are concatenated using | Example req_cookie_key_in(\"uid|cid|uss\") req_cookie_value_in(key, value_list, case_insensitive) Description: Judge if value of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_in(\"deviceid\", \"testid\", true) req_cookie_value_prefix_in(key, value_prefix_list, case_insensitive) Description: Judge if value prefix of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_prefix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_prefix_in(\"deviceid\", \"x\", true) req_cookie_value_suffix_in(key, value_suffix_list, case_insensitive) Description: Judge if value suffix of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_suffix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_suffix_in(\"deviceid\", \"1\", true) req_cookie_value_hash_in(key, value_list, case_insensitive) Description: Judge if hash value of specified cookie matches configured patterns(value range: 0\uff5e9999) Parameters Parameter Descrption key String cookie key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_hash_in(\"uid\", \"100\", true) req_cookie_value_contain(key, value, case_insensitive) Description: Judge if value of cookie key contains configured patterns Parameters Parameter Descrption key String cookie key value String a string case_insensitive Boolean case insensitive Example req_cookie_value_contain(\"deviceid\", \"test\", true)","title":"Cookie"},{"location":"condition/request/cookie/#request-cookie-related-primitives","text":"","title":"Request Cookie Related Primitives"},{"location":"condition/request/cookie/#req_cookie_key_inkey_list","text":"Description: Judge if cookie key matches configured patterns Parameters Parameter Descrption key_list String a list of cookie keys which are concatenated using | Example req_cookie_key_in(\"uid|cid|uss\")","title":"req_cookie_key_in(key_list)"},{"location":"condition/request/cookie/#req_cookie_value_inkey-value_list-case_insensitive","text":"Description: Judge if value of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_in(\"deviceid\", \"testid\", true)","title":"req_cookie_value_in(key, value_list, case_insensitive)"},{"location":"condition/request/cookie/#req_cookie_value_prefix_inkey-value_prefix_list-case_insensitive","text":"Description: Judge if value prefix of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_prefix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_prefix_in(\"deviceid\", \"x\", true)","title":"req_cookie_value_prefix_in(key, value_prefix_list, case_insensitive)"},{"location":"condition/request/cookie/#req_cookie_value_suffix_inkey-value_suffix_list-case_insensitive","text":"Description: Judge if value suffix of cookie key matches configured patterns Parameters Parameter Descrption key String cookie key value_suffix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_suffix_in(\"deviceid\", \"1\", true)","title":"req_cookie_value_suffix_in(key, value_suffix_list, case_insensitive)"},{"location":"condition/request/cookie/#req_cookie_value_hash_inkey-value_list-case_insensitive","text":"Description: Judge if hash value of specified cookie matches configured patterns(value range: 0\uff5e9999) Parameters Parameter Descrption key String cookie key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_cookie_value_hash_in(\"uid\", \"100\", true)","title":"req_cookie_value_hash_in(key, value_list, case_insensitive)"},{"location":"condition/request/cookie/#req_cookie_value_containkey-value-case_insensitive","text":"Description: Judge if value of cookie key contains configured patterns Parameters Parameter Descrption key String cookie key value String a string case_insensitive Boolean case insensitive Example req_cookie_value_contain(\"deviceid\", \"test\", true)","title":"req_cookie_value_contain(key, value, case_insensitive)"},{"location":"condition/request/header/","text":"Request Header Related Primitives req_header_key_in(key_list) Description: Judge if header key in matches configured patterns Note: each word in header key need to be capitalized Parameters Parameter Descrption key_list String a list of header keys which are concatenated using | Example # right \uff1a req_header_key_in ( \"Header-Test\" ) # wrong \uff1a req_header_key_in ( \"Header-test\" ) req_header_key_in ( \"header-test\" ) req_header_key_in ( \"header-Test\" ) req_header_value_in(header_name, value_list, case_insensitive) Description: Judge if value of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_list String a list of header values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_in(\"Referer\", \"https://example.org/login\", true) req_header_value_prefix_in(header_name, value_prefix_list, case_insensitive) Description: Judge if value prefix of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_prefix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_prefix_value_in(\"Referer\", \"https://example.org\", true) req_header_value_suffix_in(header_name, value_suffix_list, case_insensitive) Description: Judge if value suffix of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_suffix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_suffix_value_in(\"User-Agent\", \"2.0.4\", true) req_header_value_hash_in(header_name, value_list, case_insensitive) Description: Judge if hash value of specified header matches configured patterns (value range: 0\uff5e9999) Parameters Parameter Descrption header_name String header name value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_hash_in(\"X-Device-Id\", \"100-200|400\", true) req_header_value_contain(header_name, value_list, case_insensitive) Description: Judge if value of key in header contains configured patterns Parameters Parameter Descrption header_name String header name value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_contain(\"User-Agent\", \"Firefox|Chrome\", true)","title":"Header"},{"location":"condition/request/header/#request-header-related-primitives","text":"","title":"Request Header Related Primitives"},{"location":"condition/request/header/#req_header_key_inkey_list","text":"Description: Judge if header key in matches configured patterns Note: each word in header key need to be capitalized Parameters Parameter Descrption key_list String a list of header keys which are concatenated using | Example # right \uff1a req_header_key_in ( \"Header-Test\" ) # wrong \uff1a req_header_key_in ( \"Header-test\" ) req_header_key_in ( \"header-test\" ) req_header_key_in ( \"header-Test\" )","title":"req_header_key_in(key_list)"},{"location":"condition/request/header/#req_header_value_inheader_name-value_list-case_insensitive","text":"Description: Judge if value of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_list String a list of header values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_in(\"Referer\", \"https://example.org/login\", true)","title":"req_header_value_in(header_name, value_list, case_insensitive)"},{"location":"condition/request/header/#req_header_value_prefix_inheader_name-value_prefix_list-case_insensitive","text":"Description: Judge if value prefix of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_prefix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_prefix_value_in(\"Referer\", \"https://example.org\", true)","title":"req_header_value_prefix_in(header_name, value_prefix_list, case_insensitive)"},{"location":"condition/request/header/#req_header_value_suffix_inheader_name-value_suffix_list-case_insensitive","text":"Description: Judge if value suffix of key in header matches configured patterns Parameters Parameter Descrption header_name String header name value_suffix_list String a list of values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_suffix_value_in(\"User-Agent\", \"2.0.4\", true)","title":"req_header_value_suffix_in(header_name, value_suffix_list, case_insensitive)"},{"location":"condition/request/header/#req_header_value_hash_inheader_name-value_list-case_insensitive","text":"Description: Judge if hash value of specified header matches configured patterns (value range: 0\uff5e9999) Parameters Parameter Descrption header_name String header name value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_hash_in(\"X-Device-Id\", \"100-200|400\", true)","title":"req_header_value_hash_in(header_name, value_list, case_insensitive)"},{"location":"condition/request/header/#req_header_value_containheader_name-value_list-case_insensitive","text":"Description: Judge if value of key in header contains configured patterns Parameters Parameter Descrption header_name String header name value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_header_value_contain(\"User-Agent\", \"Firefox|Chrome\", true)","title":"req_header_value_contain(header_name, value_list, case_insensitive)"},{"location":"condition/request/ip/","text":"IP Related Primitives req_cip_range(start_ip, end_ip) Description: Judge if client IP is in [start_ip, end_ip] Parameters Parameter Descrption start_ip String start ip address end_ip String end ip address Example req_cip_range(\"10.0.0.1\", \"10.0.0.10\") req_cip_trusted() Description: Judge if client IP is trust IP req_cip_hash_in(value_list) Description: Judge if client IP after hash matches configured patterns (value after hash is 0\uff5e9999) Parameters Parameter Descrption value_list String a list of hash values which are concatenated using | Example req_cip_hash_in(\"100\") req_cip_hash_in(\"100-200\") req_cip_hash_in(\"100-200|1000-1000\") req_vip_in(vip_list) Description: Judge if VIP is in configured VIP list Parameters Parameter Descrption vip_list String a list of vips which are concatenated using | Example req_vip_in(\"10.0.0.1|10.0.0.2\") req_vip_range(start_ip, end_ip) Description: Judge if VIP is in [start_ip, end_ip] Parameters Parameter Descrption start_ip String start ip address end_ip String end ip address Example req_vip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"IP"},{"location":"condition/request/ip/#ip-related-primitives","text":"","title":"IP Related Primitives"},{"location":"condition/request/ip/#req_cip_rangestart_ip-end_ip","text":"Description: Judge if client IP is in [start_ip, end_ip] Parameters Parameter Descrption start_ip String start ip address end_ip String end ip address Example req_cip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"req_cip_range(start_ip, end_ip)"},{"location":"condition/request/ip/#req_cip_trusted","text":"Description: Judge if client IP is trust IP","title":"req_cip_trusted()"},{"location":"condition/request/ip/#req_cip_hash_invalue_list","text":"Description: Judge if client IP after hash matches configured patterns (value after hash is 0\uff5e9999) Parameters Parameter Descrption value_list String a list of hash values which are concatenated using | Example req_cip_hash_in(\"100\") req_cip_hash_in(\"100-200\") req_cip_hash_in(\"100-200|1000-1000\")","title":"req_cip_hash_in(value_list)"},{"location":"condition/request/ip/#req_vip_invip_list","text":"Description: Judge if VIP is in configured VIP list Parameters Parameter Descrption vip_list String a list of vips which are concatenated using | Example req_vip_in(\"10.0.0.1|10.0.0.2\")","title":"req_vip_in(vip_list)"},{"location":"condition/request/ip/#req_vip_rangestart_ip-end_ip","text":"Description: Judge if VIP is in [start_ip, end_ip] Parameters Parameter Descrption start_ip String start ip address end_ip String end ip address Example req_vip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"req_vip_range(start_ip, end_ip)"},{"location":"condition/request/method/","text":"Request Method Related Primitives req_method_in(method_list) Descrption: Judge if request method matches configured patterns Parameters Parameter Description method_list String a list of methods which are concatenated by |. valid method:GET/POST/PUT/DELETE Example req_method_in(\"GET|POST\")","title":"Method"},{"location":"condition/request/method/#request-method-related-primitives","text":"","title":"Request Method Related Primitives"},{"location":"condition/request/method/#req_method_inmethod_list","text":"Descrption: Judge if request method matches configured patterns Parameters Parameter Description method_list String a list of methods which are concatenated by |. valid method:GET/POST/PUT/DELETE Example req_method_in(\"GET|POST\")","title":"req_method_in(method_list)"},{"location":"condition/request/protocol/","text":"Protocol Related Primitives req_proto_secure() Description: Judge if request is over TLS protocol(ie. HTTPS/SPDY/HTTP2)","title":"Protocol"},{"location":"condition/request/protocol/#protocol-related-primitives","text":"","title":"Protocol Related Primitives"},{"location":"condition/request/protocol/#req_proto_secure","text":"Description: Judge if request is over TLS protocol(ie. HTTPS/SPDY/HTTP2)","title":"req_proto_secure()"},{"location":"condition/request/tag/","text":"Request Tag Related Primtives req_tag_match(tagName, tagValue) Description: Judge if request tag matches configured value Parameters Parameter Description tagName String tag name tagValue String tag value Example req_tag_match(\"clientIP\", \"blacklist\")","title":"Tag"},{"location":"condition/request/tag/#request-tag-related-primtives","text":"","title":"Request Tag Related Primtives"},{"location":"condition/request/tag/#req_tag_matchtagname-tagvalue","text":"Description: Judge if request tag matches configured value Parameters Parameter Description tagName String tag name tagValue String tag value Example req_tag_match(\"clientIP\", \"blacklist\")","title":"req_tag_match(tagName, tagValue)"},{"location":"condition/request/uri/","text":"Request URI Related Primitives URI format\uff1ahttp://host[:port]/path/?query req_host_in(host_list) Description: Judge if host matches configured patterns Parameters Parameter Descrption host_list String a list of hosts keys which are concatenated using | case insensitive Example # right \uff1a req_host_in ( \"www.bfe-networks.com|bfe-networks.com\" ) # wrong \uff1a req_host_in ( \"www.bfe-networks.com | bfe-networks.com\" ) req_path_in(path_list, case_insensitive) Description: Judge if request path matches configured patterns Parameters Parameter Descrption path_list String a list of paths which are concatenated using | case_insensitive Boolean case insensitive Example req_path_in(\"/api/search|/api/list\", true) req_path_prefix_in(prefix_list, case_insensitive) Description: Judge if request path prefix matches configured patterns Parameters Parameter Descrption prefix_list String a list of path prefixs which are concatenated using | case_insensitive Boolean case insensitive Example req_path_prefix_in(\"/api/report|/api/analytics\", false) req_path_suffix_in(suffix_list, case_insensitive) Description: Judge if request path suffix matches configured patterns Parameters Parameter Descrption suffix_list String a list of path sufixs which are concatenated using | case_insensitive Boolean case insensitive Example req_path_suffix_in(\".php|.jsp\", false) Note: The patterns of req_path_in and req_path_prefix_in need to be included \"/\" req_query_key_in(key_list) Description: Judge if query key matches configured patterns Parameters Parameter Descrption key_list String a list of query keys which are concatenated using | Example req_query_key_exist(\"word|wd\") req_query_key_prefix_in(prefix_list) Description: Judge if query key prefix matches configured patterns Parameters Parameter Descrption prefix_list String a list of query key prefixs which are concatenated using | Example req_query_key_prefix_in(\"rid\") req_query_value_in(key, value_list, case_insensitive) Description: Judge if value of query key matches configured patterns Parameters Parameter Descrption key String query key value_list String a list of query values which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_in(\"uid\", \"x|y|z\", true) req_query_value_prefix_in(key, prefix_list, case_insensitive) Description: Judge if value prefix of query key matches configured patterns Parameters Parameter Descrption key String query key value_list String a list of query value prefixs which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_prefix_in(\"uid\", \"100|200\", true) req_query_value_suffix_in(key, suffix_list, case_insensitive) Description: Judge if value suffix of query key matches configured patterns Parameters Parameter Descrption key String query key suffix_list String a list of query value suffixs which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_suffix_in(\"uid\", \"1|2|3\", true) req_query_value_hash_in(key, value_list, case_insensitive) Descrption: Judge if the hash value of specified query matches configured patterns (value after hash is 0\uff5e9999) Parameters Parameter Descrption key String query key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_hash_in(\"cid\", \"100\", true) req_port_in(port_list) Description: Judge if port matches configured patterns Parameters Parameter Descrption port_list String a list of ports which are concatenated using | Example req_port_in(\"80|8080\") req_url_regmatch(reg_exp) Description: patterns is regular expression to match url Parameters Parameter Descrption reg_exp String a regular expression It is recommended that use `` to avoid from character escaping Example req_url_regmatch(`/s\\?word=123`)","title":"URI"},{"location":"condition/request/uri/#request-uri-related-primitives","text":"URI format\uff1ahttp://host[:port]/path/?query","title":"Request URI Related Primitives"},{"location":"condition/request/uri/#req_host_inhost_list","text":"Description: Judge if host matches configured patterns Parameters Parameter Descrption host_list String a list of hosts keys which are concatenated using | case insensitive Example # right \uff1a req_host_in ( \"www.bfe-networks.com|bfe-networks.com\" ) # wrong \uff1a req_host_in ( \"www.bfe-networks.com | bfe-networks.com\" )","title":"req_host_in(host_list)"},{"location":"condition/request/uri/#req_path_inpath_list-case_insensitive","text":"Description: Judge if request path matches configured patterns Parameters Parameter Descrption path_list String a list of paths which are concatenated using | case_insensitive Boolean case insensitive Example req_path_in(\"/api/search|/api/list\", true)","title":"req_path_in(path_list, case_insensitive)"},{"location":"condition/request/uri/#req_path_prefix_inprefix_list-case_insensitive","text":"Description: Judge if request path prefix matches configured patterns Parameters Parameter Descrption prefix_list String a list of path prefixs which are concatenated using | case_insensitive Boolean case insensitive Example req_path_prefix_in(\"/api/report|/api/analytics\", false)","title":"req_path_prefix_in(prefix_list, case_insensitive)"},{"location":"condition/request/uri/#req_path_suffix_insuffix_list-case_insensitive","text":"Description: Judge if request path suffix matches configured patterns Parameters Parameter Descrption suffix_list String a list of path sufixs which are concatenated using | case_insensitive Boolean case insensitive Example req_path_suffix_in(\".php|.jsp\", false) Note: The patterns of req_path_in and req_path_prefix_in need to be included \"/\"","title":"req_path_suffix_in(suffix_list, case_insensitive)"},{"location":"condition/request/uri/#req_query_key_inkey_list","text":"Description: Judge if query key matches configured patterns Parameters Parameter Descrption key_list String a list of query keys which are concatenated using | Example req_query_key_exist(\"word|wd\")","title":"req_query_key_in(key_list)"},{"location":"condition/request/uri/#req_query_key_prefix_inprefix_list","text":"Description: Judge if query key prefix matches configured patterns Parameters Parameter Descrption prefix_list String a list of query key prefixs which are concatenated using | Example req_query_key_prefix_in(\"rid\")","title":"req_query_key_prefix_in(prefix_list)"},{"location":"condition/request/uri/#req_query_value_inkey-value_list-case_insensitive","text":"Description: Judge if value of query key matches configured patterns Parameters Parameter Descrption key String query key value_list String a list of query values which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_in(\"uid\", \"x|y|z\", true)","title":"req_query_value_in(key, value_list, case_insensitive)"},{"location":"condition/request/uri/#req_query_value_prefix_inkey-prefix_list-case_insensitive","text":"Description: Judge if value prefix of query key matches configured patterns Parameters Parameter Descrption key String query key value_list String a list of query value prefixs which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_prefix_in(\"uid\", \"100|200\", true)","title":"req_query_value_prefix_in(key, prefix_list, case_insensitive)"},{"location":"condition/request/uri/#req_query_value_suffix_inkey-suffix_list-case_insensitive","text":"Description: Judge if value suffix of query key matches configured patterns Parameters Parameter Descrption key String query key suffix_list String a list of query value suffixs which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_suffix_in(\"uid\", \"1|2|3\", true)","title":"req_query_value_suffix_in(key, suffix_list, case_insensitive)"},{"location":"condition/request/uri/#req_query_value_hash_inkey-value_list-case_insensitive","text":"Descrption: Judge if the hash value of specified query matches configured patterns (value after hash is 0\uff5e9999) Parameters Parameter Descrption key String query key value_list String a list of hash values which are concatenated using | case_insensitive Boolean case insensitive Example req_query_value_hash_in(\"cid\", \"100\", true)","title":"req_query_value_hash_in(key, value_list, case_insensitive)"},{"location":"condition/request/uri/#req_port_inport_list","text":"Description: Judge if port matches configured patterns Parameters Parameter Descrption port_list String a list of ports which are concatenated using | Example req_port_in(\"80|8080\")","title":"req_port_in(port_list)"},{"location":"condition/request/uri/#req_url_regmatchreg_exp","text":"Description: patterns is regular expression to match url Parameters Parameter Descrption reg_exp String a regular expression It is recommended that use `` to avoid from character escaping Example req_url_regmatch(`/s\\?word=123`)","title":"req_url_regmatch(reg_exp)"},{"location":"condition/response/code/","text":"Response code related primitives res_code_in(codes) Description: Judge response HTTP status code is in configured codes Parameters Parameter Descrption codes String a list of codes which are concatenated using | Example res_code_in(\"200|500\")","title":"Code"},{"location":"condition/response/code/#response-code-related-primitives","text":"","title":"Response code related primitives"},{"location":"condition/response/code/#res_code_incodes","text":"Description: Judge response HTTP status code is in configured codes Parameters Parameter Descrption codes String a list of codes which are concatenated using | Example res_code_in(\"200|500\")","title":"res_code_in(codes)"},{"location":"condition/response/header/","text":"Response header related primitives res_header_key_in(key_list) Descrption: Judge if key in Header of response matches configured key_list Parameters Parameter Descrption key_list String a list of header keys which are concatenated using | Example res_header_key_in(\"X-Bfe-Debug\") res_header_value_in(key, value_list, case_insensitive) Descrption: Judge if value of key in response header matches configured patterns Parameters Parameter Descrption key String header name value_list String a list of header values which are concatenated using | case_insensitive Boolean case insensitive Example res_header_value_in(\"X-Bfe-Debug\", \"1\", true)","title":"Header"},{"location":"condition/response/header/#response-header-related-primitives","text":"","title":"Response header related primitives"},{"location":"condition/response/header/#res_header_key_inkey_list","text":"Descrption: Judge if key in Header of response matches configured key_list Parameters Parameter Descrption key_list String a list of header keys which are concatenated using | Example res_header_key_in(\"X-Bfe-Debug\")","title":"res_header_key_in(key_list)"},{"location":"condition/response/header/#res_header_value_inkey-value_list-case_insensitive","text":"Descrption: Judge if value of key in response header matches configured patterns Parameters Parameter Descrption key String header name value_list String a list of header values which are concatenated using | case_insensitive Boolean case insensitive Example res_header_value_in(\"X-Bfe-Debug\", \"1\", true)","title":"res_header_value_in(key, value_list, case_insensitive)"},{"location":"condition/session/ip/","text":"Session IP related primitives ses_sip_range(start_ip, end_ip) Descrption: Judge if srouce IP of session is in [start_ip, end_ip] Parameter Parameter Descrption start_ip String start ip address end_ip String end ip address Example ses_sip_range(\"10.0.0.1\", \"10.0.0.10\") ses_vip_range(start_ip, end_ip) Descrption: Judge if VIP of session is in [start_ip, end_ip] Parameter Parameter Descrption start_ip String start ip address end_ip String end ip address Example ses_vip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"IP"},{"location":"condition/session/ip/#session-ip-related-primitives","text":"","title":"Session IP related primitives"},{"location":"condition/session/ip/#ses_sip_rangestart_ip-end_ip","text":"Descrption: Judge if srouce IP of session is in [start_ip, end_ip] Parameter Parameter Descrption start_ip String start ip address end_ip String end ip address Example ses_sip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"ses_sip_range(start_ip, end_ip)"},{"location":"condition/session/ip/#ses_vip_rangestart_ip-end_ip","text":"Descrption: Judge if VIP of session is in [start_ip, end_ip] Parameter Parameter Descrption start_ip String start ip address end_ip String end ip address Example ses_vip_range(\"10.0.0.1\", \"10.0.0.10\")","title":"ses_vip_range(start_ip, end_ip)"},{"location":"condition/session/tls/","text":"TLS related primtives ses_tls_sni_in(host_list) Description: Check whether tls sni matches host_list Parameters Parameter Description host_list String a list of hosts which are concatenated using | Example ses_tls_sni_in(\"example.com|example.org\") ses_tls_client_auth() Description: Check whether tls mutual authentication is enabled ses_tls_client_ca_in(ca_list) Description: Check whether tls mutual authentication is enabled and client ca matches ca_list Parameters Parameter Description ca_list String a list of ca names which are concatenated using | Example ses_tls_client_ca_in(\"ca1|ca2\")","title":"TLS"},{"location":"condition/session/tls/#tls-related-primtives","text":"","title":"TLS related primtives"},{"location":"condition/session/tls/#ses_tls_sni_inhost_list","text":"Description: Check whether tls sni matches host_list Parameters Parameter Description host_list String a list of hosts which are concatenated using | Example ses_tls_sni_in(\"example.com|example.org\")","title":"ses_tls_sni_in(host_list)"},{"location":"condition/session/tls/#ses_tls_client_auth","text":"Description: Check whether tls mutual authentication is enabled","title":"ses_tls_client_auth()"},{"location":"condition/session/tls/#ses_tls_client_ca_inca_list","text":"Description: Check whether tls mutual authentication is enabled and client ca matches ca_list Parameters Parameter Description ca_list String a list of ca names which are concatenated using | Example ses_tls_client_ca_in(\"ca1|ca2\")","title":"ses_tls_client_ca_in(ca_list)"},{"location":"condition/system/time/","text":"Time related primitves bfe_time_range(start_time, end_time) Descrption: Judge if current time is in [start_time, end_time] Parameters Parameter Descrption start_time String start time end_time String end time Time format\uff1ayyyymmddhhmmssZ\uff0cZ is time zone\uff0cdetail information is shown in Section \"Time Zone Detail\" Example bfe_time_range(\"20190204203000H\", \"20190204204500H\") Appendix A: Condition Primitive Test In order to test time condition primitive, X-Bfe-Debug-Time can be added in header of request to mock system time Appendix B: Time Zone Detail Time zone name Letter Offset Description Alfa Time Zone A +1 Bravo Time Zone B +2 Charlie Time Zone C +3 Delta Time Zone D +4 Echo Time Zone E +5 Foxtrot Time Zone F +6 Golf Time Zone G +7 Hotel Time Zone H +8 Beijing Time India Time Zone I +9 Kilo Time Zone K +10 Lima Time Zone L +11 Mike Time Zone M +12 November Time Zone N \u22121 Oscar Time Zone O \u22122 Papa Time Zone P \u22123 Quebec Time Zone Q \u22124 Romeo Time Zone R \u22125 Sierra Time Zone S \u22126 Tango Time Zone T \u22127 Uniform Time Zone U \u22128 Victor Time Zone V \u22129 Whiskey Time Zone W \u221210 X-ray Time Zone X \u221211 Yankee Time Zone Y \u221212 Zulu Time Zone Z 0 Greenwich Mean Time","title":"Time"},{"location":"condition/system/time/#time-related-primitves","text":"","title":"Time related primitves"},{"location":"condition/system/time/#bfe_time_rangestart_time-end_time","text":"Descrption: Judge if current time is in [start_time, end_time] Parameters Parameter Descrption start_time String start time end_time String end time Time format\uff1ayyyymmddhhmmssZ\uff0cZ is time zone\uff0cdetail information is shown in Section \"Time Zone Detail\" Example bfe_time_range(\"20190204203000H\", \"20190204204500H\")","title":"bfe_time_range(start_time, end_time)"},{"location":"condition/system/time/#appendix-a-condition-primitive-test","text":"In order to test time condition primitive, X-Bfe-Debug-Time can be added in header of request to mock system time","title":"Appendix A: Condition Primitive Test"},{"location":"condition/system/time/#appendix-b-time-zone-detail","text":"Time zone name Letter Offset Description Alfa Time Zone A +1 Bravo Time Zone B +2 Charlie Time Zone C +3 Delta Time Zone D +4 Echo Time Zone E +5 Foxtrot Time Zone F +6 Golf Time Zone G +7 Hotel Time Zone H +8 Beijing Time India Time Zone I +9 Kilo Time Zone K +10 Lima Time Zone L +11 Mike Time Zone M +12 November Time Zone N \u22121 Oscar Time Zone O \u22122 Papa Time Zone P \u22123 Quebec Time Zone Q \u22124 Romeo Time Zone R \u22125 Sierra Time Zone S \u22126 Tango Time Zone T \u22127 Uniform Time Zone U \u22128 Victor Time Zone V \u22129 Whiskey Time Zone W \u221210 X-ray Time Zone X \u221211 Yankee Time Zone Y \u221212 Zulu Time Zone Z 0 Greenwich Mean Time","title":"Appendix B: Time Zone Detail"},{"location":"configuration/bfe.conf/","text":"Core Configuration Introduction bfe.conf is the core configuration file of BFE. Configuration Server basic config Config Item Description Basic.HttpPort Integer Listen port for HTTP Default 8080 Basic.HttpsPort Integer Listen port for HTTPS Default 8443 Basic.MonitorPort Integer Listen port for monitor Default 8421 Basic.MaxCpus Integer Max number of CPUs to use (0 to use all CPUs) Default 0 Basic.Layer4LoadBalancer String Type of layer-4 load balancer (PROXY/NONE) Default NONE Basic.TlsHandshakeTimeout Integer TLS handshake timeout, in seconds Default 30 Basic.ClientReadTimeout Integer Read timeout of communicating with http client, in seconds Default 60 Basic.ClientWriteTimeout Integer Write timeout of communicating with http client, in seconds Default 60 Basic.KeepAliveEnabled Boolean If false, HTTP Keep-Alive is disabled Default True Basic.GracefulShutdownTimeout Integer Timeout for graceful shutdown (maximum 300 sec) Default 10 Basic.MaxHeaderBytes Integer Max length of request header, in bytes Default 10485 Basic.MaxHeaderUriBytes Integer Max lenght of request URI, in bytes Default 8192 Basic.HostRuleConf String Path of host config Default server_data_conf/host_rule.data Basic.VipRuleConf String Path of VIP config Default server_data_conf/vip_rule.data Basic.RouteRuleConf String Path of route rule config Default server_data_conf/route_rule.data Basic.ClusterConf String Path of cluster config Default server_data_conf/cluster_conf.data Basic.GslbConf String Path of subcluster balancing config Default cluster_conf/gslb.data Basic.ClusterTableConf String Path of instance balancing config Default cluster_conf/cluster_table.data Basic.NameConf String Path of naming config Default server_data_conf/name_conf.data Basic.Modules String Enabled modules Default \"\" Basic.MonitorInterval Integer Interval for get diff of proxy-state Default 20 Basic.DebugServHttp Boolean Debug flag for ServerHttp Default False Basic.DebugBfeRoute Boolean Debug flag for BfeRoute Default False Basic.DebugBal Boolean Debug flag for Bal Default False Basic.DebugHealthCheck Boolean Debug flag for HealthCheck Default False TLS basic config Config Item Description HttpsBasic.ServerCertConf String Path of cert config Default tls_conf/server_cert_conf.data HttpsBasic.TlsRuleConf String Path of tls rule config Default tls_conf/tls_rule_conf.data HttpsBasic.CipherSuites String CipherSuites preference settings Default HttpsBasic.CurvePreferences String Curve perference settings Default CurveP256 HttpsBasic.EnableSslv2ClientHello Boolean Enable Sslv2ClientHello for compatible with ancient sslv3 client Default True HttpsBasic.ClientCABaseDir String Base directory of client ca certificates Note: filename suffix of ca certificate must be \".crt\" Default tls_conf/client_ca SessioCache.SessionCacheDisabled Boolean Disable tls session cache or not Default True SessioCache.Servers String Address of cache server Default \"\" SessioCache.KeyPrefix String Prefix for cache key Default bfe SessioCache.ConnectTimeout Integer Connection timeout (ms) Default 50 SessioCache.ReadTimeout Integer Read timeout of connection with redis server (ms) Default 50 SessioCache.WriteTimeout Integer Write timeout of connection with redis server (ms) Default 50 SessioCache.MaxIdle Integer Max idle connections in connection pool Default 20 SessioCache.SessionExpire Integer Expire time for tls session state (second) Default 3600 SessionTicket.SessionTicketsDisabled Boolean Disable tls session ticket or not Default True SessionTicket.SessionTicketKeyFile String Path of session ticket key config Default tls_conf/session_ticket_key.data Example [Server] # listen port for http request HttpPort = 8080 # listen port for https request HttpsPort = 8443 # listen port for monitor request MonitorPort = 8421 # max number of CPUs to use (0 to use all CPUs) MaxCpus = 0 # type of layer-4 load balancer (PROXY/NONE) # # Note: # - PROXY: layer-4 balancer talking the proxy protocol # eg. F5 BigIP/Citrix ADC # - NONE: layer-4 balancer disabled Layer4LoadBalancer = \"\" # tls handshake timeout, in seconds TlsHandshakeTimeout = 30 # read timeout, in seconds ClientReadTimeout = 60 # write timeout, in seconds ClientWriteTimeout = 60 # if false, client connection is shutdown disregard of http headers KeepAliveEnabled = true # timeout for graceful shutdown (maximum 300 sec) GracefulShutdownTimeout = 10 # max header length in bytes in request MaxHeaderBytes = 1048576 # max URI(in header) length in bytes in request MaxHeaderUriBytes = 8192 # routing related confs HostRuleConf = server_data_conf/host_rule.data VipRuleConf = server_data_conf/vip_rule.data RouteRuleConf = server_data_conf/route_rule.data ClusterConf = server_data_conf/cluster_conf.data NameConf = server_data_conf/name_conf.data # load balancing related confs ClusterTableConf = cluster_conf/cluster_table.data GslbConf = cluster_conf/gslb.data Modules = mod_trust_clientip Modules = mod_block Modules = mod_header Modules = mod_rewrite Modules = mod_redirect Modules = mod_logid # interval for get diff of proxy-state MonitorInterval = 20 DebugServHttp = false DebugBfeRoute = false DebugBal = false DebugHealthCheck = false [HttpsBasic] # cert conf for https ServerCertConf = tls_conf/server_cert_conf.data # tls rule for https TlsRuleConf = tls_conf/tls_rule_conf.data # supported cipherSuites preference settings # # ciphersuites implemented in golang # TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 # TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 # TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 # TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 # TLS_ECDHE_RSA_WITH_RC4_128_SHA # TLS_ECDHE_ECDSA_WITH_RC4_128_SHA # TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA # TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA # TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA # TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA # TLS_RSA_WITH_RC4_128_SHA # TLS_RSA_WITH_AES_128_CBC_SHA # TLS_RSA_WITH_AES_256_CBC_SHA # TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA # TLS_RSA_WITH_3DES_EDE_CBC_SHA # # Note: # -. Equivalent cipher suites (cipher suites with same priority in server side): # CipherSuites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 # CipherSuites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 # CipherSuites = TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 CipherSuites = TLS_ECDHE_RSA_WITH_RC4_128_SHA CipherSuites = TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA CipherSuites = TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA CipherSuites = TLS_RSA_WITH_RC4_128_SHA CipherSuites = TLS_RSA_WITH_AES_128_CBC_SHA CipherSuites = TLS_RSA_WITH_AES_256_CBC_SHA # supported curve perference settings # # curves implemented in golang: # CurveP256 # CurveP384 # CurveP521 # # Note: # - Do not use CurveP384/CurveP521 which is with poor performance # CurvePreferences = CurveP256 # support Sslv2 ClientHello for compatible with ancient # TLS capable clients (mozilla 5, java 5/6, openssl 0.9.8 etc) EnableSslv2ClientHello = true # client ca certificates base directory # Note: filename suffix for ca certificate file should be \".crt\", eg. example_ca_bundle.crt ClientCABaseDir = tls_conf/client_ca [SessionCache] # disable tls session cache or not SessionCacheDisabled = true # tcp address of redis server Servers = \"example.redis.cluster\" # prefix for cache key KeyPrefix = \"bfe\" # connection params (ms) ConnectTimeout = 50 ReadTimeout = 50 WriteTimeout = 50 # max idle connections in connection pool MaxIdle = 20 # expire time for tls session state (second) SessionExpire = 3600 [SessionTicket] # disable tls session ticket or not SessionTicketsDisabled = true # session ticket key SessionTicketKeyFile = tls_conf/session_ticket_key.data","title":"Core"},{"location":"configuration/bfe.conf/#core-configuration","text":"","title":"Core Configuration"},{"location":"configuration/bfe.conf/#introduction","text":"bfe.conf is the core configuration file of BFE.","title":"Introduction"},{"location":"configuration/bfe.conf/#configuration","text":"","title":"Configuration"},{"location":"configuration/bfe.conf/#server-basic-config","text":"Config Item Description Basic.HttpPort Integer Listen port for HTTP Default 8080 Basic.HttpsPort Integer Listen port for HTTPS Default 8443 Basic.MonitorPort Integer Listen port for monitor Default 8421 Basic.MaxCpus Integer Max number of CPUs to use (0 to use all CPUs) Default 0 Basic.Layer4LoadBalancer String Type of layer-4 load balancer (PROXY/NONE) Default NONE Basic.TlsHandshakeTimeout Integer TLS handshake timeout, in seconds Default 30 Basic.ClientReadTimeout Integer Read timeout of communicating with http client, in seconds Default 60 Basic.ClientWriteTimeout Integer Write timeout of communicating with http client, in seconds Default 60 Basic.KeepAliveEnabled Boolean If false, HTTP Keep-Alive is disabled Default True Basic.GracefulShutdownTimeout Integer Timeout for graceful shutdown (maximum 300 sec) Default 10 Basic.MaxHeaderBytes Integer Max length of request header, in bytes Default 10485 Basic.MaxHeaderUriBytes Integer Max lenght of request URI, in bytes Default 8192 Basic.HostRuleConf String Path of host config Default server_data_conf/host_rule.data Basic.VipRuleConf String Path of VIP config Default server_data_conf/vip_rule.data Basic.RouteRuleConf String Path of route rule config Default server_data_conf/route_rule.data Basic.ClusterConf String Path of cluster config Default server_data_conf/cluster_conf.data Basic.GslbConf String Path of subcluster balancing config Default cluster_conf/gslb.data Basic.ClusterTableConf String Path of instance balancing config Default cluster_conf/cluster_table.data Basic.NameConf String Path of naming config Default server_data_conf/name_conf.data Basic.Modules String Enabled modules Default \"\" Basic.MonitorInterval Integer Interval for get diff of proxy-state Default 20 Basic.DebugServHttp Boolean Debug flag for ServerHttp Default False Basic.DebugBfeRoute Boolean Debug flag for BfeRoute Default False Basic.DebugBal Boolean Debug flag for Bal Default False Basic.DebugHealthCheck Boolean Debug flag for HealthCheck Default False","title":"Server basic config"},{"location":"configuration/bfe.conf/#tls-basic-config","text":"Config Item Description HttpsBasic.ServerCertConf String Path of cert config Default tls_conf/server_cert_conf.data HttpsBasic.TlsRuleConf String Path of tls rule config Default tls_conf/tls_rule_conf.data HttpsBasic.CipherSuites String CipherSuites preference settings Default HttpsBasic.CurvePreferences String Curve perference settings Default CurveP256 HttpsBasic.EnableSslv2ClientHello Boolean Enable Sslv2ClientHello for compatible with ancient sslv3 client Default True HttpsBasic.ClientCABaseDir String Base directory of client ca certificates Note: filename suffix of ca certificate must be \".crt\" Default tls_conf/client_ca SessioCache.SessionCacheDisabled Boolean Disable tls session cache or not Default True SessioCache.Servers String Address of cache server Default \"\" SessioCache.KeyPrefix String Prefix for cache key Default bfe SessioCache.ConnectTimeout Integer Connection timeout (ms) Default 50 SessioCache.ReadTimeout Integer Read timeout of connection with redis server (ms) Default 50 SessioCache.WriteTimeout Integer Write timeout of connection with redis server (ms) Default 50 SessioCache.MaxIdle Integer Max idle connections in connection pool Default 20 SessioCache.SessionExpire Integer Expire time for tls session state (second) Default 3600 SessionTicket.SessionTicketsDisabled Boolean Disable tls session ticket or not Default True SessionTicket.SessionTicketKeyFile String Path of session ticket key config Default tls_conf/session_ticket_key.data","title":"TLS basic config"},{"location":"configuration/bfe.conf/#example","text":"[Server] # listen port for http request HttpPort = 8080 # listen port for https request HttpsPort = 8443 # listen port for monitor request MonitorPort = 8421 # max number of CPUs to use (0 to use all CPUs) MaxCpus = 0 # type of layer-4 load balancer (PROXY/NONE) # # Note: # - PROXY: layer-4 balancer talking the proxy protocol # eg. F5 BigIP/Citrix ADC # - NONE: layer-4 balancer disabled Layer4LoadBalancer = \"\" # tls handshake timeout, in seconds TlsHandshakeTimeout = 30 # read timeout, in seconds ClientReadTimeout = 60 # write timeout, in seconds ClientWriteTimeout = 60 # if false, client connection is shutdown disregard of http headers KeepAliveEnabled = true # timeout for graceful shutdown (maximum 300 sec) GracefulShutdownTimeout = 10 # max header length in bytes in request MaxHeaderBytes = 1048576 # max URI(in header) length in bytes in request MaxHeaderUriBytes = 8192 # routing related confs HostRuleConf = server_data_conf/host_rule.data VipRuleConf = server_data_conf/vip_rule.data RouteRuleConf = server_data_conf/route_rule.data ClusterConf = server_data_conf/cluster_conf.data NameConf = server_data_conf/name_conf.data # load balancing related confs ClusterTableConf = cluster_conf/cluster_table.data GslbConf = cluster_conf/gslb.data Modules = mod_trust_clientip Modules = mod_block Modules = mod_header Modules = mod_rewrite Modules = mod_redirect Modules = mod_logid # interval for get diff of proxy-state MonitorInterval = 20 DebugServHttp = false DebugBfeRoute = false DebugBal = false DebugHealthCheck = false [HttpsBasic] # cert conf for https ServerCertConf = tls_conf/server_cert_conf.data # tls rule for https TlsRuleConf = tls_conf/tls_rule_conf.data # supported cipherSuites preference settings # # ciphersuites implemented in golang # TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 # TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 # TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 # TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 # TLS_ECDHE_RSA_WITH_RC4_128_SHA # TLS_ECDHE_ECDSA_WITH_RC4_128_SHA # TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA # TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA # TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA # TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA # TLS_RSA_WITH_RC4_128_SHA # TLS_RSA_WITH_AES_128_CBC_SHA # TLS_RSA_WITH_AES_256_CBC_SHA # TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA # TLS_RSA_WITH_3DES_EDE_CBC_SHA # # Note: # -. Equivalent cipher suites (cipher suites with same priority in server side): # CipherSuites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 # CipherSuites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 # CipherSuites = TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256|TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 CipherSuites = TLS_ECDHE_RSA_WITH_RC4_128_SHA CipherSuites = TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA CipherSuites = TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA CipherSuites = TLS_RSA_WITH_RC4_128_SHA CipherSuites = TLS_RSA_WITH_AES_128_CBC_SHA CipherSuites = TLS_RSA_WITH_AES_256_CBC_SHA # supported curve perference settings # # curves implemented in golang: # CurveP256 # CurveP384 # CurveP521 # # Note: # - Do not use CurveP384/CurveP521 which is with poor performance # CurvePreferences = CurveP256 # support Sslv2 ClientHello for compatible with ancient # TLS capable clients (mozilla 5, java 5/6, openssl 0.9.8 etc) EnableSslv2ClientHello = true # client ca certificates base directory # Note: filename suffix for ca certificate file should be \".crt\", eg. example_ca_bundle.crt ClientCABaseDir = tls_conf/client_ca [SessionCache] # disable tls session cache or not SessionCacheDisabled = true # tcp address of redis server Servers = \"example.redis.cluster\" # prefix for cache key KeyPrefix = \"bfe\" # connection params (ms) ConnectTimeout = 50 ReadTimeout = 50 WriteTimeout = 50 # max idle connections in connection pool MaxIdle = 20 # expire time for tls session state (second) SessionExpire = 3600 [SessionTicket] # disable tls session ticket or not SessionTicketsDisabled = true # session ticket key SessionTicketKeyFile = tls_conf/session_ticket_key.data","title":"Example"},{"location":"configuration/config/","text":"Configuration overview Configuration types Normal configuration: For changes to the configuration file to take effect, you must restart the bfe process. Dynamic configuration: For changes to the configuration file to take effect, you can either restart or reload the bfe process. Configuration format Normal configuration file: INI format Dynamic configuration file: JSON format (except for cerfificate/dict file, etc) Configuration layout The main configuration file is named bfe.conf (conf/bfe.conf). To make the configuration easier to maintain, we split it into a set of feature-specific files stored in the conf/<feature>/ directory. functional category configuration layout main configuration conf/bfe.conf configuration about protocol conf/tls_conf/ configuration about routing conf/server_data_conf/ configuration about balancing conf/cluster_conf/ configuration about modules conf/mod_<name> Reloading Configuration See Reloading configuration","title":"Overview"},{"location":"configuration/config/#configuration-overview","text":"","title":"Configuration overview"},{"location":"configuration/config/#configuration-types","text":"Normal configuration: For changes to the configuration file to take effect, you must restart the bfe process. Dynamic configuration: For changes to the configuration file to take effect, you can either restart or reload the bfe process.","title":"Configuration types"},{"location":"configuration/config/#configuration-format","text":"Normal configuration file: INI format Dynamic configuration file: JSON format (except for cerfificate/dict file, etc)","title":"Configuration format"},{"location":"configuration/config/#configuration-layout","text":"The main configuration file is named bfe.conf (conf/bfe.conf). To make the configuration easier to maintain, we split it into a set of feature-specific files stored in the conf/<feature>/ directory. functional category configuration layout main configuration conf/bfe.conf configuration about protocol conf/tls_conf/ configuration about routing conf/server_data_conf/ configuration about balancing conf/cluster_conf/ configuration about modules conf/mod_<name>","title":"Configuration layout"},{"location":"configuration/config/#reloading-configuration","text":"See Reloading configuration","title":"Reloading Configuration"},{"location":"configuration/cluster_conf/cluster_table.data/","text":"Instances Balancing Configuration Introduction cluster_table.data records the load balancing config among instances. Configuration Basic configuration Config Item Description Version String Verson of config file Config Object config of all clusters Config{k} String name of cluster Config{v} Object config of cluster Config{v}{k} String name of subcluster Config{v}{v} Object config of subcluster(a list of instance) Instance configuraton Config Item Description Addr String ip address of instance Name String name of instance Port String port of instance Weight String weight of instance Example { \"Config\" : { \"cluster_example\" : { \"example.bfe.bj\" : [ { \"Addr\" : \"10.199.189.26\" , \"Name\" : \"example_hostname\" , \"Port\" : 10257 , \"Weight\" : 10 } ] } }, \"Version\" : \"20190101000000\" }","title":"Instances balancing"},{"location":"configuration/cluster_conf/cluster_table.data/#instances-balancing-configuration","text":"","title":"Instances Balancing Configuration"},{"location":"configuration/cluster_conf/cluster_table.data/#introduction","text":"cluster_table.data records the load balancing config among instances.","title":"Introduction"},{"location":"configuration/cluster_conf/cluster_table.data/#configuration","text":"","title":"Configuration"},{"location":"configuration/cluster_conf/cluster_table.data/#basic-configuration","text":"Config Item Description Version String Verson of config file Config Object config of all clusters Config{k} String name of cluster Config{v} Object config of cluster Config{v}{k} String name of subcluster Config{v}{v} Object config of subcluster(a list of instance)","title":"Basic configuration"},{"location":"configuration/cluster_conf/cluster_table.data/#instance-configuraton","text":"Config Item Description Addr String ip address of instance Name String name of instance Port String port of instance Weight String weight of instance","title":"Instance configuraton"},{"location":"configuration/cluster_conf/cluster_table.data/#example","text":"{ \"Config\" : { \"cluster_example\" : { \"example.bfe.bj\" : [ { \"Addr\" : \"10.199.189.26\" , \"Name\" : \"example_hostname\" , \"Port\" : 10257 , \"Weight\" : 10 } ] } }, \"Version\" : \"20190101000000\" }","title":"Example"},{"location":"configuration/cluster_conf/gslb.data/","text":"SubClusters Balancing Configuration Introduction gslb.data records the load balancing config between sub-clusters. Configuration Config Item Description Clusters Object cluster config Clusters{k} String cluster name Clusters{v} Object weight config for each sub-cluster Clusters{v}{k} String name of sub-cluster GSLB_BLACKHOLE is the name of blackhole sub-cluster which discards all incoming requests Clusters{v}{v} Integer weight of sub-cluster The weight should be [0, 100] and the weight sum of all sub-cluster should be 100 Hostname String Hostname of gslb scheduler Ts String Timestamp of config file Example { \"Clusters\" : { \"cluster_example\" : { \"GSLB_BLACKHOLE\" : 0 , \"example.bfe.bj\" : 100 } }, \"Hostname\" : \"gslb-sch.example.com\" , \"Ts\" : \"20190101000000\" }","title":"Sub-clusters balancing"},{"location":"configuration/cluster_conf/gslb.data/#subclusters-balancing-configuration","text":"","title":"SubClusters Balancing Configuration"},{"location":"configuration/cluster_conf/gslb.data/#introduction","text":"gslb.data records the load balancing config between sub-clusters.","title":"Introduction"},{"location":"configuration/cluster_conf/gslb.data/#configuration","text":"Config Item Description Clusters Object cluster config Clusters{k} String cluster name Clusters{v} Object weight config for each sub-cluster Clusters{v}{k} String name of sub-cluster GSLB_BLACKHOLE is the name of blackhole sub-cluster which discards all incoming requests Clusters{v}{v} Integer weight of sub-cluster The weight should be [0, 100] and the weight sum of all sub-cluster should be 100 Hostname String Hostname of gslb scheduler Ts String Timestamp of config file","title":"Configuration"},{"location":"configuration/cluster_conf/gslb.data/#example","text":"{ \"Clusters\" : { \"cluster_example\" : { \"GSLB_BLACKHOLE\" : 0 , \"example.bfe.bj\" : 100 } }, \"Hostname\" : \"gslb-sch.example.com\" , \"Ts\" : \"20190101000000\" }","title":"Example"},{"location":"configuration/server_data_conf/cluster_conf.data/","text":"Cluster Configuration Introduction cluster_conf.data records the cluster config. Configuration Config Item Description Version String Verson of config file Config Struct Map data, key is cluster name, value is cluster config detail Cluster Config Detail Backend Config BackendConf is config for backend. Config Item Description TimeoutConnSrv Int Timeout for connect backend, in ms TimeoutResponseHeader Int Timeout for read response header, in ms MaxIdleConnsPerHost Int Max idle conns to each backend RetryLevel Int Retry level if request fail Health Check Config CheckConf is config of backend check. Config Item Description Schem String Protocol for health check (HTTP/TCP) Uri String Uri used in health check (HTTP) Host String If check request use special host header (HTTP) StatusCode Int Expected response code, default value is 200 (HTTP) FailNum Int Unhealthy threshold (consecutive failures of check request) SuccNum Int Healthy threshold (consecutive successes of normal request) CheckTimeout Int Timeout for health check, in ms CheckInterval Int Interval of health check, in ms GSLB Config GslbBasic is cluster config for Gslb. Config Item Description CrossRetry Int Cross sub-clusters retry times RetryMax Int Inner cluster retry times BalanceMode String BalanceMode, default WRR HashConf Struct Hash config about load balabnce - HashStrategy: HashStrategy is hash strategy for subcluster-level load balance. Such as ClientIdOnly, ClientIpOnly, ClientIdPreferred - HashHeader: HashHeader is an optional request header which represents a unique client. Format for speicial cookie header is \"Cookie:Key\" - SessionSticky: SessionSticky enable sticky session (ensures that all requests from the user during the session are sent to the same backend) Cluster Basic Config ClusterBasic is basic config for cluster. Config Item Description TimeoutReadClient Int Timeout for read client body in ms TimeoutWriteClient Int Timeout for write response to client TimeoutReadClientAgain Int Timeout for read client again in ms ReqWriteBufferSize Int Write buffer size for request in byte ReqFlushInterval Int Interval to flush request in ms. if zero, disable periodic flush ResFlushInterval Int Interval to flush response in ms. if zero, disable periodic flush CancelOnClientClose Bool Cancel blocking operation on server if client connection disconnected Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"cluster_example\" : { \"BackendConf\" : { \"TimeoutConnSrv\" : 2000 , \"TimeoutResponseHeader\" : 50000 , \"MaxIdleConnsPerHost\" : 0 , \"RetryLevel\" : 0 }, \"CheckConf\" : { \"Schem\" : \"http\" , \"Uri\" : \"/healthcheck\" , \"Host\" : \"example.org\" , \"StatusCode\" : 200 , \"FailNum\" : 10 , \"CheckInterval\" : 1000 }, \"GslbBasic\" : { \"CrossRetry\" : 0 , \"RetryMax\" : 2 , \"HashConf\" : { \"HashStrategy\" : 0 , \"HashHeader\" : \"Cookie:UID\" , \"SessionSticky\" : false } }, \"ClusterBasic\" : { \"TimeoutReadClient\" : 30000 , \"TimeoutWriteClient\" : 60000 , \"TimeoutReadClientAgain\" : 30000 , \"ReqWriteBufferSize\" : 512 , \"ReqFlushInterval\" : 0 , \"ResFlushInterval\" : -1 , \"CancelOnClientClose\" : false } } } }","title":"Backend cluster"},{"location":"configuration/server_data_conf/cluster_conf.data/#cluster-configuration","text":"","title":"Cluster Configuration"},{"location":"configuration/server_data_conf/cluster_conf.data/#introduction","text":"cluster_conf.data records the cluster config.","title":"Introduction"},{"location":"configuration/server_data_conf/cluster_conf.data/#configuration","text":"Config Item Description Version String Verson of config file Config Struct Map data, key is cluster name, value is cluster config detail","title":"Configuration"},{"location":"configuration/server_data_conf/cluster_conf.data/#cluster-config-detail","text":"","title":"Cluster Config Detail"},{"location":"configuration/server_data_conf/cluster_conf.data/#backend-config","text":"BackendConf is config for backend. Config Item Description TimeoutConnSrv Int Timeout for connect backend, in ms TimeoutResponseHeader Int Timeout for read response header, in ms MaxIdleConnsPerHost Int Max idle conns to each backend RetryLevel Int Retry level if request fail","title":"Backend Config"},{"location":"configuration/server_data_conf/cluster_conf.data/#health-check-config","text":"CheckConf is config of backend check. Config Item Description Schem String Protocol for health check (HTTP/TCP) Uri String Uri used in health check (HTTP) Host String If check request use special host header (HTTP) StatusCode Int Expected response code, default value is 200 (HTTP) FailNum Int Unhealthy threshold (consecutive failures of check request) SuccNum Int Healthy threshold (consecutive successes of normal request) CheckTimeout Int Timeout for health check, in ms CheckInterval Int Interval of health check, in ms","title":"Health Check Config"},{"location":"configuration/server_data_conf/cluster_conf.data/#gslb-config","text":"GslbBasic is cluster config for Gslb. Config Item Description CrossRetry Int Cross sub-clusters retry times RetryMax Int Inner cluster retry times BalanceMode String BalanceMode, default WRR HashConf Struct Hash config about load balabnce - HashStrategy: HashStrategy is hash strategy for subcluster-level load balance. Such as ClientIdOnly, ClientIpOnly, ClientIdPreferred - HashHeader: HashHeader is an optional request header which represents a unique client. Format for speicial cookie header is \"Cookie:Key\" - SessionSticky: SessionSticky enable sticky session (ensures that all requests from the user during the session are sent to the same backend)","title":"GSLB Config"},{"location":"configuration/server_data_conf/cluster_conf.data/#cluster-basic-config","text":"ClusterBasic is basic config for cluster. Config Item Description TimeoutReadClient Int Timeout for read client body in ms TimeoutWriteClient Int Timeout for write response to client TimeoutReadClientAgain Int Timeout for read client again in ms ReqWriteBufferSize Int Write buffer size for request in byte ReqFlushInterval Int Interval to flush request in ms. if zero, disable periodic flush ResFlushInterval Int Interval to flush response in ms. if zero, disable periodic flush CancelOnClientClose Bool Cancel blocking operation on server if client connection disconnected","title":"Cluster Basic Config"},{"location":"configuration/server_data_conf/cluster_conf.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"cluster_example\" : { \"BackendConf\" : { \"TimeoutConnSrv\" : 2000 , \"TimeoutResponseHeader\" : 50000 , \"MaxIdleConnsPerHost\" : 0 , \"RetryLevel\" : 0 }, \"CheckConf\" : { \"Schem\" : \"http\" , \"Uri\" : \"/healthcheck\" , \"Host\" : \"example.org\" , \"StatusCode\" : 200 , \"FailNum\" : 10 , \"CheckInterval\" : 1000 }, \"GslbBasic\" : { \"CrossRetry\" : 0 , \"RetryMax\" : 2 , \"HashConf\" : { \"HashStrategy\" : 0 , \"HashHeader\" : \"Cookie:UID\" , \"SessionSticky\" : false } }, \"ClusterBasic\" : { \"TimeoutReadClient\" : 30000 , \"TimeoutWriteClient\" : 60000 , \"TimeoutReadClientAgain\" : 30000 , \"ReqWriteBufferSize\" : 512 , \"ReqFlushInterval\" : 0 , \"ResFlushInterval\" : -1 , \"CancelOnClientClose\" : false } } } }","title":"Example"},{"location":"configuration/server_data_conf/host_rule.data/","text":"Host Rule Configuration Introduction host_rule.data records the domain names for each product. Configuration Config Item Description Version String Verson of config file DefaultProduct String Default product name. Hosts Struct Host list for each HostTag Hosts{k} Struct HostTag Hosts{v} String Host list for HostTag HostTags Struct HostTag list for each product HostTags{k} Struct Product name HostTags{v} Struct HostTag list for product Example { \"Version\" : \"20190101000000\" , \"DefaultProduct\" : null , \"Hosts\" : { \"exampleTag\" :[ \"example.org\" ] }, \"HostTags\" : { \"example_product\" :[ \"exampleTag\" ] } }","title":"Host rule"},{"location":"configuration/server_data_conf/host_rule.data/#host-rule-configuration","text":"","title":"Host Rule Configuration"},{"location":"configuration/server_data_conf/host_rule.data/#introduction","text":"host_rule.data records the domain names for each product.","title":"Introduction"},{"location":"configuration/server_data_conf/host_rule.data/#configuration","text":"Config Item Description Version String Verson of config file DefaultProduct String Default product name. Hosts Struct Host list for each HostTag Hosts{k} Struct HostTag Hosts{v} String Host list for HostTag HostTags Struct HostTag list for each product HostTags{k} Struct Product name HostTags{v} Struct HostTag list for product","title":"Configuration"},{"location":"configuration/server_data_conf/host_rule.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"DefaultProduct\" : null , \"Hosts\" : { \"exampleTag\" :[ \"example.org\" ] }, \"HostTags\" : { \"example_product\" :[ \"exampleTag\" ] } }","title":"Example"},{"location":"configuration/server_data_conf/name_conf.data/","text":"Naming Configurationn Introduction name_conf.data records the mapping between service name and service instances. Configuration Config Item Description Version String Version of config file Config Struct Mapping between service name and instances Config{k} String Service name Config{v} Struct A list of instances Config{v}[].Host String Instance address Config{v}[].Port Integer Instance port Config{v}[].Weight Integer Instance weight Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example.redis.cluster\" : [ { \"Host\" : \"192.168.1.1\" , \"Port\" : 6439 , \"Weight\" : 10 } ] } }","title":"Naming"},{"location":"configuration/server_data_conf/name_conf.data/#naming-configurationn","text":"","title":"Naming Configurationn"},{"location":"configuration/server_data_conf/name_conf.data/#introduction","text":"name_conf.data records the mapping between service name and service instances.","title":"Introduction"},{"location":"configuration/server_data_conf/name_conf.data/#configuration","text":"Config Item Description Version String Version of config file Config Struct Mapping between service name and instances Config{k} String Service name Config{v} Struct A list of instances Config{v}[].Host String Instance address Config{v}[].Port Integer Instance port Config{v}[].Weight Integer Instance weight","title":"Configuration"},{"location":"configuration/server_data_conf/name_conf.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example.redis.cluster\" : [ { \"Host\" : \"192.168.1.1\" , \"Port\" : 6439 , \"Weight\" : 10 } ] } }","title":"Example"},{"location":"configuration/server_data_conf/route_rule.data/","text":"Route Rule Configuration Introduction route_rule.data records route rule config for each product. Configuration Config Item Description Version String Time of generating config file ProductRule Struct Route rules for each product ProductRule{k} String Product name ProductRule{v} Struct A ordered list of route rules ProductRule{v}[].Cond String Condition expression ProductRule{v}[].ClusterName String Destination cluster name Example { \"Version\" : \"20190101000000\" , \"ProductRule\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"ClusterName\" : \"cluster_example1\" }, { \"Cond\" : \"default_t()\" , \"ClusterName\" : \"cluster_example2\" } ] } }","title":"Route rule"},{"location":"configuration/server_data_conf/route_rule.data/#route-rule-configuration","text":"","title":"Route Rule Configuration"},{"location":"configuration/server_data_conf/route_rule.data/#introduction","text":"route_rule.data records route rule config for each product.","title":"Introduction"},{"location":"configuration/server_data_conf/route_rule.data/#configuration","text":"Config Item Description Version String Time of generating config file ProductRule Struct Route rules for each product ProductRule{k} String Product name ProductRule{v} Struct A ordered list of route rules ProductRule{v}[].Cond String Condition expression ProductRule{v}[].ClusterName String Destination cluster name","title":"Configuration"},{"location":"configuration/server_data_conf/route_rule.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"ProductRule\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"ClusterName\" : \"cluster_example1\" }, { \"Cond\" : \"default_t()\" , \"ClusterName\" : \"cluster_example2\" } ] } }","title":"Example"},{"location":"configuration/server_data_conf/vip_rule.data/","text":"VIP Rule Configuration Introduction vip_rule.data records vip lists for each product. Configuration Config Item Description Version String Version of config file Vips Struct Vip list for each product Vips{k} String Product name Vips{v} Struct Vip list for product Example { \"Version\" : \"20190101000000\" , \"Vips\" : { \"example_product\" : [ \"111.111.111.111\" ] } }","title":"VIP rule"},{"location":"configuration/server_data_conf/vip_rule.data/#vip-rule-configuration","text":"","title":"VIP Rule Configuration"},{"location":"configuration/server_data_conf/vip_rule.data/#introduction","text":"vip_rule.data records vip lists for each product.","title":"Introduction"},{"location":"configuration/server_data_conf/vip_rule.data/#configuration","text":"Config Item Description Version String Version of config file Vips Struct Vip list for each product Vips{k} String Product name Vips{v} Struct Vip list for product","title":"Configuration"},{"location":"configuration/server_data_conf/vip_rule.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"Vips\" : { \"example_product\" : [ \"111.111.111.111\" ] } }","title":"Example"},{"location":"configuration/tls_conf/server_cert_conf.data/","text":"Configuration about Server Certificates Introduction server_cert_conf.data records the config for server certificate and private key Configuration Config Item Description Version String Version of configure file Config Object Server certificate configuration information Config.Default String Name of default cert - Default cert must be configured - Default cert must be included in cert list {CertConf} Config.CertConf Object Cert list Config.CertConf{k} String Name of cert - Cert name can not be \"BFE_DEFAULT_CERT\" Config.CertConf{v} Object Cert related file path Config.CertConf{v}.ServerCertFile String Path of server certificate Config.CertConf{v}.ServerKeyFile String Path of private key Config.CertConf{v}.OcspResponseFile String Path of OCSP Stple (optional) Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"Default\" : \"example.org\" , \"CertConf\" : { \"example.org\" : { \"ServerCertFile\" : \"tls_conf/certs/server.crt\" , \"ServerKeyFile\" : \"tls_conf/certs/server.key\" } } } }","title":"Certificate"},{"location":"configuration/tls_conf/server_cert_conf.data/#configuration-about-server-certificates","text":"","title":"Configuration about Server Certificates"},{"location":"configuration/tls_conf/server_cert_conf.data/#introduction","text":"server_cert_conf.data records the config for server certificate and private key","title":"Introduction"},{"location":"configuration/tls_conf/server_cert_conf.data/#configuration","text":"Config Item Description Version String Version of configure file Config Object Server certificate configuration information Config.Default String Name of default cert - Default cert must be configured - Default cert must be included in cert list {CertConf} Config.CertConf Object Cert list Config.CertConf{k} String Name of cert - Cert name can not be \"BFE_DEFAULT_CERT\" Config.CertConf{v} Object Cert related file path Config.CertConf{v}.ServerCertFile String Path of server certificate Config.CertConf{v}.ServerKeyFile String Path of private key Config.CertConf{v}.OcspResponseFile String Path of OCSP Stple (optional)","title":"Configuration"},{"location":"configuration/tls_conf/server_cert_conf.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"Default\" : \"example.org\" , \"CertConf\" : { \"example.org\" : { \"ServerCertFile\" : \"tls_conf/certs/server.crt\" , \"ServerKeyFile\" : \"tls_conf/certs/server.key\" } } } }","title":"Example"},{"location":"configuration/tls_conf/session_ticket_key.data/","text":"Configuration about TLS Session Ticket Key Introduction session_ticket_key.data records the session ticket key. Configuration Config Item Description Version String Version of config file SessionTicketKey String The session ticket key. length is 48 and contains only [a-z0-9] Example { \"Version\" : \"20190101000000\" , \"SessionTicketKey\" : \"08a0d852ef494143af613ef32d3c39314758885f7108e9ab021d55f422a454f7c9cd5a53978f48fa1063eadcdc06878f\" }","title":"Session ticket key"},{"location":"configuration/tls_conf/session_ticket_key.data/#configuration-about-tls-session-ticket-key","text":"","title":"Configuration about TLS Session Ticket Key"},{"location":"configuration/tls_conf/session_ticket_key.data/#introduction","text":"session_ticket_key.data records the session ticket key.","title":"Introduction"},{"location":"configuration/tls_conf/session_ticket_key.data/#configuration","text":"Config Item Description Version String Version of config file SessionTicketKey String The session ticket key. length is 48 and contains only [a-z0-9]","title":"Configuration"},{"location":"configuration/tls_conf/session_ticket_key.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"SessionTicketKey\" : \"08a0d852ef494143af613ef32d3c39314758885f7108e9ab021d55f422a454f7c9cd5a53978f48fa1063eadcdc06878f\" }","title":"Example"},{"location":"configuration/tls_conf/tls_rule_conf.data/","text":"Configration about TLS Introduction tls_rule_conf.data records the tls protocol config Configuration Config Item Description Version String Version of configure file Config Object TLS rule config. Config.{k} String Unique label Config.{v} Object TLS rule detail Config.{v}.CertName String Name of server certificate (Note: defined in server_cert_conf.data) Config.{v}.NextProtos Object TLS application layer protocol list - Default is [\"http/1.1\"] Config.{v}.NextProtos[] String TLS application layer protocol - Contains h2, spdy/3.1, http/1.1 Config.{v}.Grade String TLS Security grade, Contains A+, A, B, C Config.{v}.ClientAuth Bool Enable TLS Client Authentication Config.{v}.ClientCAName String Name of Client CA certificate Config.{v}.VipConf Object Array List of VIP addresses (Note: priority is given to TLS configuration based on VIP) Config.{v}.VipConf[] String Array VIP Config.{v}.SniConf Object Array List of hostnames (optional) - (Note: when TLS configuration cannot be determined according to VIP, SNI is used to determine TLS configuration) Config.{v}.SniConf[] String Array Hostname DefaultNextProtos Object Default(Supported) application layer protocols over TLS DefaultNextProtos[] String TLS application layer protocol - Contains h2, spdy/3.1, http/1.1 Example { \"Version\" : \"20190101000000\" , \"DefaultNextProtos\" : [ \"h2\" , \"http/1.1\" ], \"Config\" : { \"example_product\" : { \"VipConf\" : [ \"10.199.4.14\" ], \"SniConf\" : null , \"CertName\" : \"example.org\" , \"NextProtos\" : [ \"h2\" , \"http/1.1\" ], \"Grade\" : \"C\" , \"ClientCAName\" : \"\" } } } Security Grade BFE supports multiple security grades(A+/A/B/C) for ease of TLS configuration. Security grades vary depending on the protocols and the cipher suites supported. Grade A+ Supported Protocols Supported Cipher Suites TLS1.2 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA Grade A Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA Grade B Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA SSLv3 TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA Grade C Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA SSLv3 TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA","title":"SSL/TLS"},{"location":"configuration/tls_conf/tls_rule_conf.data/#configration-about-tls","text":"","title":"Configration about TLS"},{"location":"configuration/tls_conf/tls_rule_conf.data/#introduction","text":"tls_rule_conf.data records the tls protocol config","title":"Introduction"},{"location":"configuration/tls_conf/tls_rule_conf.data/#configuration","text":"Config Item Description Version String Version of configure file Config Object TLS rule config. Config.{k} String Unique label Config.{v} Object TLS rule detail Config.{v}.CertName String Name of server certificate (Note: defined in server_cert_conf.data) Config.{v}.NextProtos Object TLS application layer protocol list - Default is [\"http/1.1\"] Config.{v}.NextProtos[] String TLS application layer protocol - Contains h2, spdy/3.1, http/1.1 Config.{v}.Grade String TLS Security grade, Contains A+, A, B, C Config.{v}.ClientAuth Bool Enable TLS Client Authentication Config.{v}.ClientCAName String Name of Client CA certificate Config.{v}.VipConf Object Array List of VIP addresses (Note: priority is given to TLS configuration based on VIP) Config.{v}.VipConf[] String Array VIP Config.{v}.SniConf Object Array List of hostnames (optional) - (Note: when TLS configuration cannot be determined according to VIP, SNI is used to determine TLS configuration) Config.{v}.SniConf[] String Array Hostname DefaultNextProtos Object Default(Supported) application layer protocols over TLS DefaultNextProtos[] String TLS application layer protocol - Contains h2, spdy/3.1, http/1.1","title":"Configuration"},{"location":"configuration/tls_conf/tls_rule_conf.data/#example","text":"{ \"Version\" : \"20190101000000\" , \"DefaultNextProtos\" : [ \"h2\" , \"http/1.1\" ], \"Config\" : { \"example_product\" : { \"VipConf\" : [ \"10.199.4.14\" ], \"SniConf\" : null , \"CertName\" : \"example.org\" , \"NextProtos\" : [ \"h2\" , \"http/1.1\" ], \"Grade\" : \"C\" , \"ClientCAName\" : \"\" } } }","title":"Example"},{"location":"configuration/tls_conf/tls_rule_conf.data/#security-grade","text":"BFE supports multiple security grades(A+/A/B/C) for ease of TLS configuration. Security grades vary depending on the protocols and the cipher suites supported.","title":"Security Grade"},{"location":"configuration/tls_conf/tls_rule_conf.data/#grade-a","text":"Supported Protocols Supported Cipher Suites TLS1.2 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA","title":"Grade A+"},{"location":"configuration/tls_conf/tls_rule_conf.data/#grade-a_1","text":"Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA","title":"Grade A"},{"location":"configuration/tls_conf/tls_rule_conf.data/#grade-b","text":"Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA SSLv3 TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA","title":"Grade B"},{"location":"configuration/tls_conf/tls_rule_conf.data/#grade-c","text":"Supported Protocols Supported Cipher Suites TLS1.2 TLS1.1 TLS1.0 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_OLD_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_AES_256_CBC_SHA TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA SSLv3 TLS_ECDHE_RSA_WITH_RC4_128_SHA TLS_RSA_WITH_RC4_128_SHA","title":"Grade C"},{"location":"development/local_dev_guide/","text":"Guide of local development You will learn how to develop BFE in local environment under the guidelines of this document. Requirements of coding Please refer to the coding format of golang Unit test is needed for all codes. Pass through all unit tests. Please follow regulations of submmiting codes The following guidiance tells you how to submit code. Fork Transfer to the home page of Github BFE ,and then click button Fork to generate the git under your own file directory,such as https://github.com/USERNAME/bfe Clone Clone remote git to local: $ git clone https://github.com/USERNAME/bfe $ cd bfe Create local branch At present Git stream branch model is applied to BFE to undergo task of development,test,release and maintenance.Please refer to branch regulation of BFE about details\u3002 All development tasks of feature and bug fix should be finished in a new branch which is extended from develop branch. Create and switch to a new branch with command git checkout -b . $ git checkout -b my-cool-stuff It is worth noting that before the checkout, you need to keep the current branch directory clean, otherwise the untracked file will be brought to the new branch, which can be viewed by git status . Use pre-commit hook BFE developers use the pre-commit tool to manage Git pre-commit hooks. It helps us format the source code and automatically check some basic things before committing (such as having only one EOL per file, not adding large files in Git, etc.). The pre-commit test is part of the unit test in Travis-CI. A PR that does not satisfy the hook cannot be submitted to BFE. Install pre-commit first and then run it in current directory\uff1a $ pip install pre-commit $ pre-commit install BFE modify the format of golang source code with gofmt . Start development I delete a line of README.md and create a new file in the case. View the current state via git status , which will prompt some changes to the current directory, and you can also view the file's specific changes via git diff . $ git status On branch test Changes not staged for commit: ( use \"git add <file>...\" to update what will be committed ) ( use \"git checkout -- <file>...\" to discard changes in working directory ) modified: README.md Untracked files: ( use \"git add <file>...\" to include in what will be committed ) test no changes added to commit ( use \"git add\" and/or \"git commit -a\" ) Build and test Please refer to Build and Run about construction and test. Commit Next we cancel the modification of README.md,and submit new added test file. $ git checkout -- README.md $ git status On branch test Untracked files: ( use \"git add <file>...\" to include in what will be committed ) test nothing added to commit but untracked files present ( use \"git add\" to track ) $ git add test It's required that the commit message is also given on every Git commit, through which other developers will be notified of what changes have been made. Type git commit to realize it. $ git commit CRLF end-lines remover............................... ( no files to check ) Skipped yapf................................................. ( no files to check ) Skipped Check for added large files..............................................Passed Check for merge conflicts................................................Passed Check for broken symlinks................................................Passed Detect Private Key................................... ( no files to check ) Skipped Fix End of Files..................................... ( no files to check ) Skipped clang-formater....................................... ( no files to check ) Skipped [ my-cool-stuff c703c041 ] add test file 1 file changed, 0 insertions ( + ) , 0 deletions ( - ) create mode 100644 233 Attention needs to be paid\uff1ayou need to add commit message to trigger CI test.The command is as follows: # Touch CI single test of develop branch $ git commit -m \"test=develop\" # Touch CI single test of release/1.1 branch $ git commit -m \"test=release/1.1\" Keep the latest local repository It needs to keep up with the latest code of original repository( https://github.com/baidu/bfe \uff09before Pull Request. Check the name of current remote repository with git remote . $ git remote origin $ git remote -v origin https://github.com/USERNAME/bfe ( fetch ) origin https://github.com/USERNAME/bfe ( push ) origin is the name of remote repository that we clone, which is also the BFE under your own account. Next we create a remote host of an original BFE and name it upstream. $ git remote add upstream https://github.com/baidu/bfe $ git remote origin upstream Get the latest code of upstream and update current branch. $ git fetch upstream $ git pull upstream develop Push to remote repository Push local modification to GitHub(https://github.com/USERNAME/bfe). # submit it to remote git the branch my-cool-stuff of origin $ git push origin my-cool-stuff","title":"Local development"},{"location":"development/local_dev_guide/#guide-of-local-development","text":"You will learn how to develop BFE in local environment under the guidelines of this document.","title":"Guide of local development"},{"location":"development/local_dev_guide/#requirements-of-coding","text":"Please refer to the coding format of golang Unit test is needed for all codes. Pass through all unit tests. Please follow regulations of submmiting codes The following guidiance tells you how to submit code.","title":"Requirements of coding"},{"location":"development/local_dev_guide/#fork","text":"Transfer to the home page of Github BFE ,and then click button Fork to generate the git under your own file directory,such as https://github.com/USERNAME/bfe","title":"Fork"},{"location":"development/local_dev_guide/#clone","text":"Clone remote git to local: $ git clone https://github.com/USERNAME/bfe $ cd bfe","title":"Clone"},{"location":"development/local_dev_guide/#create-local-branch","text":"At present Git stream branch model is applied to BFE to undergo task of development,test,release and maintenance.Please refer to branch regulation of BFE about details\u3002 All development tasks of feature and bug fix should be finished in a new branch which is extended from develop branch. Create and switch to a new branch with command git checkout -b . $ git checkout -b my-cool-stuff It is worth noting that before the checkout, you need to keep the current branch directory clean, otherwise the untracked file will be brought to the new branch, which can be viewed by git status .","title":"Create local branch"},{"location":"development/local_dev_guide/#use-pre-commit-hook","text":"BFE developers use the pre-commit tool to manage Git pre-commit hooks. It helps us format the source code and automatically check some basic things before committing (such as having only one EOL per file, not adding large files in Git, etc.). The pre-commit test is part of the unit test in Travis-CI. A PR that does not satisfy the hook cannot be submitted to BFE. Install pre-commit first and then run it in current directory\uff1a $ pip install pre-commit $ pre-commit install BFE modify the format of golang source code with gofmt .","title":"Use pre-commit hook"},{"location":"development/local_dev_guide/#start-development","text":"I delete a line of README.md and create a new file in the case. View the current state via git status , which will prompt some changes to the current directory, and you can also view the file's specific changes via git diff . $ git status On branch test Changes not staged for commit: ( use \"git add <file>...\" to update what will be committed ) ( use \"git checkout -- <file>...\" to discard changes in working directory ) modified: README.md Untracked files: ( use \"git add <file>...\" to include in what will be committed ) test no changes added to commit ( use \"git add\" and/or \"git commit -a\" )","title":"Start development"},{"location":"development/local_dev_guide/#build-and-test","text":"Please refer to Build and Run about construction and test.","title":"Build and test"},{"location":"development/local_dev_guide/#commit","text":"Next we cancel the modification of README.md,and submit new added test file. $ git checkout -- README.md $ git status On branch test Untracked files: ( use \"git add <file>...\" to include in what will be committed ) test nothing added to commit but untracked files present ( use \"git add\" to track ) $ git add test It's required that the commit message is also given on every Git commit, through which other developers will be notified of what changes have been made. Type git commit to realize it. $ git commit CRLF end-lines remover............................... ( no files to check ) Skipped yapf................................................. ( no files to check ) Skipped Check for added large files..............................................Passed Check for merge conflicts................................................Passed Check for broken symlinks................................................Passed Detect Private Key................................... ( no files to check ) Skipped Fix End of Files..................................... ( no files to check ) Skipped clang-formater....................................... ( no files to check ) Skipped [ my-cool-stuff c703c041 ] add test file 1 file changed, 0 insertions ( + ) , 0 deletions ( - ) create mode 100644 233 Attention needs to be paid\uff1ayou need to add commit message to trigger CI test.The command is as follows: # Touch CI single test of develop branch $ git commit -m \"test=develop\" # Touch CI single test of release/1.1 branch $ git commit -m \"test=release/1.1\"","title":"Commit"},{"location":"development/local_dev_guide/#keep-the-latest-local-repository","text":"It needs to keep up with the latest code of original repository( https://github.com/baidu/bfe \uff09before Pull Request. Check the name of current remote repository with git remote . $ git remote origin $ git remote -v origin https://github.com/USERNAME/bfe ( fetch ) origin https://github.com/USERNAME/bfe ( push ) origin is the name of remote repository that we clone, which is also the BFE under your own account. Next we create a remote host of an original BFE and name it upstream. $ git remote add upstream https://github.com/baidu/bfe $ git remote origin upstream Get the latest code of upstream and update current branch. $ git fetch upstream $ git pull upstream develop","title":"Keep the latest local repository"},{"location":"development/local_dev_guide/#push-to-remote-repository","text":"Push local modification to GitHub(https://github.com/USERNAME/bfe). # submit it to remote git the branch my-cool-stuff of origin $ git push origin my-cool-stuff","title":"Push to remote repository"},{"location":"development/release_regulation/","text":"BFE Release Regulation BFE development follows git-flow branching model and Semantic Versioning . Branch Regulation BFE development follows git-flow , but makes some minor differences for github. For the official bfe repository, developers should follow git-flow . 'master' branch is the stable branch. Latest commit of the 'master' branch is unit-tested and regression-tested. 'develop' branch is the development branch. Every commit of the 'develop' branch is unit-tested, but not regression-tested. 'release/vX.Y.Z' branch is the temporary branch created for release. The code on this branch is undergoing regression testing. For the forked bfe repository, developers don't need to strictly abide the git-flow(http://nvie.com/posts/a-successful-git-branching-model/). Each branch of the forked repository is equivalent to feature branch. Specific Suggestions are as follows: Developers synchronize 'develop' branches of the forked repository with that of the official repository. Developers create 'feature' branch from 'develop' branch of the forked repository. After completion of 'feature' branch development, developers submit 'Pull Request' to the official repository for code review. During the review process, developers may continue to modify and submit code in their feature branches. In addition, the 'bugfix' branch is also maintained in the developer's forked repository. Different from the feature branch, developers should submit 'Pull Request' from the 'bugfix' branch to 'master', 'develop' and possibly 'release/vX.Y.Z' branches of the official repository respectively. Release Regulation Follow the following procedures to release a new version: Create a new branch from the 'develop' branch with the name 'release/vX.Y.Z'. For example, release/v0.10.0 Tag the version of the new branch with 'X.Y.Z-rc.N' (N is patch number). The first tag is'0.10.0-rc.1', the second tag is '0.10.0-rc.2', and so on. For the submission of this version, do the following: Modify version information in 'VERSION' file. Test the functional correctness of the version. If it fails, fixing all the bugs in the 'release/vX.Y.Z' branch, and return to the second step with patch number added by 1. Complete the writing of Release Note . Merge the 'release/vX.Y.Z' branch into the master branch, and delete the 'release/vX.Y.Z' branch. Merge 'master' branches into the 'develop' branch. Tag the latest commit of the master branch with 'vX.Y.Z' Note: Once a release branch has been created, it is generally not allowed to merge 'release/vX.Y.Z' from the 'develop' branch. This ensures that the 'release/vX.Y.Z' branch is frozen, making it easy for QA to test. When the 'release/vX.Y.Z' branch exists, merge the 'bugfix' branch into the 'master', 'develop' and 'release/vX.Y.Z' branches at the same time, if there are bugfix behaviors.","title":"Releasing process"},{"location":"development/release_regulation/#bfe-release-regulation","text":"BFE development follows git-flow branching model and Semantic Versioning .","title":"BFE Release Regulation"},{"location":"development/release_regulation/#branch-regulation","text":"BFE development follows git-flow , but makes some minor differences for github. For the official bfe repository, developers should follow git-flow . 'master' branch is the stable branch. Latest commit of the 'master' branch is unit-tested and regression-tested. 'develop' branch is the development branch. Every commit of the 'develop' branch is unit-tested, but not regression-tested. 'release/vX.Y.Z' branch is the temporary branch created for release. The code on this branch is undergoing regression testing. For the forked bfe repository, developers don't need to strictly abide the git-flow(http://nvie.com/posts/a-successful-git-branching-model/). Each branch of the forked repository is equivalent to feature branch. Specific Suggestions are as follows: Developers synchronize 'develop' branches of the forked repository with that of the official repository. Developers create 'feature' branch from 'develop' branch of the forked repository. After completion of 'feature' branch development, developers submit 'Pull Request' to the official repository for code review. During the review process, developers may continue to modify and submit code in their feature branches. In addition, the 'bugfix' branch is also maintained in the developer's forked repository. Different from the feature branch, developers should submit 'Pull Request' from the 'bugfix' branch to 'master', 'develop' and possibly 'release/vX.Y.Z' branches of the official repository respectively.","title":"Branch Regulation"},{"location":"development/release_regulation/#release-regulation","text":"Follow the following procedures to release a new version: Create a new branch from the 'develop' branch with the name 'release/vX.Y.Z'. For example, release/v0.10.0 Tag the version of the new branch with 'X.Y.Z-rc.N' (N is patch number). The first tag is'0.10.0-rc.1', the second tag is '0.10.0-rc.2', and so on. For the submission of this version, do the following: Modify version information in 'VERSION' file. Test the functional correctness of the version. If it fails, fixing all the bugs in the 'release/vX.Y.Z' branch, and return to the second step with patch number added by 1. Complete the writing of Release Note . Merge the 'release/vX.Y.Z' branch into the master branch, and delete the 'release/vX.Y.Z' branch. Merge 'master' branches into the 'develop' branch. Tag the latest commit of the master branch with 'vX.Y.Z' Note: Once a release branch has been created, it is generally not allowed to merge 'release/vX.Y.Z' from the 'develop' branch. This ensures that the 'release/vX.Y.Z' branch is frozen, making it easy for QA to test. When the 'release/vX.Y.Z' branch exists, merge the 'bugfix' branch into the 'master', 'develop' and 'release/vX.Y.Z' branches at the same time, if there are bugfix behaviors.","title":"Release Regulation"},{"location":"development/source_code_layout/","text":"BFE Source Code Directory Structure Protocol bfe_net : common utility for net bfe_http : implementation of HTTP protocol bfe_tls : implementation of TLS protocol bfe_http2 : implementation of HTTP2 protocol bfe_spdy : implementation of SPDY protocol bfe_stream : implementation of TLS/TCP proxy bfe_websocket : implementation WebSocket protocl bfe_proxy : implementation of Proxy protocol Routing and Balancing bfe_route : implementation of routing bfe_balance : implementation of load balancing Modules bfe_module : module framework bfe_modules : implementation of various modules Server bfe_server : implementation of core server Utils bfe_basic : defines basic data type bfe_config : implementation of config bfe_debug : defines debug flags for important components bfe_util : common utility functions","title":"Source code layout"},{"location":"development/source_code_layout/#bfe-source-code-directory-structure","text":"","title":"BFE Source Code Directory Structure"},{"location":"development/source_code_layout/#protocol","text":"bfe_net : common utility for net bfe_http : implementation of HTTP protocol bfe_tls : implementation of TLS protocol bfe_http2 : implementation of HTTP2 protocol bfe_spdy : implementation of SPDY protocol bfe_stream : implementation of TLS/TCP proxy bfe_websocket : implementation WebSocket protocl bfe_proxy : implementation of Proxy protocol","title":"Protocol"},{"location":"development/source_code_layout/#routing-and-balancing","text":"bfe_route : implementation of routing bfe_balance : implementation of load balancing","title":"Routing and Balancing"},{"location":"development/source_code_layout/#modules","text":"bfe_module : module framework bfe_modules : implementation of various modules","title":"Modules"},{"location":"development/source_code_layout/#server","text":"bfe_server : implementation of core server","title":"Server"},{"location":"development/source_code_layout/#utils","text":"bfe_basic : defines basic data type bfe_config : implementation of config bfe_debug : defines debug flags for important components bfe_util : common utility functions","title":"Utils"},{"location":"development/submit_pr_guide/","text":"Guide of submitting PR to Github Create an Issue and finish Pull Request Create an Issue to describe your problem and keep its number. Switch to the branch you have created and click New pull request . Switch to targeted branch. A note of resolve #Issue number in PR description results in automatic close of corresponding Issue after the merge of PR. More details can be viewed here . Then please wait for review. If there is any need to make a modification, you can update corresponding branch in origin following the steps above. Pass unit tests Every new commit in your Pull Request will trigger CI unit tests, so please make sure that necessary comments have been included in your commit message. Please refer to commit Please note the procedure of CI unit tests in your Pull Request which will be finished in several hours. You only need to focus on CI projects associated with your submitted branch. For example, there is no need to check whether release/1.1 pass test or not if you submit code to develop branch. Green ticks after all tests means that your commit has passed all unit tests. Red cross after the tests means your commit hasn't passed certain unit test. Please click detail to view bug details and make a screenshot of bug, then add it as a comment in your Pull Request. Our stuff will help you check it. Delete remote branch We can delete branches of remote repository in PR page after your PR is successfully merged into master repository. We can also delete the branch of remote repository with git push origin :the_branch_name , such as: $ git push origin :my-cool-stuff Delete local branch Finally,we delete local branch $ git checkout develop # switch to develop branch $ git branch -D my-cool-stuff # delete my-cool-stuff branch And now we finish a full process of code contribution Certain regulations about submitting code In order that reviewers focus on code in the code review, please follow these rules every time you submit your code: 1\uff09Make sure that unit tests in Travis-CI pass through successfully.If it fails,it means problems have been found in submitted code which will not be reviewed by reviewer. 2\uff09Before the submit of PUll Request: Please note the number of commit: Reason\uff1aIt will bother reviewers a lot if a dozen of commits are submitted after modification of only one file and only a few modifications are updated in every commit. Reviewers have to check commit one by one to figure out the modification. And sometimes it needs to take the overlap among commits into consideration. Suggestion\uff1aKeep commit concise as much as possible at every submit. You can make a supplyment to the previous commit with git commit --amend . About several commits having been pushed to remote repository, you can refer to squash commits after push \u3002 Pay attention to the name of every commit: It would be better to abstract the content of present commit and be not too arbitrary. 3\uff09If you have tackled with problems of an Issue, please add fix #issue_number to the first comment area of PULL Request.Then the corresponding Issue will be closed automatically after the merge of PULL Request. Keywords are including:close, closes, closed, fix, fixes, fixed, resolve, resolves, resolved. Please select appropriate word. Please refer to Closing issues via commit messages for more details. In addition, please follow the following regulations in response to the suggestion of reviewers: 1\uff09A reply to every comment of reviewers\uff08It's a fundamental complimentary conduct in open source community.An expression of appreciation is a need for help from others): If you adopt the suggestion of reviewer and make a modification accordingly, it's courteous to reply with a simple Done . Please clarify your reason to the disagreenment 2\uff09If there are many suggestions Please show general modification Please follow start a review to give your reply,instead of directly replying for that every comment will result in sending an email causing email disaster.","title":"Sumbit PR"},{"location":"development/submit_pr_guide/#guide-of-submitting-pr-to-github","text":"","title":"Guide of submitting PR to Github"},{"location":"development/submit_pr_guide/#create-an-issue-and-finish-pull-request","text":"Create an Issue to describe your problem and keep its number. Switch to the branch you have created and click New pull request . Switch to targeted branch. A note of resolve #Issue number in PR description results in automatic close of corresponding Issue after the merge of PR. More details can be viewed here . Then please wait for review. If there is any need to make a modification, you can update corresponding branch in origin following the steps above.","title":"Create an Issue and finish Pull Request"},{"location":"development/submit_pr_guide/#pass-unit-tests","text":"Every new commit in your Pull Request will trigger CI unit tests, so please make sure that necessary comments have been included in your commit message. Please refer to commit Please note the procedure of CI unit tests in your Pull Request which will be finished in several hours. You only need to focus on CI projects associated with your submitted branch. For example, there is no need to check whether release/1.1 pass test or not if you submit code to develop branch. Green ticks after all tests means that your commit has passed all unit tests. Red cross after the tests means your commit hasn't passed certain unit test. Please click detail to view bug details and make a screenshot of bug, then add it as a comment in your Pull Request. Our stuff will help you check it.","title":"Pass unit tests"},{"location":"development/submit_pr_guide/#delete-remote-branch","text":"We can delete branches of remote repository in PR page after your PR is successfully merged into master repository. We can also delete the branch of remote repository with git push origin :the_branch_name , such as: $ git push origin :my-cool-stuff","title":"Delete remote branch"},{"location":"development/submit_pr_guide/#delete-local-branch","text":"Finally,we delete local branch $ git checkout develop # switch to develop branch $ git branch -D my-cool-stuff # delete my-cool-stuff branch And now we finish a full process of code contribution","title":"Delete local branch"},{"location":"development/submit_pr_guide/#certain-regulations-about-submitting-code","text":"In order that reviewers focus on code in the code review, please follow these rules every time you submit your code: 1\uff09Make sure that unit tests in Travis-CI pass through successfully.If it fails,it means problems have been found in submitted code which will not be reviewed by reviewer. 2\uff09Before the submit of PUll Request: Please note the number of commit: Reason\uff1aIt will bother reviewers a lot if a dozen of commits are submitted after modification of only one file and only a few modifications are updated in every commit. Reviewers have to check commit one by one to figure out the modification. And sometimes it needs to take the overlap among commits into consideration. Suggestion\uff1aKeep commit concise as much as possible at every submit. You can make a supplyment to the previous commit with git commit --amend . About several commits having been pushed to remote repository, you can refer to squash commits after push \u3002 Pay attention to the name of every commit: It would be better to abstract the content of present commit and be not too arbitrary. 3\uff09If you have tackled with problems of an Issue, please add fix #issue_number to the first comment area of PULL Request.Then the corresponding Issue will be closed automatically after the merge of PULL Request. Keywords are including:close, closes, closed, fix, fixes, fixed, resolve, resolves, resolved. Please select appropriate word. Please refer to Closing issues via commit messages for more details. In addition, please follow the following regulations in response to the suggestion of reviewers: 1\uff09A reply to every comment of reviewers\uff08It's a fundamental complimentary conduct in open source community.An expression of appreciation is a need for help from others): If you adopt the suggestion of reviewer and make a modification accordingly, it's courteous to reply with a simple Done . Please clarify your reason to the disagreenment 2\uff09If there are many suggestions Please show general modification Please follow start a review to give your reply,instead of directly replying for that every comment will result in sending an email causing email disaster.","title":"Certain regulations about submitting code"},{"location":"development/write_doc_guide/","text":"How to contribute documentation BFE encourages you to contribute documentation. If your written or translated documents meet our requirements, your documents will be available on the bfe-networks.com website and on Github for BFE users. BFE's documentation is mainly divided into the following categories: Beginner's Guide: to help users get started and inspired; User Guides: to provide users with a tutorial of basic operations in BFE; Developer Guides: to meet the needs of developers; Our documentation supports contributions in format of Markdown (GitHub style) . Once the document is written, you can use the preview tool to check how the document appears to verify that your document is displayed correctly on the official website. How to use the preview tool Install its dependencies Before doing this, please make sure your operating system has gitbook installed. Take the ubuntu system as an example, run: $ sudo apt-get update && apt-get install -y npm $ sudo npm install -g gitbook-cli Clone related repository: First download the full repository: $ git clone https://github.com/baidu/bfe Run document site locally Change to base directory of documents which you want to load and build(docs/LANG), run: $ cd docs/en_us/ $ gitbook serve --port 8000 ... Serving book on http://localhost:8000 Then: open your browser and navigate to http://localhost:8000. The site may take a few seconds to load because the building takes a certain amount of time* Contriubute documents All content should be written in Markdown (GitHub style). Contribute new documents Create a new .md file or modify an existing article in the repository you are currently working on Add the new document name to the corresponding index file (SUMMARY.md) Run the preview tool Run the preview tool in base directory of documents (docs/LANG) $ cd docs/en_us/ $ gitbook serve --port 8000 Preview modification Open your browser and navigate to http://localhost:8000 . On the page to be updated, click Refresh Content at the top right corner. Pull Request for your changes The steps to submit changes and PR can refer to How to contribute code Help improve preview tool We encourage your contributions to all aspects of the platform and supportive contents. You can Fork or Clone repository, ask questions and feedback, or submit bugs on issues. For details, please refer to the Development Guide .","title":"Contribute documents"},{"location":"development/write_doc_guide/#how-to-contribute-documentation","text":"BFE encourages you to contribute documentation. If your written or translated documents meet our requirements, your documents will be available on the bfe-networks.com website and on Github for BFE users. BFE's documentation is mainly divided into the following categories: Beginner's Guide: to help users get started and inspired; User Guides: to provide users with a tutorial of basic operations in BFE; Developer Guides: to meet the needs of developers; Our documentation supports contributions in format of Markdown (GitHub style) . Once the document is written, you can use the preview tool to check how the document appears to verify that your document is displayed correctly on the official website.","title":"How to contribute documentation"},{"location":"development/write_doc_guide/#how-to-use-the-preview-tool","text":"","title":"How to use the preview tool"},{"location":"development/write_doc_guide/#install-its-dependencies","text":"Before doing this, please make sure your operating system has gitbook installed. Take the ubuntu system as an example, run: $ sudo apt-get update && apt-get install -y npm $ sudo npm install -g gitbook-cli","title":"Install its dependencies"},{"location":"development/write_doc_guide/#clone-related-repository","text":"First download the full repository: $ git clone https://github.com/baidu/bfe","title":"Clone related repository:"},{"location":"development/write_doc_guide/#run-document-site-locally","text":"Change to base directory of documents which you want to load and build(docs/LANG), run: $ cd docs/en_us/ $ gitbook serve --port 8000 ... Serving book on http://localhost:8000 Then: open your browser and navigate to http://localhost:8000. The site may take a few seconds to load because the building takes a certain amount of time*","title":"Run document site locally"},{"location":"development/write_doc_guide/#contriubute-documents","text":"All content should be written in Markdown (GitHub style).","title":"Contriubute documents"},{"location":"development/write_doc_guide/#contribute-new-documents","text":"Create a new .md file or modify an existing article in the repository you are currently working on Add the new document name to the corresponding index file (SUMMARY.md)","title":"Contribute new documents"},{"location":"development/write_doc_guide/#run-the-preview-tool","text":"Run the preview tool in base directory of documents (docs/LANG) $ cd docs/en_us/ $ gitbook serve --port 8000","title":"Run the preview tool"},{"location":"development/write_doc_guide/#preview-modification","text":"Open your browser and navigate to http://localhost:8000 . On the page to be updated, click Refresh Content at the top right corner.","title":"Preview modification"},{"location":"development/write_doc_guide/#pull-request-for-your-changes","text":"The steps to submit changes and PR can refer to How to contribute code","title":"Pull Request for your changes"},{"location":"development/write_doc_guide/#help-improve-preview-tool","text":"We encourage your contributions to all aspects of the platform and supportive contents. You can Fork or Clone repository, ask questions and feedback, or submit bugs on issues. For details, please refer to the Development Guide .","title":"Help improve preview tool"},{"location":"development/module/bfe_callback/","text":"BFE Callbacks Callback Points in forwarding process The Callback Points in the forwarding process are shown below. List of Callback Points There are 9 callback points in BFE: HandleAccept: after TCP connection with client is established. HandleHandshake: after SSL/TLS handshake with client is finished. HandleBeforeLocation: before the destination product for the request is identified. HandleFoundProduct: after the destination product is identified. HandleAfterLocation: after the destionation cluster is identified. HandleForward: after the destionation subcluster is identified, and before the request is forwarded. HandleReadResponse: after response from backend is received by BFE. HandleRequestFinish: after response from backend is forwarded by BFE. HandleFinish: after connection with client is closed. The definition of callback points is in /bfe_module/bfe_callback.go Return Values of Callback Function BFE takes different actions based on the return values of the callback functions. The return values and the actions are defined as follows: BfeHandlerFinish: send response, then close connection. BfeHandlerGoOn: go on to next callback function. BfeHandlerRedirect: redirect directly. BfeHandlerResponse: send response. BfeHandlerClose: close connection without sending response. The definition of return values is in /bfe_module/bfe_handler_list.go Types of Callback Functions The format of callback functions may be different for different callback points. There are 5 types of callback functions. - HandlersAccept: Handler for processing connection estalishment - HandlersRequest: Handler for processing request received - HandlersForward: Handler for request forwarding process - HandlersResponse: Handler for processing response received - HandlersFinish: Handler for processing connection close The types of callback function are defined in /bfe_module/bfe_handler_list.go The following describes each type of callback functions in detail Note: For the meaning of type int in the return value below, please refer to \"Return Value of Callback Function\" section above. HandlersAccept Applicable callback points: HandleAccept HandleHandshake Function prototype: handler(session *bfe_basic.Session) int HandlersRequest Applicable callback point: HandleBeforeLocation HandleFoundProduct HandleAfterLocation Function prototype: handler(req bfe_basic.Request) (int, bfe_http.Response) HandlersForward Applicable callback point: HandleForward Function prototype: handler(req *bfe_basic.Request) int HandlersResponse Applicable callback point: HandleReadResponse HandleRequestFinish Function prototype: handler(req bfe_basic.Request, res bfe_http.Response) int HandlersFinish Applicable callback point: HandleFinish Function prototype: handler(session *bfe_basic.Session) int","title":"BFE callback introduction"},{"location":"development/module/bfe_callback/#bfe-callbacks","text":"","title":"BFE Callbacks"},{"location":"development/module/bfe_callback/#callback-points-in-forwarding-process","text":"The Callback Points in the forwarding process are shown below.","title":"Callback Points in forwarding process"},{"location":"development/module/bfe_callback/#list-of-callback-points","text":"There are 9 callback points in BFE: HandleAccept: after TCP connection with client is established. HandleHandshake: after SSL/TLS handshake with client is finished. HandleBeforeLocation: before the destination product for the request is identified. HandleFoundProduct: after the destination product is identified. HandleAfterLocation: after the destionation cluster is identified. HandleForward: after the destionation subcluster is identified, and before the request is forwarded. HandleReadResponse: after response from backend is received by BFE. HandleRequestFinish: after response from backend is forwarded by BFE. HandleFinish: after connection with client is closed. The definition of callback points is in /bfe_module/bfe_callback.go","title":"List of Callback Points"},{"location":"development/module/bfe_callback/#return-values-of-callback-function","text":"BFE takes different actions based on the return values of the callback functions. The return values and the actions are defined as follows: BfeHandlerFinish: send response, then close connection. BfeHandlerGoOn: go on to next callback function. BfeHandlerRedirect: redirect directly. BfeHandlerResponse: send response. BfeHandlerClose: close connection without sending response. The definition of return values is in /bfe_module/bfe_handler_list.go","title":"Return Values of Callback Function"},{"location":"development/module/bfe_callback/#types-of-callback-functions","text":"The format of callback functions may be different for different callback points. There are 5 types of callback functions. - HandlersAccept: Handler for processing connection estalishment - HandlersRequest: Handler for processing request received - HandlersForward: Handler for request forwarding process - HandlersResponse: Handler for processing response received - HandlersFinish: Handler for processing connection close The types of callback function are defined in /bfe_module/bfe_handler_list.go The following describes each type of callback functions in detail Note: For the meaning of type int in the return value below, please refer to \"Return Value of Callback Function\" section above.","title":"Types of Callback Functions"},{"location":"development/module/bfe_callback/#handlersaccept","text":"Applicable callback points: HandleAccept HandleHandshake Function prototype: handler(session *bfe_basic.Session) int","title":"HandlersAccept"},{"location":"development/module/bfe_callback/#handlersrequest","text":"Applicable callback point: HandleBeforeLocation HandleFoundProduct HandleAfterLocation Function prototype: handler(req bfe_basic.Request) (int, bfe_http.Response)","title":"HandlersRequest"},{"location":"development/module/bfe_callback/#handlersforward","text":"Applicable callback point: HandleForward Function prototype: handler(req *bfe_basic.Request) int","title":"HandlersForward"},{"location":"development/module/bfe_callback/#handlersresponse","text":"Applicable callback point: HandleReadResponse HandleRequestFinish Function prototype: handler(req bfe_basic.Request, res bfe_http.Response) int","title":"HandlersResponse"},{"location":"development/module/bfe_callback/#handlersfinish","text":"Applicable callback point: HandleFinish Function prototype: handler(session *bfe_basic.Session) int","title":"HandlersFinish"},{"location":"development/module/how_to_write_module/","text":"How to Write a Module Overview When writing a module for BFE, the following aspects should be considered: How to load configuration How to write and register callback functions How to expose internal states mod_block is used as an example for ease of understanding.\uff08 /bfe_modules/mod_block \uff09 Load Configuration Types of configuration For a given module, there are 2 types of configuration: - Static configuration: be loaded when BFE starts + There is only one such configuration file for each module + The name of the configuration file is the same as the module name. It is suffixed with .conf + Example: mod_block.conf - Dynamic configuration: be loaded when BFE starts. It can also be hot-reloaded without restarting BFE. + There can be one or more such configuration files for each module + The name of the configuration file usually ends with .data + Example: block_rules.data and ip_blacklist.data in mod_block Placement of configuration files The configuration files of the modules should be placed in /conf/{module_name} Example: Configuration files of mod_block are located in /conf/mod_block Verification of configuration Configuration files are verified whenever they are loaded, regardless of static or dynamic configuration. - BFE fails to start if the configuration files fails to be loaded. - BFE will continue to run if dynamic configuration fails to be hot-reloaded. Hot-reload of dynamic configuration For dynamic configurations, it is required to register callback function on dedicated web server. Hot-reload of dynamic configuration can be triggered by accessing specified URL. Example: In the init function of mod_block, there is some logic as follows, used to register callback function for configuration reload( mod_block.go ) // register web handler for reload err = whs.RegisterHandler(web_monitor.WebHandleReload, m.name, m.loadConfData) if err != nil { ... } Write and register callback functions Write callback functions Write callback functions for appropriate callback point. Note that for different callback points, definition of callback functions may be different. Definition of callback points and callback functions in BFE can be found in bfe_callback . Example: there are two callback functions defined in mod_block( mod_block.go ) func ( m * ModuleBlock ) globalBlockHandler ( session * bfe_basic . Session ) int { ... } func ( m * ModuleBlock ) productBlockHandler ( request * bfe_basic . Request ) ( int , * bfe_http . Response ) { ... } Register callback functions Callback functions should be registered when the module is initialized. Example: registration of callback functions in mod_block is as follows( mod_block.go ) func ( m * ModuleBlock ) Init ( cbs * bfe_module . BfeCallbacks , whs * web_monitor . WebHandlers , cr string ) error { ... // register handler err = cbs . AddFilter ( bfe_module . HandleAccept , m . globalBlockHandler ) if err != nil { ... } err = cbs . AddFilter ( bfe_module . HandleFoundProduct , m . productBlockHandler ) if err != nil { ... } ... } Expose module internal states For each BFE module, it is strongly recommended to expose enough internal states. To expose internal states of a module, do the following 3 steps: - Define state variables - Register callback function for exposing internal states - Insert code for doing statistic Define state variables Firstly, design statistical metrics and define them as member variables. Example: define ModuleBlockState in mod_block ( mod_block.go ) type ModuleBlockState struct { ConnTotal *metrics.Counter // all connnetion checked ConnAccept *metrics.Counter // connection passed ConnRefuse *metrics.Counter // connection refused ReqTotal *metrics.Counter // all request in ReqToCheck *metrics.Counter // request to check ReqAccept *metrics.Counter // request accepted ReqRefuse *metrics.Counter // request refused WrongCommand *metrics.Counter // request with condition satisfied, but wrong command } Secondly, define a member variable of type ModuleBlockState in ModuleBlock. Also define a member variable of type Metrics for related calculations. type ModuleBlock struct { ... state ModuleBlockState // module state metrics metrics.Metrics ... Thirdly, do initialization in constructor function. func NewModuleBlock() *ModuleBlock { m := new(ModuleBlock) m.name = ModBlock m.metrics.Init(&m.state, ModBlock, 0) ... } Register a callback function that exposes the internal state In order to expose internal status, callback function should be implemented. Example: In mod_block, there is logic as follows, where monitorHandlers () is the callback function( mod_block.go ) func ( m * ModuleBlock ) getState ( params map [ string ] [] string ) ( [] byte , error ) { s : = m . metrics . GetAll () return s . Format ( params ) } func ( m * ModuleBlock ) getStateDiff ( params map [ string ] [] string ) ( [] byte , error ) { s : = m . metrics . GetDiff () return s . Format ( params ) } func ( m * ModuleBlock ) monitorHandlers () map [ string ] interface {} { handlers : = map [ string ] interface {}{ m . name : m . getState , m . name + \".diff\" : m . getStateDiff , } return handlers } Then register callback function during module initialization. // register web handler for monitor err = web_monitor.RegisterHandlers(whs, web_monitor.WebHandleMonitor, m.monitorHandlers()) if err != nil { ... } Insert code for statistic Insert some code for doing statistic. Example: mod_block.go func (m *ModuleBlock) globalBlockHandler(session *bfe_basic.Session) int { ... m.state.ConnTotal.Inc(1) ... }","title":"How to write a module"},{"location":"development/module/how_to_write_module/#how-to-write-a-module","text":"","title":"How to Write a Module"},{"location":"development/module/how_to_write_module/#overview","text":"When writing a module for BFE, the following aspects should be considered: How to load configuration How to write and register callback functions How to expose internal states mod_block is used as an example for ease of understanding.\uff08 /bfe_modules/mod_block \uff09","title":"Overview"},{"location":"development/module/how_to_write_module/#load-configuration","text":"","title":"Load Configuration"},{"location":"development/module/how_to_write_module/#types-of-configuration","text":"For a given module, there are 2 types of configuration: - Static configuration: be loaded when BFE starts + There is only one such configuration file for each module + The name of the configuration file is the same as the module name. It is suffixed with .conf + Example: mod_block.conf - Dynamic configuration: be loaded when BFE starts. It can also be hot-reloaded without restarting BFE. + There can be one or more such configuration files for each module + The name of the configuration file usually ends with .data + Example: block_rules.data and ip_blacklist.data in mod_block","title":"Types of configuration"},{"location":"development/module/how_to_write_module/#placement-of-configuration-files","text":"The configuration files of the modules should be placed in /conf/{module_name} Example: Configuration files of mod_block are located in /conf/mod_block","title":"Placement of configuration files"},{"location":"development/module/how_to_write_module/#verification-of-configuration","text":"Configuration files are verified whenever they are loaded, regardless of static or dynamic configuration. - BFE fails to start if the configuration files fails to be loaded. - BFE will continue to run if dynamic configuration fails to be hot-reloaded.","title":"Verification of configuration"},{"location":"development/module/how_to_write_module/#hot-reload-of-dynamic-configuration","text":"For dynamic configurations, it is required to register callback function on dedicated web server. Hot-reload of dynamic configuration can be triggered by accessing specified URL. Example: In the init function of mod_block, there is some logic as follows, used to register callback function for configuration reload( mod_block.go ) // register web handler for reload err = whs.RegisterHandler(web_monitor.WebHandleReload, m.name, m.loadConfData) if err != nil { ... }","title":"Hot-reload of dynamic configuration"},{"location":"development/module/how_to_write_module/#write-and-register-callback-functions","text":"","title":"Write and register callback functions"},{"location":"development/module/how_to_write_module/#write-callback-functions","text":"Write callback functions for appropriate callback point. Note that for different callback points, definition of callback functions may be different. Definition of callback points and callback functions in BFE can be found in bfe_callback . Example: there are two callback functions defined in mod_block( mod_block.go ) func ( m * ModuleBlock ) globalBlockHandler ( session * bfe_basic . Session ) int { ... } func ( m * ModuleBlock ) productBlockHandler ( request * bfe_basic . Request ) ( int , * bfe_http . Response ) { ... }","title":"Write callback functions"},{"location":"development/module/how_to_write_module/#register-callback-functions","text":"Callback functions should be registered when the module is initialized. Example: registration of callback functions in mod_block is as follows( mod_block.go ) func ( m * ModuleBlock ) Init ( cbs * bfe_module . BfeCallbacks , whs * web_monitor . WebHandlers , cr string ) error { ... // register handler err = cbs . AddFilter ( bfe_module . HandleAccept , m . globalBlockHandler ) if err != nil { ... } err = cbs . AddFilter ( bfe_module . HandleFoundProduct , m . productBlockHandler ) if err != nil { ... } ... }","title":"Register callback functions"},{"location":"development/module/how_to_write_module/#expose-module-internal-states","text":"For each BFE module, it is strongly recommended to expose enough internal states. To expose internal states of a module, do the following 3 steps: - Define state variables - Register callback function for exposing internal states - Insert code for doing statistic","title":"Expose module internal states"},{"location":"development/module/how_to_write_module/#define-state-variables","text":"Firstly, design statistical metrics and define them as member variables. Example: define ModuleBlockState in mod_block ( mod_block.go ) type ModuleBlockState struct { ConnTotal *metrics.Counter // all connnetion checked ConnAccept *metrics.Counter // connection passed ConnRefuse *metrics.Counter // connection refused ReqTotal *metrics.Counter // all request in ReqToCheck *metrics.Counter // request to check ReqAccept *metrics.Counter // request accepted ReqRefuse *metrics.Counter // request refused WrongCommand *metrics.Counter // request with condition satisfied, but wrong command } Secondly, define a member variable of type ModuleBlockState in ModuleBlock. Also define a member variable of type Metrics for related calculations. type ModuleBlock struct { ... state ModuleBlockState // module state metrics metrics.Metrics ... Thirdly, do initialization in constructor function. func NewModuleBlock() *ModuleBlock { m := new(ModuleBlock) m.name = ModBlock m.metrics.Init(&m.state, ModBlock, 0) ... }","title":"Define state variables"},{"location":"development/module/how_to_write_module/#register-a-callback-function-that-exposes-the-internal-state","text":"In order to expose internal status, callback function should be implemented. Example: In mod_block, there is logic as follows, where monitorHandlers () is the callback function( mod_block.go ) func ( m * ModuleBlock ) getState ( params map [ string ] [] string ) ( [] byte , error ) { s : = m . metrics . GetAll () return s . Format ( params ) } func ( m * ModuleBlock ) getStateDiff ( params map [ string ] [] string ) ( [] byte , error ) { s : = m . metrics . GetDiff () return s . Format ( params ) } func ( m * ModuleBlock ) monitorHandlers () map [ string ] interface {} { handlers : = map [ string ] interface {}{ m . name : m . getState , m . name + \".diff\" : m . getStateDiff , } return handlers } Then register callback function during module initialization. // register web handler for monitor err = web_monitor.RegisterHandlers(whs, web_monitor.WebHandleMonitor, m.monitorHandlers()) if err != nil { ... }","title":"Register a callback function that exposes the internal state"},{"location":"development/module/how_to_write_module/#insert-code-for-statistic","text":"Insert some code for doing statistic. Example: mod_block.go func (m *ModuleBlock) globalBlockHandler(session *bfe_basic.Session) int { ... m.state.ConnTotal.Inc(1) ... }","title":"Insert code for statistic"},{"location":"development/module/overview/","text":"Overview of BFE Module Introduction BFE supports plugin architecture that make it possible to develop new features rapidly by writing plugins (i.e. modules). How BFE Module works Multiple callback points are provided in the forwarding process in BFE. When initializing a module, callback functions are registered on specified callback points. On processing each request/connection, when reaching a certain callback point, all registered callback functions are executed sequentially. Dive into BFE Module BFE callback mechanism How to write a BFE module","title":"Overview"},{"location":"development/module/overview/#overview-of-bfe-module","text":"","title":"Overview of BFE Module"},{"location":"development/module/overview/#introduction","text":"BFE supports plugin architecture that make it possible to develop new features rapidly by writing plugins (i.e. modules).","title":"Introduction"},{"location":"development/module/overview/#how-bfe-module-works","text":"Multiple callback points are provided in the forwarding process in BFE. When initializing a module, callback functions are registered on specified callback points. On processing each request/connection, when reaching a certain callback point, all registered callback functions are executed sequentially.","title":"How BFE Module works"},{"location":"development/module/overview/#dive-into-bfe-module","text":"BFE callback mechanism How to write a BFE module","title":"Dive into BFE Module"},{"location":"example/block/","text":"Block Scenario Suppose our service has been attacked from a specific IP, or a specific API (such as issuing a voucher) has been maliciously called; we want to block specified traffic, such as: block attack traffic comes from some fixed IP\uff082.2.2.2\uff09 block attack traffic targeted at some specific PATH\uff08/bonus\uff09 Configuration Modify example configurations (conf/) as the following steps: Step 1. Modify conf/bfe.conf and enable mod_block Modules = mod_block # enable mod_block Step 2. Modify conf/mod_block/mod_block.conf and configure path of global ip blacklist and block rules [basic] ProductRulePath = mod_block/block_rules.data IPBlacklistPath = mod_block/ip_blacklist.data Step 3. Configure global blacklist (conf/mod_block/ip_blacklist.data) Config ip address list, such as 2.2.2.2 2.2.2.2 Step 4. Configure block rules (conf/mod_block/block_rules.data) { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"action\": { \"cmd\": \"CLOSE\", \"params\": [] }, \"name\": \"block bonus\", \"cond\": \"req_path_in(\\\"/bonus\\\", false)\" }] } } Step 5. Verify configured rules curl -v -H \"host: example.org\" \"http://127.1:8080/bonus\" The connection will be closed by bfe immediately.","title":"Traffic blocking"},{"location":"example/block/#block","text":"","title":"Block"},{"location":"example/block/#scenario","text":"Suppose our service has been attacked from a specific IP, or a specific API (such as issuing a voucher) has been maliciously called; we want to block specified traffic, such as: block attack traffic comes from some fixed IP\uff082.2.2.2\uff09 block attack traffic targeted at some specific PATH\uff08/bonus\uff09","title":"Scenario"},{"location":"example/block/#configuration","text":"Modify example configurations (conf/) as the following steps: Step 1. Modify conf/bfe.conf and enable mod_block Modules = mod_block # enable mod_block Step 2. Modify conf/mod_block/mod_block.conf and configure path of global ip blacklist and block rules [basic] ProductRulePath = mod_block/block_rules.data IPBlacklistPath = mod_block/ip_blacklist.data Step 3. Configure global blacklist (conf/mod_block/ip_blacklist.data) Config ip address list, such as 2.2.2.2 2.2.2.2 Step 4. Configure block rules (conf/mod_block/block_rules.data) { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"action\": { \"cmd\": \"CLOSE\", \"params\": [] }, \"name\": \"block bonus\", \"cond\": \"req_path_in(\\\"/bonus\\\", false)\" }] } } Step 5. Verify configured rules curl -v -H \"host: example.org\" \"http://127.1:8080/bonus\" The connection will be closed by bfe immediately.","title":"Configuration"},{"location":"example/client_auth/","text":"TLS client authentication Scenario The server needs to authenticate the client using TLS client authentication Configuration steps Step 1. Generate root certificate openssl genrsa - out root . key 2048 openssl req - new - x509 - days 365 - key root . key - out root . crt Step 2. Create a client certificate signing request openssl genrsa - out client . key 2048 openssl req - new - out client . csr - key client . key Step 3. Generate client certificate echo \"extendedKeyUsage = clientAuth\" > openssl . cnf openssl x509 - req - in client . csr - out client . crt - signkey client . key - CA root . crt - CAkey root . key - days 365 - extfile openssl . cnf Step4. Configure layer 4 load balancing service. In this example, HAproxy is used as the layer 4 load balancing service, and VIP is passed to BFE using PROXY protocol. HAproxy can be installed through \"apt install haproxy\" on Ubuntu system. For more details, see www.haproxy.org . Configuration file(haproxy.cfg) example\uff1a global defaults mode tcp balance leastconn timeout client 3000 ms timeout server 3000 ms timeout connect 3000 ms frontend fr_server_http bind 0 . 0 . 0 . 0 : 7080 default_backend bk_server_http backend bk_server_http server srv1 0 . 0 . 0 . 0 : 8080 maxconn 2048 send - proxy frontend fr_server_https bind 0 . 0 . 0 . 0 : 7443 default_backend bk_server_https backend bk_server_https server srv1 0 . 0 . 0 . 0 : 8443 maxconn 2048 send - proxy Run HAproxy haproxy -f haproxy.cfg Step 5. Configure BFE. Copy root.crt to tls_conf/client_ca directory(note: the suffix of root certificate should be \".crt\"). [server] ... Layer4LoadBalancer = \"PROXY\" ... [HttpsBasic] ... clientCABaseDir = tls_conf/client_ca ... Modify conf/tls_conf_rule.data and set \"ClientAuth\" to true and \"ClientCAName\" to name of the root certificate. { \"Version\": \"12\", \"DefaultNextProtos\": [ \"http/1.1\" ], \"Config\": { \"example_product\": { \"VipConf\": [ \"127.0.0.1\" ], \"SniConf\": null, \"CertName\": \"example.org\", \"NextProtos\": [ \"h2;rate=0;isw=65535;mcs=200;level=0\", \"http/1.1\" ], \"Grade\": \"C\", \"ClientAuth\": true, \"ClientCAName\": \"root\" } } } Run BFE. ./bfe -c ../conf Step 6. Verify configuration openssl s_client -connect 127.0.0.1:7443 -cert client.crt -key client.key -state -quiet","title":"TLS mutual authentication"},{"location":"example/client_auth/#tls-client-authentication","text":"","title":"TLS client authentication"},{"location":"example/client_auth/#scenario","text":"The server needs to authenticate the client using TLS client authentication","title":"Scenario"},{"location":"example/client_auth/#configuration-steps","text":"Step 1. Generate root certificate openssl genrsa - out root . key 2048 openssl req - new - x509 - days 365 - key root . key - out root . crt Step 2. Create a client certificate signing request openssl genrsa - out client . key 2048 openssl req - new - out client . csr - key client . key Step 3. Generate client certificate echo \"extendedKeyUsage = clientAuth\" > openssl . cnf openssl x509 - req - in client . csr - out client . crt - signkey client . key - CA root . crt - CAkey root . key - days 365 - extfile openssl . cnf Step4. Configure layer 4 load balancing service. In this example, HAproxy is used as the layer 4 load balancing service, and VIP is passed to BFE using PROXY protocol. HAproxy can be installed through \"apt install haproxy\" on Ubuntu system. For more details, see www.haproxy.org . Configuration file(haproxy.cfg) example\uff1a global defaults mode tcp balance leastconn timeout client 3000 ms timeout server 3000 ms timeout connect 3000 ms frontend fr_server_http bind 0 . 0 . 0 . 0 : 7080 default_backend bk_server_http backend bk_server_http server srv1 0 . 0 . 0 . 0 : 8080 maxconn 2048 send - proxy frontend fr_server_https bind 0 . 0 . 0 . 0 : 7443 default_backend bk_server_https backend bk_server_https server srv1 0 . 0 . 0 . 0 : 8443 maxconn 2048 send - proxy Run HAproxy haproxy -f haproxy.cfg Step 5. Configure BFE. Copy root.crt to tls_conf/client_ca directory(note: the suffix of root certificate should be \".crt\"). [server] ... Layer4LoadBalancer = \"PROXY\" ... [HttpsBasic] ... clientCABaseDir = tls_conf/client_ca ... Modify conf/tls_conf_rule.data and set \"ClientAuth\" to true and \"ClientCAName\" to name of the root certificate. { \"Version\": \"12\", \"DefaultNextProtos\": [ \"http/1.1\" ], \"Config\": { \"example_product\": { \"VipConf\": [ \"127.0.0.1\" ], \"SniConf\": null, \"CertName\": \"example.org\", \"NextProtos\": [ \"h2;rate=0;isw=65535;mcs=200;level=0\", \"http/1.1\" ], \"Grade\": \"C\", \"ClientAuth\": true, \"ClientCAName\": \"root\" } } } Run BFE. ./bfe -c ../conf Step 6. Verify configuration openssl s_client -connect 127.0.0.1:7443 -cert client.crt -key client.key -state -quiet","title":"Configuration steps"},{"location":"example/guide/","text":"Beginner's Guide This guide gives a basic introdction to some tasks that can be done with bfe. It is supposed that bfe is already installed on your machine. If it is not, see Installing bfe . Traffic forwarding Traffic blocking Request redirect Request rewrite TLS mutual authentication","title":"Overview"},{"location":"example/guide/#beginners-guide","text":"This guide gives a basic introdction to some tasks that can be done with bfe. It is supposed that bfe is already installed on your machine. If it is not, see Installing bfe . Traffic forwarding Traffic blocking Request redirect Request rewrite TLS mutual authentication","title":"Beginner's Guide"},{"location":"example/redirect/","text":"Redirect Scenario Redirect HTTP to HTTPS for requests visiting example.org Connfiguration Modify the example configurations (conf/) as the following steps: Step 1. modify conf/bfe.conf and enable mod_redirect Modules = mod_redirect Step 2. modify mod_redirect basic configuration (conf/mod_redirect/mod_redirect.conf) [basic] DataPath = mod_redirect/redirect.data Step 3. modify redirect rule configuration (conf/mod_redirect/redirect.data), and add following rules. { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"Cond\": \"!req_proto_secure() && req_host_in(\\\"example.org\\\")\", \"Actions\": [{ \"Cmd\": \"SCHEME_SET\", \"Params\": [ \"https\" ] }], \"Status\": 301 }] } } Step 4. Verify configured rules curl -H \"host: example.org\" \"http://127.1:8080/test\" The repsonse stuatus code should be 301, and the value of Location response Header should be \"https://example.org/test\".","title":"Request redirect"},{"location":"example/redirect/#redirect","text":"","title":"Redirect"},{"location":"example/redirect/#scenario","text":"Redirect HTTP to HTTPS for requests visiting example.org","title":"Scenario"},{"location":"example/redirect/#connfiguration","text":"Modify the example configurations (conf/) as the following steps: Step 1. modify conf/bfe.conf and enable mod_redirect Modules = mod_redirect Step 2. modify mod_redirect basic configuration (conf/mod_redirect/mod_redirect.conf) [basic] DataPath = mod_redirect/redirect.data Step 3. modify redirect rule configuration (conf/mod_redirect/redirect.data), and add following rules. { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"Cond\": \"!req_proto_secure() && req_host_in(\\\"example.org\\\")\", \"Actions\": [{ \"Cmd\": \"SCHEME_SET\", \"Params\": [ \"https\" ] }], \"Status\": 301 }] } } Step 4. Verify configured rules curl -H \"host: example.org\" \"http://127.1:8080/test\" The repsonse stuatus code should be 301, and the value of Location response Header should be \"https://example.org/test\".","title":"Connfiguration"},{"location":"example/rewrite/","text":"Rewrite Scenario The service API '/service' is upgraded to '/v1/service' during evolution. To avoid from breaking existing clients, bfe rewrites requests with path '/service' and then forward to the backend service. Configuration Modify example configurations (conf/) as the following steps: Step 1. Modify conf/bfe.conf and enable mod_rewrite Modules = mod_rewrite # enable mod_rewrite Step 2. Modify conf/mod_rewrite/mod_rewrite.conf and set the rule configuration file [basic] DataPath = mod_rewrite/rewrite.data Step 3. Modify rewrite rules configuration { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"Cond\": \"req_path_prefix_in(\\\"/service\\\", false)\", \"Actions\": [{ \"Cmd\": \"PATH_PREFIX_ADD\", \"Params\": [ \"/v1/\" ] }], \"Last\": true }] } } Step 4. Verify configured rules curl -H \"host: example.org\" \"http://127.1:8080/service\" The final path of request received by service 'cluster_demo_dynamic' is 'v1/service'.","title":"Request rewrite"},{"location":"example/rewrite/#rewrite","text":"","title":"Rewrite"},{"location":"example/rewrite/#scenario","text":"The service API '/service' is upgraded to '/v1/service' during evolution. To avoid from breaking existing clients, bfe rewrites requests with path '/service' and then forward to the backend service.","title":"Scenario"},{"location":"example/rewrite/#configuration","text":"Modify example configurations (conf/) as the following steps: Step 1. Modify conf/bfe.conf and enable mod_rewrite Modules = mod_rewrite # enable mod_rewrite Step 2. Modify conf/mod_rewrite/mod_rewrite.conf and set the rule configuration file [basic] DataPath = mod_rewrite/rewrite.data Step 3. Modify rewrite rules configuration { \"Version\": \"init version\", \"Config\": { \"example_product\": [{ \"Cond\": \"req_path_prefix_in(\\\"/service\\\", false)\", \"Actions\": [{ \"Cmd\": \"PATH_PREFIX_ADD\", \"Params\": [ \"/v1/\" ] }], \"Last\": true }] } } Step 4. Verify configured rules curl -H \"host: example.org\" \"http://127.1:8080/service\" The final path of request received by service 'cluster_demo_dynamic' is 'v1/service'.","title":"Configuration"},{"location":"example/route/","text":"Route Scenario Imagine we have an http server which has two instances. One is responsible for processing static file requests, and the other is responsible for dynamic requests. Host\uff1aexample.org Requests that start with / static are forwarded to the static file service instance with address 10.0.0.1:8001 Other requests are forwarded to dynamic service instance with address 10.0.0.1:8002 Configuration Modify example configurations (conf/) as the following steps: Step 1. Config path of forward rules in conf/bfe.conf hostRuleConf = server_data_conf / host_rule . data routeRuleConf = server_data_conf / route_rule . data clusterConf = server_data_conf / cluster_conf . data clusterTableConf = cluster_conf / cluster_table . data gslbConf = cluster_conf / gslb . data Step 2. Config host rules (conf/server_data_conf/host_rule.data) { \"Version\": \"init version\", \"DefaultProduct\": null, \"Hosts\": { \"exampleTag\":[ \"example.org\" // host name: example.org=>host tag: exampleTag ] }, \"HostTags\": { \"example_product\":[ \"exampleTag\" // host tag: exampleTag=>product name: example_product ] } } Step 3. Config cluster configuration (conf/server_data_conf/cluster_conf.data) Note: Set health check params and use default value for other params { \"Version\": \"init version\", \"Config\": { \"cluster_demo_static\": { \"CheckConf\": { // health check config \"Schem\": \"http\", \"Uri\": \"/health_check\", \"Host\": \"example.org\", \"StatusCode\": 200 } }, \"cluster_demo_dynamic\": { \"CheckConf\": { // health check config \"Schem\": \"http\", \"Uri\": \"/health_check\", \"Host\": \"example.org\", \"StatusCode\": 200 } } } } Step 4. Config instances of cluster (conf/cluster_conf/cluster_table.data) { \"Version\": \"init version\", \"Config\": { \"cluster_demo_static\": { // cluster => sub_cluster => instance list \"demo_static.all\": [{ // subcluster: demo_static.all \"Addr\": \"10.0.0.1\", \"Name\": \"static.A\", \"Port\": 8001, \"Weight\": 1 }] }, \"cluster_demo_dynamic\": { \"demo_dynamic.all\": [{ \"Addr\": \"10.0.0.1\", \"Name\": \"dynamic.A\", \"Port\": 8002, \"Weight\": 1 }] } } } Step 5. Config gslb configuration (conf/cluster_conf/gslb.data) { \"Hostname\": \"\", \"Ts\": \"0\", \"Clusters\": { \"cluster_demo_static\": { // cluster => weight of subcluster \"GSLB_BLACKHOLE\": 0, // GSLB_BLACKHOLE == 0 means do not discard traffic \"demo_static.all\": 100 // weight 100 means all traffic routes to demo_static.all }, \"cluster_demo_dynamic\": { \"GSLB_BLACKHOLE\": 0, \"demo_dynamic.all\": 100 } } } Step 6. Config route rules (conf/server_data_conf/route_rule.data) { \"Version\": \"init version\", \"ProductRule\": { \"example_product\": [ // product => route rules { \"Cond\": \"req_path_prefix_in(\\\"/static\\\", false)\", \"ClusterName\": \"cluster_demo_static\" }, { \"Cond\": \"default_t()\", \"ClusterName\": \"cluster_demo_dynamic\" } ] } } Step 7. Verify configured rules curl - H \"host: example.org\" \"http://127.1:8080/static/test.html\" # request will route to 10 . 0 . 0 . 1 : 8001 curl - H \"host: example.org\" \"http://127.1:8080/api/test\" # request will route to 10 . 0 . 0 . 1 : 8002","title":"Traffic forwarding"},{"location":"example/route/#route","text":"","title":"Route"},{"location":"example/route/#scenario","text":"Imagine we have an http server which has two instances. One is responsible for processing static file requests, and the other is responsible for dynamic requests. Host\uff1aexample.org Requests that start with / static are forwarded to the static file service instance with address 10.0.0.1:8001 Other requests are forwarded to dynamic service instance with address 10.0.0.1:8002","title":"Scenario"},{"location":"example/route/#configuration","text":"Modify example configurations (conf/) as the following steps: Step 1. Config path of forward rules in conf/bfe.conf hostRuleConf = server_data_conf / host_rule . data routeRuleConf = server_data_conf / route_rule . data clusterConf = server_data_conf / cluster_conf . data clusterTableConf = cluster_conf / cluster_table . data gslbConf = cluster_conf / gslb . data Step 2. Config host rules (conf/server_data_conf/host_rule.data) { \"Version\": \"init version\", \"DefaultProduct\": null, \"Hosts\": { \"exampleTag\":[ \"example.org\" // host name: example.org=>host tag: exampleTag ] }, \"HostTags\": { \"example_product\":[ \"exampleTag\" // host tag: exampleTag=>product name: example_product ] } } Step 3. Config cluster configuration (conf/server_data_conf/cluster_conf.data) Note: Set health check params and use default value for other params { \"Version\": \"init version\", \"Config\": { \"cluster_demo_static\": { \"CheckConf\": { // health check config \"Schem\": \"http\", \"Uri\": \"/health_check\", \"Host\": \"example.org\", \"StatusCode\": 200 } }, \"cluster_demo_dynamic\": { \"CheckConf\": { // health check config \"Schem\": \"http\", \"Uri\": \"/health_check\", \"Host\": \"example.org\", \"StatusCode\": 200 } } } } Step 4. Config instances of cluster (conf/cluster_conf/cluster_table.data) { \"Version\": \"init version\", \"Config\": { \"cluster_demo_static\": { // cluster => sub_cluster => instance list \"demo_static.all\": [{ // subcluster: demo_static.all \"Addr\": \"10.0.0.1\", \"Name\": \"static.A\", \"Port\": 8001, \"Weight\": 1 }] }, \"cluster_demo_dynamic\": { \"demo_dynamic.all\": [{ \"Addr\": \"10.0.0.1\", \"Name\": \"dynamic.A\", \"Port\": 8002, \"Weight\": 1 }] } } } Step 5. Config gslb configuration (conf/cluster_conf/gslb.data) { \"Hostname\": \"\", \"Ts\": \"0\", \"Clusters\": { \"cluster_demo_static\": { // cluster => weight of subcluster \"GSLB_BLACKHOLE\": 0, // GSLB_BLACKHOLE == 0 means do not discard traffic \"demo_static.all\": 100 // weight 100 means all traffic routes to demo_static.all }, \"cluster_demo_dynamic\": { \"GSLB_BLACKHOLE\": 0, \"demo_dynamic.all\": 100 } } } Step 6. Config route rules (conf/server_data_conf/route_rule.data) { \"Version\": \"init version\", \"ProductRule\": { \"example_product\": [ // product => route rules { \"Cond\": \"req_path_prefix_in(\\\"/static\\\", false)\", \"ClusterName\": \"cluster_demo_static\" }, { \"Cond\": \"default_t()\", \"ClusterName\": \"cluster_demo_dynamic\" } ] } } Step 7. Verify configured rules curl - H \"host: example.org\" \"http://127.1:8080/static/test.html\" # request will route to 10 . 0 . 0 . 1 : 8001 curl - H \"host: example.org\" \"http://127.1:8080/api/test\" # request will route to 10 . 0 . 0 . 1 : 8002","title":"Configuration"},{"location":"faq/configuration/","text":"Configuration FAQ How to enable TLS client authentication For more details, see TLS client authentication example How to enable HTTP2 protocol See conf/tls_conf/tls_rule_conf.data configuration example","title":"Configuration"},{"location":"faq/configuration/#configuration-faq","text":"","title":"Configuration FAQ"},{"location":"faq/configuration/#how-to-enable-tls-client-authentication","text":"For more details, see TLS client authentication example","title":"How to enable TLS client authentication"},{"location":"faq/configuration/#how-to-enable-http2-protocol","text":"See conf/tls_conf/tls_rule_conf.data configuration example","title":"How to enable HTTP2 protocol"},{"location":"faq/development/","text":"Development FAQ How to develop a module For more details, see introduction to module development","title":"Development"},{"location":"faq/development/#development-faq","text":"","title":"Development FAQ"},{"location":"faq/development/#how-to-develop-a-module","text":"For more details, see introduction to module development","title":"How to develop a module"},{"location":"faq/installation/","text":"Installation FAQ Go get timeout during installation Set GOPROXY enviroment variable as follows (go1.13+): $ go env -w GO111MODULE = on $ go env -w GOPROXY = https://goproxy.cn,direct For more details, see https://goproxy.cn or https://goproxy.io Whether compilation on MAC/Windows OS is supported or not ? It is supported since BFE v0.7.0","title":"Installation"},{"location":"faq/installation/#installation-faq","text":"","title":"Installation FAQ"},{"location":"faq/installation/#go-get-timeout-during-installation","text":"Set GOPROXY enviroment variable as follows (go1.13+): $ go env -w GO111MODULE = on $ go env -w GOPROXY = https://goproxy.cn,direct For more details, see https://goproxy.cn or https://goproxy.io","title":"Go get timeout during installation"},{"location":"faq/installation/#whether-compilation-on-macwindows-os-is-supported-or-not","text":"It is supported since BFE v0.7.0","title":"Whether compilation on MAC/Windows OS is supported or not ?"},{"location":"faq/performance/","text":"Performance FAQ How to tune performance Please feedback to bfe-osc@baidu.com for help, and performance tuning guide will be provided in future version.","title":"Performance"},{"location":"faq/performance/#performance-faq","text":"","title":"Performance FAQ"},{"location":"faq/performance/#how-to-tune-performance","text":"Please feedback to bfe-osc@baidu.com for help, and performance tuning guide will be provided in future version.","title":"How to tune performance"},{"location":"installation/install/","text":"Installation notes Installation method Install from source Install using binaries Install using go Install using snap Platform support Operating System Description Linux OS Support Recommended development and deployment system Mac OS Support Windows OS Support","title":"Overview"},{"location":"installation/install/#installation-notes","text":"","title":"Installation notes"},{"location":"installation/install/#installation-method","text":"Install from source Install using binaries Install using go Install using snap","title":"Installation method"},{"location":"installation/install/#platform-support","text":"Operating System Description Linux OS Support Recommended development and deployment system Mac OS Support Windows OS Support","title":"Platform support"},{"location":"installation/install_from_source/","text":"Install from source code Prerequisites golang 1.13+ git Download source code $ git clone https://github.com/baidu/bfe Build Execute the following command to build bfe: $ cd bfe $ make Execute the following command to run tests: $ make test Executable object file location: $ file output/bin/bfe output/bin/bfe: ELF 64 -bit LSB executable, ... Run Run BFE with example configuration files: $ cd output/bin/ $ ./bfe -c ../conf -l ../log Further reading Get started with Beginner's Guide","title":"Install from source"},{"location":"installation/install_from_source/#install-from-source-code","text":"","title":"Install from source code"},{"location":"installation/install_from_source/#prerequisites","text":"golang 1.13+ git","title":"Prerequisites"},{"location":"installation/install_from_source/#download-source-code","text":"$ git clone https://github.com/baidu/bfe","title":"Download source code"},{"location":"installation/install_from_source/#build","text":"Execute the following command to build bfe: $ cd bfe $ make Execute the following command to run tests: $ make test Executable object file location: $ file output/bin/bfe output/bin/bfe: ELF 64 -bit LSB executable, ...","title":"Build"},{"location":"installation/install_from_source/#run","text":"Run BFE with example configuration files: $ cd output/bin/ $ ./bfe -c ../conf -l ../log","title":"Run"},{"location":"installation/install_from_source/#further-reading","text":"Get started with Beginner's Guide","title":"Further reading"},{"location":"installation/install_using_binaries/","text":"Install using binaries Download binaries Download the latest release of BFE for your platfrom. Installation Extract the files to the installation directory: $ tar zxvf bfe_<version>_<os>_<arch>.tar.gz Run Run BFE with example configuration files: $ cd bfe/bin $ ./bfe -c ../conf -l ../log Further reading Get started with Beginner's Guide","title":"Install using binaries"},{"location":"installation/install_using_binaries/#install-using-binaries","text":"","title":"Install using binaries"},{"location":"installation/install_using_binaries/#download-binaries","text":"Download the latest release of BFE for your platfrom.","title":"Download binaries"},{"location":"installation/install_using_binaries/#installation","text":"Extract the files to the installation directory: $ tar zxvf bfe_<version>_<os>_<arch>.tar.gz","title":"Installation"},{"location":"installation/install_using_binaries/#run","text":"Run BFE with example configuration files: $ cd bfe/bin $ ./bfe -c ../conf -l ../log","title":"Run"},{"location":"installation/install_using_binaries/#further-reading","text":"Get started with Beginner's Guide","title":"Further reading"},{"location":"installation/install_using_go/","text":"Install using go Prerequisites golang 1.13+ Installation Get the source code and install $ go get github.com/baidu/bfe Executable object file location is ${GOPATH}/bin/bfe Run Run BFE with example configuration files: $ cd ${ GOPATH } /bin/ $ ./bfe -c ${ GOPATH } /src/github.com/baidu/bfe/conf/ Further reading Get started with Beginner's Guide","title":"Install using go"},{"location":"installation/install_using_go/#install-using-go","text":"","title":"Install using go"},{"location":"installation/install_using_go/#prerequisites","text":"golang 1.13+","title":"Prerequisites"},{"location":"installation/install_using_go/#installation","text":"Get the source code and install $ go get github.com/baidu/bfe Executable object file location is ${GOPATH}/bin/bfe","title":"Installation"},{"location":"installation/install_using_go/#run","text":"Run BFE with example configuration files: $ cd ${ GOPATH } /bin/ $ ./bfe -c ${ GOPATH } /src/github.com/baidu/bfe/conf/","title":"Run"},{"location":"installation/install_using_go/#further-reading","text":"Get started with Beginner's Guide","title":"Further reading"},{"location":"installation/install_using_snap/","text":"Install using snap Prerequisite snap Installation Execute the following command to install bfe: $ sudo snap install --edge bfe Configuration files location: /var/snap/bfe/common/conf/ Log files location: /var/snap/bfe/common/log Run Execute the following command to run bfe: $ sudo /snap/bin/bfe Further reading Get started with Beginner's Guide","title":"Install using snap"},{"location":"installation/install_using_snap/#install-using-snap","text":"","title":"Install using snap"},{"location":"installation/install_using_snap/#prerequisite","text":"snap","title":"Prerequisite"},{"location":"installation/install_using_snap/#installation","text":"Execute the following command to install bfe: $ sudo snap install --edge bfe Configuration files location: /var/snap/bfe/common/conf/ Log files location: /var/snap/bfe/common/log","title":"Installation"},{"location":"installation/install_using_snap/#run","text":"Execute the following command to run bfe: $ sudo /snap/bin/bfe","title":"Run"},{"location":"installation/install_using_snap/#further-reading","text":"Get started with Beginner's Guide","title":"Further reading"},{"location":"introduction/balance/","text":"Request balancing Sub cluster level load balance In sub cluster level, load balance rules also can be configured. The rules define traffic weight which is distributed to each sub cluster\u3002 A special virtual sub cluster \"BLACKHOLE\" could be used to discard traffic\u3002 Example Consider following configuration\uff1a Two IDC\uff1aIDC1, IDC2 Two BFE cluster\uff1aBFE1, BFE2 Two backend sub cluster\uff1asub-cluster-1, sub-cluster-2 In BFE cluster(BFE1 and BFE2): BFE1\uff1a{sub-cluster-1:w11\uff0csub-cluster-2:w12, Blackhole:w1B} BFE2\uff1a{sub-cluster-1:w21\uff0csub-cluster-2:w22, Blackhole:w2B} Based on the weight in configuration, BFE distribute traffic to backend sub cluster. For example\uff0cif weight configuration {w11, w12, w1B} ={45\uff0c45\uff0c10}, percent of traffic to sub cluster is sub-cluster-1, sub-cluster-2 and Blackhole is 45%, 45% and 10%. Instance level load balance Usually, a sub cluster is composed of multiple instances. Within sub cluster, WRR\uff08weighted round robin) is used to distribute request among instance\u3002 Instance can be assign different weight based on its capacity\u3002 Health check BFE do health check for each backend instance. A instance has following two states: NORMAL state\uff1athe instance act normally in processing request. CHECKING state\uff1athe instance is abnormal and can't process request. BFE do health check periodically in this state. State switch: - NORMAL to CHECKING, when\uff1a - Consecutive failure, in connecting or sending request to the instance, exceed a threshhod. CHECKING to NORMAL, when\uff1a BFE receive correct response from backend instance for health check request. Retry in failure If request routing fail, BFE support retry the request in two levels\uff1a Re-route request within same sub cluster. Re-route request to other sub cluster. Connection pool TCP connection between BFE and backend instance support\uff1a short-lived connection\uff1aBFE route each request request to backend server with a new established TCP connection. connection pool\uff1a BFE maintain connection pool to instances. To an incoming request\uff1a if there is an available connection, reuse it. else establish a new TCP connection. After finish processing a request via a connection: If current size of connection pool is less than configured number, the connection is added into the pool. Else close the connection directly. Session stickiness BFE support session stickiness based on following identity of request request: - Source IP - Field in request header, cookie etc. Keep session in different routing level: - Sub cluster level: request of a session is sent to same sub cluster (may be different instance in this sub cluster). - Instance level: request of a session is sent to same instance.","title":"Traffic balancing"},{"location":"introduction/balance/#request-balancing","text":"","title":"Request balancing"},{"location":"introduction/balance/#sub-cluster-level-load-balance","text":"In sub cluster level, load balance rules also can be configured. The rules define traffic weight which is distributed to each sub cluster\u3002 A special virtual sub cluster \"BLACKHOLE\" could be used to discard traffic\u3002","title":"Sub cluster level load balance"},{"location":"introduction/balance/#example","text":"Consider following configuration\uff1a Two IDC\uff1aIDC1, IDC2 Two BFE cluster\uff1aBFE1, BFE2 Two backend sub cluster\uff1asub-cluster-1, sub-cluster-2 In BFE cluster(BFE1 and BFE2): BFE1\uff1a{sub-cluster-1:w11\uff0csub-cluster-2:w12, Blackhole:w1B} BFE2\uff1a{sub-cluster-1:w21\uff0csub-cluster-2:w22, Blackhole:w2B} Based on the weight in configuration, BFE distribute traffic to backend sub cluster. For example\uff0cif weight configuration {w11, w12, w1B} ={45\uff0c45\uff0c10}, percent of traffic to sub cluster is sub-cluster-1, sub-cluster-2 and Blackhole is 45%, 45% and 10%.","title":"Example"},{"location":"introduction/balance/#instance-level-load-balance","text":"Usually, a sub cluster is composed of multiple instances. Within sub cluster, WRR\uff08weighted round robin) is used to distribute request among instance\u3002 Instance can be assign different weight based on its capacity\u3002","title":"Instance level load balance"},{"location":"introduction/balance/#health-check","text":"BFE do health check for each backend instance. A instance has following two states: NORMAL state\uff1athe instance act normally in processing request. CHECKING state\uff1athe instance is abnormal and can't process request. BFE do health check periodically in this state. State switch: - NORMAL to CHECKING, when\uff1a - Consecutive failure, in connecting or sending request to the instance, exceed a threshhod. CHECKING to NORMAL, when\uff1a BFE receive correct response from backend instance for health check request.","title":"Health check"},{"location":"introduction/balance/#retry-in-failure","text":"If request routing fail, BFE support retry the request in two levels\uff1a Re-route request within same sub cluster. Re-route request to other sub cluster.","title":"Retry in failure"},{"location":"introduction/balance/#connection-pool","text":"TCP connection between BFE and backend instance support\uff1a short-lived connection\uff1aBFE route each request request to backend server with a new established TCP connection. connection pool\uff1a BFE maintain connection pool to instances. To an incoming request\uff1a if there is an available connection, reuse it. else establish a new TCP connection. After finish processing a request via a connection: If current size of connection pool is less than configured number, the connection is added into the pool. Else close the connection directly.","title":"Connection pool"},{"location":"introduction/balance/#session-stickiness","text":"BFE support session stickiness based on following identity of request request: - Source IP - Field in request header, cookie etc. Keep session in different routing level: - Sub cluster level: request of a session is sent to same sub cluster (may be different instance in this sub cluster). - Instance level: request of a session is sent to same instance.","title":"Session stickiness"},{"location":"introduction/comparison/","text":"Comparison to similar systems Here comparion will be made between BFE and several similar system. NOTE: Most of the projects below are under active development. Thus some of the information may become out of date. If that is the case please feedback to https://github.com/baidu/bfe/issues. Briefs of BFE and similar systems The brief decriptions of several systems are as follows: BFE: BFE is an open-source layer 7 load balancer. Nginx : nginx is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server. Traefik : Traefik is a modern HTTP reverse proxy and load balancer. Envoy : Envoy is an open source edge and service proxy, designed for cloud-native applications. Features Protocol Support All 4 systems support HTTPS and HTTP/2. Health Check BFE and Nginx only support \"passive\" health check. Traefik only supports \"active\" health check. Envoy supports active, passive and hybrid health check. NOTE: Nginx Plus (i.e., the commercial version of nginx) supports \"active\" health check. Instance-Level Load Balancing All 4 systems support instance-level load balancing. Cluster-Level Load Balancing BFE, Traefik and Envoy support cluster-level load balancing. Nginx doesn't have this feature. NOTE: Envoy supports global and distributed load balancing. Forwarding Rules BFE provides Condition Expression . Nginx uses regular expression. Traefik supports traffic classification based on request content. But it can't support flexible AND or OR logic. Envoy supports rules based on Domain, Path and Header. Extensibility Language Both BFE and Traefik are written in Golang Nginx is written in C and Lua. Envoy is written in C++. Pluggable All 4 systems support pluggable architecture. Cost for New Features Due to difference in language, cost for new features is lower for BFE and Traefik, while cost is higher for Nginx and Envoy. Resilience to exception With recovery mechanism of Golang, Panic can be caught in BFE and Traefik. Both system are immune to sudden crash. While Nginx and Envoy can do nothing with wrong memory usage. Debugging such a bug is very time-consuming. Maintenance Observability BFE provides rich internal status for external observation. Nginx and Traefik provide less internal status. Envoy also provides quite a lot internal status. Hot-reload of configuration All 4 systems support hot-reload of configuration. In Nginx, process must be restarted for the configuration to take effect, while active connections are terminated. NOTE: Nginx Plus supports hot-reload of configuration, with no process restart.","title":"Comparsion to similar systems"},{"location":"introduction/comparison/#comparison-to-similar-systems","text":"Here comparion will be made between BFE and several similar system. NOTE: Most of the projects below are under active development. Thus some of the information may become out of date. If that is the case please feedback to https://github.com/baidu/bfe/issues.","title":"Comparison to similar systems"},{"location":"introduction/comparison/#briefs-of-bfe-and-similar-systems","text":"The brief decriptions of several systems are as follows: BFE: BFE is an open-source layer 7 load balancer. Nginx : nginx is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server. Traefik : Traefik is a modern HTTP reverse proxy and load balancer. Envoy : Envoy is an open source edge and service proxy, designed for cloud-native applications.","title":"Briefs of BFE and similar systems"},{"location":"introduction/comparison/#features","text":"","title":"Features"},{"location":"introduction/comparison/#protocol-support","text":"All 4 systems support HTTPS and HTTP/2.","title":"Protocol Support"},{"location":"introduction/comparison/#health-check","text":"BFE and Nginx only support \"passive\" health check. Traefik only supports \"active\" health check. Envoy supports active, passive and hybrid health check. NOTE: Nginx Plus (i.e., the commercial version of nginx) supports \"active\" health check.","title":"Health Check"},{"location":"introduction/comparison/#instance-level-load-balancing","text":"All 4 systems support instance-level load balancing.","title":"Instance-Level Load Balancing"},{"location":"introduction/comparison/#cluster-level-load-balancing","text":"BFE, Traefik and Envoy support cluster-level load balancing. Nginx doesn't have this feature. NOTE: Envoy supports global and distributed load balancing.","title":"Cluster-Level Load Balancing"},{"location":"introduction/comparison/#forwarding-rules","text":"BFE provides Condition Expression . Nginx uses regular expression. Traefik supports traffic classification based on request content. But it can't support flexible AND or OR logic. Envoy supports rules based on Domain, Path and Header.","title":"Forwarding Rules"},{"location":"introduction/comparison/#extensibility","text":"","title":"Extensibility"},{"location":"introduction/comparison/#language","text":"Both BFE and Traefik are written in Golang Nginx is written in C and Lua. Envoy is written in C++.","title":"Language"},{"location":"introduction/comparison/#pluggable","text":"All 4 systems support pluggable architecture.","title":"Pluggable"},{"location":"introduction/comparison/#cost-for-new-features","text":"Due to difference in language, cost for new features is lower for BFE and Traefik, while cost is higher for Nginx and Envoy.","title":"Cost for New Features"},{"location":"introduction/comparison/#resilience-to-exception","text":"With recovery mechanism of Golang, Panic can be caught in BFE and Traefik. Both system are immune to sudden crash. While Nginx and Envoy can do nothing with wrong memory usage. Debugging such a bug is very time-consuming.","title":"Resilience to exception"},{"location":"introduction/comparison/#maintenance","text":"","title":"Maintenance"},{"location":"introduction/comparison/#observability","text":"BFE provides rich internal status for external observation. Nginx and Traefik provide less internal status. Envoy also provides quite a lot internal status.","title":"Observability"},{"location":"introduction/comparison/#hot-reload-of-configuration","text":"All 4 systems support hot-reload of configuration. In Nginx, process must be restarted for the configuration to take effect, while active connections are terminated. NOTE: Nginx Plus supports hot-reload of configuration, with no process restart.","title":"Hot-reload of configuration"},{"location":"introduction/forward_model/","text":"Traffic forwarding Step1-2\uff1aDNS query request host name\uff1ademo.example.com get IP address 6.6.6.6\uff08example\uff09 Step3\uff1aIP diagram is routed to POP of IDC1\uff0cand processed by layer 4 load balancer L4LB. Step4\uff1aL4LB forward diagram to BFE Step5\uff1aBFE receive HTTP request, identify which product the request belongs to: BFE uses field \"host\" in HTTP header to decide product. In this scenario, assume demo.example.com belongs to product \"demo\". Step6\uff1aIdentify a cluster of product \"demo\", which would handle this message. Based on configured distribution rule of product \"demo\", identify cluster \"demo-static\" in this product to handle the message . Step7\uff1aIdentify a sub cluster within \"demo-static\" Based on routing rule in \"demo-static\", identify sub cluster \"demo-static.idc1\" to handle this message. Step8\uff1aIdentify instance based on configured load balancing policy, identify instance as \"a-demo-static-1.idc1\". Step9\uff1arequest is sent to instance \"a-demo-static-1.idc1\". Step10\uff1aBFE receive response message from \"a-demo-static-1.idc1\". Step11-12\uff1aBFE send back response to client, via L4LB.","title":"Traffic fowarding model"},{"location":"introduction/forward_model/#traffic-forwarding","text":"Step1-2\uff1aDNS query request host name\uff1ademo.example.com get IP address 6.6.6.6\uff08example\uff09 Step3\uff1aIP diagram is routed to POP of IDC1\uff0cand processed by layer 4 load balancer L4LB. Step4\uff1aL4LB forward diagram to BFE Step5\uff1aBFE receive HTTP request, identify which product the request belongs to: BFE uses field \"host\" in HTTP header to decide product. In this scenario, assume demo.example.com belongs to product \"demo\". Step6\uff1aIdentify a cluster of product \"demo\", which would handle this message. Based on configured distribution rule of product \"demo\", identify cluster \"demo-static\" in this product to handle the message . Step7\uff1aIdentify a sub cluster within \"demo-static\" Based on routing rule in \"demo-static\", identify sub cluster \"demo-static.idc1\" to handle this message. Step8\uff1aIdentify instance based on configured load balancing policy, identify instance as \"a-demo-static-1.idc1\". Step9\uff1arequest is sent to instance \"a-demo-static-1.idc1\". Step10\uff1aBFE receive response message from \"a-demo-static-1.idc1\". Step11-12\uff1aBFE send back response to client, via L4LB.","title":"Traffic forwarding"},{"location":"introduction/getting_help/","text":"Getting help We are very interested in building a community around BFE. If you are interested in using it or need help, please feel free to contact us. Discussion about questions or requirements Welcome to submit issues at https://github.com/baidu/bfe/issues/new/choose, we will reply you in working days Reporting security vulnerabilities Security issues and bugs should be reported privately to bfe-security@baidu.com. Please do not open issues for anything you think might have a security implication. Contributing to BFE We sincerely appreciate your contribution. Please visit https://github.com/baidu/bfe and follow the workflow . Application for special cooperation Welcome to email us at bfe-osc@baidu.com","title":"Getting help"},{"location":"introduction/getting_help/#getting-help","text":"We are very interested in building a community around BFE. If you are interested in using it or need help, please feel free to contact us.","title":"Getting help"},{"location":"introduction/getting_help/#discussion-about-questions-or-requirements","text":"Welcome to submit issues at https://github.com/baidu/bfe/issues/new/choose, we will reply you in working days","title":"Discussion about questions or requirements"},{"location":"introduction/getting_help/#reporting-security-vulnerabilities","text":"Security issues and bugs should be reported privately to bfe-security@baidu.com. Please do not open issues for anything you think might have a security implication.","title":"Reporting security vulnerabilities"},{"location":"introduction/getting_help/#contributing-to-bfe","text":"We sincerely appreciate your contribution. Please visit https://github.com/baidu/bfe and follow the workflow .","title":"Contributing to BFE"},{"location":"introduction/getting_help/#application-for-special-cooperation","text":"Welcome to email us at bfe-osc@baidu.com","title":"Application for special cooperation"},{"location":"introduction/overview/","text":"Overview What is BFE BFE is an open-source layer 7 load balancer derived from proprietary Baidu Front End. Advantages Multiple protocols supported, including HTTP,HTTPS, SPDY, HTTP2, WebSocket, TLS, etc. Content based routing. Advanced domain-specific language is provided for describing user-defined routing rule. Multiple load balancing policies supported. Flexible plugin framework to extend functionality. Developer can add new features rapidly by writing plugins. Detailed built-in metrics available for monitoring service status.","title":"Overview"},{"location":"introduction/overview/#overview","text":"","title":"Overview"},{"location":"introduction/overview/#what-is-bfe","text":"BFE is an open-source layer 7 load balancer derived from proprietary Baidu Front End.","title":"What is BFE"},{"location":"introduction/overview/#advantages","text":"Multiple protocols supported, including HTTP,HTTPS, SPDY, HTTP2, WebSocket, TLS, etc. Content based routing. Advanced domain-specific language is provided for describing user-defined routing rule. Multiple load balancing policies supported. Flexible plugin framework to extend functionality. Developer can add new features rapidly by writing plugins. Detailed built-in metrics available for monitoring service status.","title":"Advantages"},{"location":"introduction/route/","text":"Request Routing In BFE configuration, a \"product\" could be composed of multiple clusters. User can define how requests are routed among the clusters. Request routing is based on the content of HTTP request. Rule configuration Fields in HTTP Header is used to define routing rule for distributing traffic in cluster level, for example: host, path, query, cookie, method, etc. BFE provide a \"Condition\" expression to define how to route request with special header. This is routing rule in cluster level load balance. If multiple rules are configured, BFE would match the rules in sequence. Matching procedure stop if one rule is matched. Example A product \"demo\", which needs process three kinds of traffic: static content traffic, \"post\" traffic, other traffic, then we can define three clusters \uff1a demo-static\uff1aserve static content demo-post\uff1aserve post request demo-main: serve other traffic To BFE configuration, following routing rules can be added: Rule 1: req_path_prefix_in(\"/static\", false) -> demo-static, which means requests with path prefixed with \"/static\" will be routed to cluster demo-static. Rule 2: req_method_in(\"POST\")&&req_path_prefix_in(\"/setting\",false) -> demo-post, which means that request which use method \"POST\" and is prefixed with \"/setting\" will be routed to cluster \"demo-post\". Rule 3: default -> demo-main, which means all request which doesn't match above rules will be sent to cluster \"demo-main\".","title":"Traffic routing"},{"location":"introduction/route/#request-routing","text":"In BFE configuration, a \"product\" could be composed of multiple clusters. User can define how requests are routed among the clusters. Request routing is based on the content of HTTP request.","title":"Request Routing"},{"location":"introduction/route/#rule-configuration","text":"Fields in HTTP Header is used to define routing rule for distributing traffic in cluster level, for example: host, path, query, cookie, method, etc. BFE provide a \"Condition\" expression to define how to route request with special header. This is routing rule in cluster level load balance. If multiple rules are configured, BFE would match the rules in sequence. Matching procedure stop if one rule is matched.","title":"Rule configuration"},{"location":"introduction/route/#example","text":"A product \"demo\", which needs process three kinds of traffic: static content traffic, \"post\" traffic, other traffic, then we can define three clusters \uff1a demo-static\uff1aserve static content demo-post\uff1aserve post request demo-main: serve other traffic To BFE configuration, following routing rules can be added: Rule 1: req_path_prefix_in(\"/static\", false) -> demo-static, which means requests with path prefixed with \"/static\" will be routed to cluster demo-static. Rule 2: req_method_in(\"POST\")&&req_path_prefix_in(\"/setting\",false) -> demo-post, which means that request which use method \"POST\" and is prefixed with \"/setting\" will be routed to cluster \"demo-post\". Rule 3: default -> demo-main, which means all request which doesn't match above rules will be sent to cluster \"demo-main\".","title":"Example"},{"location":"introduction/terminology/","text":"Terminology Product The product equals \"tenant\" in BFE, which has its own configuration, such as routing policy, permission, etc. Field \"host\" in HTTP header is used to identify product that the incoming message belongs to. Cluster Cluster means a set of backend servers which provide same functionality and process similar task. Usually\uff0ccluster span multiple IDC/region in scope. Sub Cluster A cluster may be composed of multiple sub clusters conceptually. Usally, backend servers within one IDC/region is defined as a sub cluster. Instance Instance is backend server. A sub cluster would contain multiple instances. To BFE\uff0ceach backend instance expose IP address + port to accept request.","title":"Terminology"},{"location":"introduction/terminology/#terminology","text":"","title":"Terminology"},{"location":"introduction/terminology/#product","text":"The product equals \"tenant\" in BFE, which has its own configuration, such as routing policy, permission, etc. Field \"host\" in HTTP header is used to identify product that the incoming message belongs to.","title":"Product"},{"location":"introduction/terminology/#cluster","text":"Cluster means a set of backend servers which provide same functionality and process similar task. Usually\uff0ccluster span multiple IDC/region in scope.","title":"Cluster"},{"location":"introduction/terminology/#sub-cluster","text":"A cluster may be composed of multiple sub clusters conceptually. Usally, backend servers within one IDC/region is defined as a sub cluster.","title":"Sub Cluster"},{"location":"introduction/terminology/#instance","text":"Instance is backend server. A sub cluster would contain multiple instances. To BFE\uff0ceach backend instance expose IP address + port to accept request.","title":"Instance"},{"location":"modules/modules/","text":"BFE Module mod_access mod_auth_basic mod_auth_jwt mod_block mod_compress mod_doh mod_errors mod_geo mod_header mod_http_code mod_key_log mod_logid mod_prison mod_redirect mod_rewrite mod_static mod_tag mod_trace mod_trust_clientip mod_userid","title":"BFE Module"},{"location":"modules/modules/#bfe-module","text":"mod_access mod_auth_basic mod_auth_jwt mod_block mod_compress mod_doh mod_errors mod_geo mod_header mod_http_code mod_key_log mod_logid mod_prison mod_redirect mod_rewrite mod_static mod_tag mod_trace mod_trust_clientip mod_userid","title":"BFE Module"},{"location":"modules/mod_access/mod_access/","text":"mod_access Introduction mod_access writes request logs and session logs in the specified format. Module Configuration Description conf/mod_access/mod_access.conf Config Item Description Log.LogPrefix String filename prefix for log Log.LogDir String directory of log files Log.RotateWhen String inteval to rotate log file Log.BackupCount Integer max number of rotated log files Template.RequestTemplate String template of request log Template.SessionTemplate String template of session log Example [Log] # filename prefix for log LogPrefix = access # access log directory LogDir = ../log # log rotate interval: M/H/D/MIDNIGHT/NEXTHOUR RotateWhen = NEXTHOUR # max number of rotated log files BackupCount = 2 [Template] # template of request log RequestTemplate = \"REQUEST_LOG $time clientip: $remote_addr serverip: $server_addr host: $host product: $product user_agent: ${User-Agent}req_header status: $status_code error: $error\" # template of session log SessionTemplate = \"SESSION_LOG $time clientip: $ses_clientip start_time: $ses_start_time end_time: $ses_end_time overhead: $ses_overhead read_total: $ses_read_total write_total: $ses_write_total keepalive_num: $ses_keepalive_num error: $ses_error\"","title":"mod_access"},{"location":"modules/mod_access/mod_access/#mod_access","text":"","title":"mod_access"},{"location":"modules/mod_access/mod_access/#introduction","text":"mod_access writes request logs and session logs in the specified format.","title":"Introduction"},{"location":"modules/mod_access/mod_access/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_access/mod_access/#description","text":"conf/mod_access/mod_access.conf Config Item Description Log.LogPrefix String filename prefix for log Log.LogDir String directory of log files Log.RotateWhen String inteval to rotate log file Log.BackupCount Integer max number of rotated log files Template.RequestTemplate String template of request log Template.SessionTemplate String template of session log","title":"Description"},{"location":"modules/mod_access/mod_access/#example","text":"[Log] # filename prefix for log LogPrefix = access # access log directory LogDir = ../log # log rotate interval: M/H/D/MIDNIGHT/NEXTHOUR RotateWhen = NEXTHOUR # max number of rotated log files BackupCount = 2 [Template] # template of request log RequestTemplate = \"REQUEST_LOG $time clientip: $remote_addr serverip: $server_addr host: $host product: $product user_agent: ${User-Agent}req_header status: $status_code error: $error\" # template of session log SessionTemplate = \"SESSION_LOG $time clientip: $ses_clientip start_time: $ses_start_time end_time: $ses_end_time overhead: $ses_overhead read_total: $ses_read_total write_total: $ses_write_total keepalive_num: $ses_keepalive_num error: $ses_error\"","title":"Example"},{"location":"modules/mod_auth_basic/mod_auth_basic/","text":"mod_auth_basic Introduction mod_auth_basic implements the HTTP basic authentication. Module Configuration Description conf/mod_auth_basic/mod_auth_basic.conf Config Item Description Basic.DataPath String path of rule configuration Log.OpenDebug Boolean whether enable debug log Default False Example [ basic ] DataPath = mod_auth_basic/auth_basic_rule.data [ log ] OpenDebug = false Rule Configuration Description Config Item Description Version String Version of config file Config Object Auth rules for each product Config{k} String Product name Config{v} Object A list of auth rules Config{v}[] Object A auth rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].UserFile String Path of password configuration Config{v}[].Realm String Realm, ie. protection space Default \"Restricted\" Description about password configuration: * The password configuration can be generated using htpasswd or openssl * Generated using openssl: printf \"user1:$(openssl passwd -apr1 123456)\\n\" >> ./userfile Password configuration example # user1, 123456 user1:$apr1$mI7SilJz$CWwYJyYKbhVDNl26sdUSh/ user2:{SHA}fEqNCco3Yq9h5ZUglD3CZJT4lBs=:user2, 123456 Example { \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"UserFile\" : \"../conf/mod_auth_basic/userfile\" , \"Realm\" : \"example_product\" } ] }, Version \": \" 20190101000000 \" }","title":"mod_auth_basic"},{"location":"modules/mod_auth_basic/mod_auth_basic/#mod_auth_basic","text":"","title":"mod_auth_basic"},{"location":"modules/mod_auth_basic/mod_auth_basic/#introduction","text":"mod_auth_basic implements the HTTP basic authentication.","title":"Introduction"},{"location":"modules/mod_auth_basic/mod_auth_basic/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_auth_basic/mod_auth_basic/#description","text":"conf/mod_auth_basic/mod_auth_basic.conf Config Item Description Basic.DataPath String path of rule configuration Log.OpenDebug Boolean whether enable debug log Default False","title":"Description"},{"location":"modules/mod_auth_basic/mod_auth_basic/#example","text":"[ basic ] DataPath = mod_auth_basic/auth_basic_rule.data [ log ] OpenDebug = false","title":"Example"},{"location":"modules/mod_auth_basic/mod_auth_basic/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_auth_basic/mod_auth_basic/#description_1","text":"Config Item Description Version String Version of config file Config Object Auth rules for each product Config{k} String Product name Config{v} Object A list of auth rules Config{v}[] Object A auth rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].UserFile String Path of password configuration Config{v}[].Realm String Realm, ie. protection space Default \"Restricted\" Description about password configuration: * The password configuration can be generated using htpasswd or openssl * Generated using openssl: printf \"user1:$(openssl passwd -apr1 123456)\\n\" >> ./userfile Password configuration example # user1, 123456 user1:$apr1$mI7SilJz$CWwYJyYKbhVDNl26sdUSh/ user2:{SHA}fEqNCco3Yq9h5ZUglD3CZJT4lBs=:user2, 123456","title":"Description"},{"location":"modules/mod_auth_basic/mod_auth_basic/#example_1","text":"{ \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"UserFile\" : \"../conf/mod_auth_basic/userfile\" , \"Realm\" : \"example_product\" } ] }, Version \": \" 20190101000000 \" }","title":"Example"},{"location":"modules/mod_auth_jwt/mod_auth_jwt/","text":"mod_auth_jwt Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_auth_jwt"},{"location":"modules/mod_auth_jwt/mod_auth_jwt/#mod_auth_jwt","text":"Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_auth_jwt"},{"location":"modules/mod_block/mod_block/","text":"mod_block Introduction mod_block blocks incoming connections/requests based on defined rules. Module Configuration Description conf/mod_block/mod_block.conf Config Item Description Basic.ProductRulePath path of product rule configuration Basic.IPBlacklistPath path of ip blacklist file Example [basic] # product rule config file path ProductRulePath = mod_block/block_rules.data # global ip blacklist file path IPBlacklistPath = mod_block/ip_blacklist.data Format of IPBlacklistPath file 192.168.1.253 192.168.1.254 192.168.1.250 Rule Configuration Description conf/mod_block/block_rules.data Config Item Description Version String Verson of config file Config Struct Block rules for each product Config{k} String Product name Config{v} Object a list of rules Config{v}[] Object a block rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Name String Name of rule Config{v}[].Action Object Action of rule Config{v}[].Action.Cmd String Name of action Config{v}[].Action.Params Object a list of action parameters Config{v}[].Action.Params[] String a action parameter Actions Action Description CLOSE Close the connection Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"action\" : { \"cmd\" : \"CLOSE\" , \"params\" : [] }, \"name\" : \"example rule\" , \"cond\" : \"req_path_in(\\\"/limit\\\", false)\" } ] } } Metrics Metric Description CONN_ACCEPT Counter for connection accepted CONN_REFUSE Counter for connection refused CONN_TOTAL Counter for all connnetion checked REQ_ACCEPT Counter for request accepted REQ_REFUSE Counter for request refused REQ_TOTAL Counter for all request in REQ_TO_CHECK Counter for request to check WRONG_COMMAND Counter for request with condition satisfied, but wrong command","title":"mod_block"},{"location":"modules/mod_block/mod_block/#mod_block","text":"","title":"mod_block"},{"location":"modules/mod_block/mod_block/#introduction","text":"mod_block blocks incoming connections/requests based on defined rules.","title":"Introduction"},{"location":"modules/mod_block/mod_block/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_block/mod_block/#description","text":"conf/mod_block/mod_block.conf Config Item Description Basic.ProductRulePath path of product rule configuration Basic.IPBlacklistPath path of ip blacklist file","title":"Description"},{"location":"modules/mod_block/mod_block/#example","text":"[basic] # product rule config file path ProductRulePath = mod_block/block_rules.data # global ip blacklist file path IPBlacklistPath = mod_block/ip_blacklist.data Format of IPBlacklistPath file 192.168.1.253 192.168.1.254 192.168.1.250","title":"Example"},{"location":"modules/mod_block/mod_block/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_block/mod_block/#description_1","text":"conf/mod_block/block_rules.data Config Item Description Version String Verson of config file Config Struct Block rules for each product Config{k} String Product name Config{v} Object a list of rules Config{v}[] Object a block rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Name String Name of rule Config{v}[].Action Object Action of rule Config{v}[].Action.Cmd String Name of action Config{v}[].Action.Params Object a list of action parameters Config{v}[].Action.Params[] String a action parameter","title":"Description"},{"location":"modules/mod_block/mod_block/#actions","text":"Action Description CLOSE Close the connection","title":"Actions"},{"location":"modules/mod_block/mod_block/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"action\" : { \"cmd\" : \"CLOSE\" , \"params\" : [] }, \"name\" : \"example rule\" , \"cond\" : \"req_path_in(\\\"/limit\\\", false)\" } ] } }","title":"Example"},{"location":"modules/mod_block/mod_block/#metrics","text":"Metric Description CONN_ACCEPT Counter for connection accepted CONN_REFUSE Counter for connection refused CONN_TOTAL Counter for all connnetion checked REQ_ACCEPT Counter for request accepted REQ_REFUSE Counter for request refused REQ_TOTAL Counter for all request in REQ_TO_CHECK Counter for request to check WRONG_COMMAND Counter for request with condition satisfied, but wrong command","title":"Metrics"},{"location":"modules/mod_compress/mod_compress/","text":"mod_compress Introductionn mod_compress compresses responses based on specified rules. Module Configuration Description conf/mod_compress/mod_compress.conf Config Item Description Basic.DataPath String Path of rule configuration Log.OpenDebug Boolean Whether enable debug logs Default False Example [basic] DataPath = mod_compress/compress_rule.data [log] OpenDebug = false Rule Configuration Description Config Item Description Version String Vesion of config file Config Object Compress rule for each product Config{k} String Product name Config{v} Object A list of compress rules Config{v}[] Object A compress rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Action Object Action Config{v}[].Action.Cmd String Name of Action Config{v}[].Action.Quality Integer Compression level Config{v}[].Action.FlushSize Integer Flush size Module Actions Action Descrition GZIP Compress response using gzip method BROTLI Compress response using brotli method Example { \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"Action\" : { \"Cmd\" : \"GZIP\" , \"Quality\" : 9 , \"FlushSize\" : 512 } } ] }, \"Version\" : \"20190101000000\" }","title":"mod_compress"},{"location":"modules/mod_compress/mod_compress/#mod_compress","text":"","title":"mod_compress"},{"location":"modules/mod_compress/mod_compress/#introductionn","text":"mod_compress compresses responses based on specified rules.","title":"Introductionn"},{"location":"modules/mod_compress/mod_compress/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_compress/mod_compress/#description","text":"conf/mod_compress/mod_compress.conf Config Item Description Basic.DataPath String Path of rule configuration Log.OpenDebug Boolean Whether enable debug logs Default False","title":"Description"},{"location":"modules/mod_compress/mod_compress/#example","text":"[basic] DataPath = mod_compress/compress_rule.data [log] OpenDebug = false","title":"Example"},{"location":"modules/mod_compress/mod_compress/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_compress/mod_compress/#description_1","text":"Config Item Description Version String Vesion of config file Config Object Compress rule for each product Config{k} String Product name Config{v} Object A list of compress rules Config{v}[] Object A compress rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Action Object Action Config{v}[].Action.Cmd String Name of Action Config{v}[].Action.Quality Integer Compression level Config{v}[].Action.FlushSize Integer Flush size","title":"Description"},{"location":"modules/mod_compress/mod_compress/#module-actions","text":"Action Descrition GZIP Compress response using gzip method BROTLI Compress response using brotli method","title":"Module Actions"},{"location":"modules/mod_compress/mod_compress/#example_1","text":"{ \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"Action\" : { \"Cmd\" : \"GZIP\" , \"Quality\" : 9 , \"FlushSize\" : 512 } } ] }, \"Version\" : \"20190101000000\" }","title":"Example"},{"location":"modules/mod_doh/mod_doh/","text":"mod_doh Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_doh"},{"location":"modules/mod_doh/mod_doh/#mod_doh","text":"Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_doh"},{"location":"modules/mod_errors/mod_errors/","text":"mod_erros Introduction mod_errors replaces error responses based on specified rules. Module Configuration Description conf/mod_errors/mod_errors.conf Config Item Description Basic.DataPath String Path fo rule configuration Log.OpenDebug Boolean Whether enable debug logs Default False Example [basic] DataPath = mod_errors/errors_rule.data Rule Configuration Description Config Item Description Version String Version of config file Config Object Error rules for each product Config{k} String Product name Config{v} Object A list of error rules Config{v}[] Object A error rule Config{v}[].Cond String Condition expressio, See Condition Config{v}[].Actions Object Action Config{v}[].Actions.Cmd String Name of Action Config{v}[].Actions.Params Object Parameters of Action Config{v}[].Actions.Params[] String A Parameter Module Actions Action Description RETURN Return response generated from specified static html REDIRECT Redirect to specified location Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"res_code_in(\\\"404\\\")\" , \"Actions\" : [ { \"Cmd\" : \"RETURN\" , \"Params\" : [ \"200\" , \"text/html\" , \"../conf/mod_errors/404.html\" ] } ] }, { \"Cond\" : \"res_code_in(\\\"500\\\")\" , \"Actions\" : [ { \"Cmd\" : \"REDIRECT\" , \"Params\" : [ \"http://example.org/error.html\" ] } ] } ] } }","title":"mod_errors"},{"location":"modules/mod_errors/mod_errors/#mod_erros","text":"","title":"mod_erros"},{"location":"modules/mod_errors/mod_errors/#introduction","text":"mod_errors replaces error responses based on specified rules.","title":"Introduction"},{"location":"modules/mod_errors/mod_errors/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_errors/mod_errors/#description","text":"conf/mod_errors/mod_errors.conf Config Item Description Basic.DataPath String Path fo rule configuration Log.OpenDebug Boolean Whether enable debug logs Default False","title":"Description"},{"location":"modules/mod_errors/mod_errors/#example","text":"[basic] DataPath = mod_errors/errors_rule.data","title":"Example"},{"location":"modules/mod_errors/mod_errors/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_errors/mod_errors/#description_1","text":"Config Item Description Version String Version of config file Config Object Error rules for each product Config{k} String Product name Config{v} Object A list of error rules Config{v}[] Object A error rule Config{v}[].Cond String Condition expressio, See Condition Config{v}[].Actions Object Action Config{v}[].Actions.Cmd String Name of Action Config{v}[].Actions.Params Object Parameters of Action Config{v}[].Actions.Params[] String A Parameter","title":"Description"},{"location":"modules/mod_errors/mod_errors/#module-actions","text":"Action Description RETURN Return response generated from specified static html REDIRECT Redirect to specified location","title":"Module Actions"},{"location":"modules/mod_errors/mod_errors/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"res_code_in(\\\"404\\\")\" , \"Actions\" : [ { \"Cmd\" : \"RETURN\" , \"Params\" : [ \"200\" , \"text/html\" , \"../conf/mod_errors/404.html\" ] } ] }, { \"Cond\" : \"res_code_in(\\\"500\\\")\" , \"Actions\" : [ { \"Cmd\" : \"REDIRECT\" , \"Params\" : [ \"http://example.org/error.html\" ] } ] } ] } }","title":"Example"},{"location":"modules/mod_geo/mod_geo/","text":"mod_geo Introduction mod_geo creates variables with values depending on the client IP address, using the GEO databases. Module Configuration Description conf/mod_geo/mod_geo.conf Config Item Description Basic.GeoDBPath String Path of geo db file Log.OpenDebug Boolean Whether enable debug logs Default False mod_geo supports GeoDB in MaxMind format which can be downloaded from https://dev.maxmind.com/geoip/geoip2/geolite2/ Example [basic] GeoDBPath = mod_geo/geo.db","title":"mod_geo"},{"location":"modules/mod_geo/mod_geo/#mod_geo","text":"","title":"mod_geo"},{"location":"modules/mod_geo/mod_geo/#introduction","text":"mod_geo creates variables with values depending on the client IP address, using the GEO databases.","title":"Introduction"},{"location":"modules/mod_geo/mod_geo/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_geo/mod_geo/#description","text":"conf/mod_geo/mod_geo.conf Config Item Description Basic.GeoDBPath String Path of geo db file Log.OpenDebug Boolean Whether enable debug logs Default False mod_geo supports GeoDB in MaxMind format which can be downloaded from https://dev.maxmind.com/geoip/geoip2/geolite2/","title":"Description"},{"location":"modules/mod_geo/mod_geo/#example","text":"[basic] GeoDBPath = mod_geo/geo.db","title":"Example"},{"location":"modules/mod_header/mod_header/","text":"mod_header Introduction mod_header modifies header of HTTP request/response based on defined rules. Module Configuration Description conf/mod_header/mod_header.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module Example [basic] DataPath = mod_header/header_rule.data Rule Configuration Description conf/mod_header/header_rule.data Config Item Description Version String Verson of config file Config Struct Header rules for each product Config{k} String Product name Config{v} Object A ordered list of rules Config{v}[] Object A rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Last Boolean If true, stop processing the next rule Config{v}[].Actions Object A list of Actions Config{v}[].Actions.Cmd String A Action Config{v}[].Actions.Params Object A list of parameters for action Config{v}[].Actions.Params[] String A parameter Actions Action Description REQ_HEADER_SET Set request header REQ_HEADER_ADD Add request header RSP_HEADER_SET Set response header RSP_HEADER_ADD Add response header REQ_HEADER_DEL Delete request header RSP_HEADER_DEL Delete response header REQ_HEADER_MOD Modify request header RSP_HEADER_MOD Modify response header Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"cond\" : \"req_path_prefix_in(\\\"/header\\\", false)\" , \"actions\" : [ { \"cmd\" : \"RSP_HEADER_SET\" , \"params\" : [ \"X-Proxied-By\" , \"bfe\" ] } ], \"last\" : true } ] } }","title":"mod_header"},{"location":"modules/mod_header/mod_header/#mod_header","text":"","title":"mod_header"},{"location":"modules/mod_header/mod_header/#introduction","text":"mod_header modifies header of HTTP request/response based on defined rules.","title":"Introduction"},{"location":"modules/mod_header/mod_header/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_header/mod_header/#description","text":"conf/mod_header/mod_header.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module","title":"Description"},{"location":"modules/mod_header/mod_header/#example","text":"[basic] DataPath = mod_header/header_rule.data","title":"Example"},{"location":"modules/mod_header/mod_header/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_header/mod_header/#description_1","text":"conf/mod_header/header_rule.data Config Item Description Version String Verson of config file Config Struct Header rules for each product Config{k} String Product name Config{v} Object A ordered list of rules Config{v}[] Object A rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Last Boolean If true, stop processing the next rule Config{v}[].Actions Object A list of Actions Config{v}[].Actions.Cmd String A Action Config{v}[].Actions.Params Object A list of parameters for action Config{v}[].Actions.Params[] String A parameter","title":"Description"},{"location":"modules/mod_header/mod_header/#actions","text":"Action Description REQ_HEADER_SET Set request header REQ_HEADER_ADD Add request header RSP_HEADER_SET Set response header RSP_HEADER_ADD Add response header REQ_HEADER_DEL Delete request header RSP_HEADER_DEL Delete response header REQ_HEADER_MOD Modify request header RSP_HEADER_MOD Modify response header","title":"Actions"},{"location":"modules/mod_header/mod_header/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"cond\" : \"req_path_prefix_in(\\\"/header\\\", false)\" , \"actions\" : [ { \"cmd\" : \"RSP_HEADER_SET\" , \"params\" : [ \"X-Proxied-By\" , \"bfe\" ] } ], \"last\" : true } ] } }","title":"Example"},{"location":"modules/mod_http_code/mod_http_code/","text":"mod_http_code Introduction mod_http_code reports statistics of HTTP response codes. Module Configuration Not required Metrics Metric Description ALL2_X_X counter of 2XX status ALL3_X_X coutner of 3XX status ALL4_X_X coutner of 4XX status ALL4_X_X coutner of 5XX status","title":"mod_http_code"},{"location":"modules/mod_http_code/mod_http_code/#mod_http_code","text":"","title":"mod_http_code"},{"location":"modules/mod_http_code/mod_http_code/#introduction","text":"mod_http_code reports statistics of HTTP response codes.","title":"Introduction"},{"location":"modules/mod_http_code/mod_http_code/#module-configuration","text":"Not required","title":"Module Configuration"},{"location":"modules/mod_http_code/mod_http_code/#metrics","text":"Metric Description ALL2_X_X counter of 2XX status ALL3_X_X coutner of 3XX status ALL4_X_X coutner of 4XX status ALL4_X_X coutner of 5XX status","title":"Metrics"},{"location":"modules/mod_key_log/mod_key_log/","text":"mod_key_log Introduction mod_key_log writes tls key logs in NSS key log format so that external programs(eg. wireshark) can decrypt TLS connections for trouble shooting. For more information about NSS key log format, see: https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format Module Configuration Description conf/mod_key_log/mod_key_log.conf Config Item Description Log.LogPrefix String filename prefix for log Log.LogDir String directory of log files Log.RotateWhen String inteval to rotate log file Log.BackupCount Integer max number of rotated log files Example [Log] # filename prefix for log LogPrefix = key # log directory LogDir = ../log # interval to rotate logs: M/H/D # - M: minute # - H: hour # - D: day RotateWhen = H # max number of rotated log files BackupCount = 3","title":"mod_key_log"},{"location":"modules/mod_key_log/mod_key_log/#mod_key_log","text":"","title":"mod_key_log"},{"location":"modules/mod_key_log/mod_key_log/#introduction","text":"mod_key_log writes tls key logs in NSS key log format so that external programs(eg. wireshark) can decrypt TLS connections for trouble shooting. For more information about NSS key log format, see: https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format","title":"Introduction"},{"location":"modules/mod_key_log/mod_key_log/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_key_log/mod_key_log/#description","text":"conf/mod_key_log/mod_key_log.conf Config Item Description Log.LogPrefix String filename prefix for log Log.LogDir String directory of log files Log.RotateWhen String inteval to rotate log file Log.BackupCount Integer max number of rotated log files","title":"Description"},{"location":"modules/mod_key_log/mod_key_log/#example","text":"[Log] # filename prefix for log LogPrefix = key # log directory LogDir = ../log # interval to rotate logs: M/H/D # - M: minute # - H: hour # - D: day RotateWhen = H # max number of rotated log files BackupCount = 3","title":"Example"},{"location":"modules/mod_logid/mod_logid/","text":"mod_logid Introduction mod_logid generates log ids for sessions/requests. Module Configuration Not required Metrics Metric Description LOGID_CONVERT_FAILED Counter for old logid convert error","title":"mod_logid"},{"location":"modules/mod_logid/mod_logid/#mod_logid","text":"","title":"mod_logid"},{"location":"modules/mod_logid/mod_logid/#introduction","text":"mod_logid generates log ids for sessions/requests.","title":"Introduction"},{"location":"modules/mod_logid/mod_logid/#module-configuration","text":"Not required","title":"Module Configuration"},{"location":"modules/mod_logid/mod_logid/#metrics","text":"Metric Description LOGID_CONVERT_FAILED Counter for old logid convert error","title":"Metrics"},{"location":"modules/mod_prison/mod_prison/","text":"mod_prison Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_prison"},{"location":"modules/mod_prison/mod_prison/#mod_prison","text":"Note: This documentation is working in process. Please help improve it by filing issues or pull requests .","title":"mod_prison"},{"location":"modules/mod_redirect/mod_redirect/","text":"mod_redirect Introduction mod_redirect redirects HTTP requests based on defined rules. Module Configuration Description conf/mod_redirect/mod_redirect.conf Config Item Description Basic.DataPath String path of rule configuraiton Example [basic] DataPath = mod_redirect/redirect.data Rule Configuration Description conf/mod_redirect/redirect.data Config Item Description Version String Verson of config file Config Struct Redirect rules for each product. Config{k} String Product name Config{v} Object A ordered list of redirect rules Config{v}[] Object A redirect rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Actions Object A ordered list of redirect actions Config{v}[].Actions[] Object A redirect action Config{v}[].Actions[].Cmd Object Name of redirect action Config{v}[].Actions[].Params Object Parameters of redirect action Config{v}[].Status Integer Status code Actions Action Description URL_SET redirect to specified URL URL_FROM_QUERY redirect to URL parsed from specified query in request URL_PREFIX_ADD redirect to URL concatenated by specified prefix and the original URL SCHEME_SET redirect to the original URL but with scheme changed. supported scheme: http|https Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/redirect\\\", false)\" , \"Actions\" : [ { \"Cmd\" : \"URL_SET\" , \"Params\" : [ \"https://example.org\" ] } ], \"Status\" : 301 } ] } }","title":"mod_redirect"},{"location":"modules/mod_redirect/mod_redirect/#mod_redirect","text":"","title":"mod_redirect"},{"location":"modules/mod_redirect/mod_redirect/#introduction","text":"mod_redirect redirects HTTP requests based on defined rules.","title":"Introduction"},{"location":"modules/mod_redirect/mod_redirect/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_redirect/mod_redirect/#description","text":"conf/mod_redirect/mod_redirect.conf Config Item Description Basic.DataPath String path of rule configuraiton","title":"Description"},{"location":"modules/mod_redirect/mod_redirect/#example","text":"[basic] DataPath = mod_redirect/redirect.data","title":"Example"},{"location":"modules/mod_redirect/mod_redirect/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_redirect/mod_redirect/#description_1","text":"conf/mod_redirect/redirect.data Config Item Description Version String Verson of config file Config Struct Redirect rules for each product. Config{k} String Product name Config{v} Object A ordered list of redirect rules Config{v}[] Object A redirect rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Actions Object A ordered list of redirect actions Config{v}[].Actions[] Object A redirect action Config{v}[].Actions[].Cmd Object Name of redirect action Config{v}[].Actions[].Params Object Parameters of redirect action Config{v}[].Status Integer Status code","title":"Description"},{"location":"modules/mod_redirect/mod_redirect/#actions","text":"Action Description URL_SET redirect to specified URL URL_FROM_QUERY redirect to URL parsed from specified query in request URL_PREFIX_ADD redirect to URL concatenated by specified prefix and the original URL SCHEME_SET redirect to the original URL but with scheme changed. supported scheme: http|https","title":"Actions"},{"location":"modules/mod_redirect/mod_redirect/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/redirect\\\", false)\" , \"Actions\" : [ { \"Cmd\" : \"URL_SET\" , \"Params\" : [ \"https://example.org\" ] } ], \"Status\" : 301 } ] } }","title":"Example"},{"location":"modules/mod_rewrite/mod_rewrite/","text":"mod_rewrite Introduction mod_rewrite modifies the URI of HTTP request based on defined rules. Module Configuration Description conf/mod_rewrite/mod_rewrite.conf Config Item Description Basic.DataPath String path of rule configuraiton Example [basic] DataPath = mod_rewrite/rewrite.data Rule Configuration Description conf/mod_rewrite/rewrite.data Config Item Description Version String Verson of config file Config Struct Rewrite rules for each product Config{k} String Product name Config{v} Object A ordered list of rewrite rules Config{v}[] Object A rewrite rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Actions Object A ordered list of rewrite actions Config{v}[].Actions[] Object A rewrite action Config{v}[].Actions[].Cmd Object Name of rewrite action Config{v}[].Actions[].Params Object Parameters of rewrite action Config{v}[].Last Integer If true, stop to check the remaining rules Actions Action Description HOST_SET Set host to specified value HOST_SET_FROM_PATH_PREFIX Set host to specified path prefix HOST_SUFFIX_REPLACE Replace suffix of host PATH_SET Set path to specified value PATH_PREFIX_ADD Add prefix to orignal path PATH_PREFIX_TRIM Trim prefix from orignal path QUERY_ADD Add query QUERY_DEL Delete query QUERY_DEL_ALL_EXCEPT Del all queries except specified queries QUERY_RENAME Rename query Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/rewrite\\\", false)\" , \"Actions\" : [ { \"Cmd\" : \"PATH_PREFIX_ADD\" , \"Params\" : [ \"/bfe/\" ] } ], \"Last\" : true } ] } }","title":"mod_rewrite"},{"location":"modules/mod_rewrite/mod_rewrite/#mod_rewrite","text":"","title":"mod_rewrite"},{"location":"modules/mod_rewrite/mod_rewrite/#introduction","text":"mod_rewrite modifies the URI of HTTP request based on defined rules.","title":"Introduction"},{"location":"modules/mod_rewrite/mod_rewrite/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_rewrite/mod_rewrite/#description","text":"conf/mod_rewrite/mod_rewrite.conf Config Item Description Basic.DataPath String path of rule configuraiton","title":"Description"},{"location":"modules/mod_rewrite/mod_rewrite/#example","text":"[basic] DataPath = mod_rewrite/rewrite.data","title":"Example"},{"location":"modules/mod_rewrite/mod_rewrite/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_rewrite/mod_rewrite/#description_1","text":"conf/mod_rewrite/rewrite.data Config Item Description Version String Verson of config file Config Struct Rewrite rules for each product Config{k} String Product name Config{v} Object A ordered list of rewrite rules Config{v}[] Object A rewrite rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Actions Object A ordered list of rewrite actions Config{v}[].Actions[] Object A rewrite action Config{v}[].Actions[].Cmd Object Name of rewrite action Config{v}[].Actions[].Params Object Parameters of rewrite action Config{v}[].Last Integer If true, stop to check the remaining rules","title":"Description"},{"location":"modules/mod_rewrite/mod_rewrite/#actions","text":"Action Description HOST_SET Set host to specified value HOST_SET_FROM_PATH_PREFIX Set host to specified path prefix HOST_SUFFIX_REPLACE Replace suffix of host PATH_SET Set path to specified value PATH_PREFIX_ADD Add prefix to orignal path PATH_PREFIX_TRIM Trim prefix from orignal path QUERY_ADD Add query QUERY_DEL Delete query QUERY_DEL_ALL_EXCEPT Del all queries except specified queries QUERY_RENAME Rename query","title":"Actions"},{"location":"modules/mod_rewrite/mod_rewrite/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/rewrite\\\", false)\" , \"Actions\" : [ { \"Cmd\" : \"PATH_PREFIX_ADD\" , \"Params\" : [ \"/bfe/\" ] } ], \"Last\" : true } ] } }","title":"Example"},{"location":"modules/mod_static/mod_static/","text":"mod_static Introduction mod_static serves static files. Module Configuration Description conf/mod_static/mod_static.conf Config Item Description Basic.DataPath String path of rule configuraiton Example [basic] DataPath = mod_static/static_rule.data Rule Configuration Description conf/mod_static/static_rule.data Config Item Description Version String Verson of config file Config Struct Static rules for each product Config{k} String Product name Config{v} Object A ordered list of static rules Config{v}[] Object A static rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Action Object A static action Config{v}[].Action.Cmd String Name of static action Config{v}[].Action.Params Object Parameters of static action Actions Action Description BROWSE Serve static files. The first parameter is the location of root directory. The second parameter is the name of default file. Example { \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"Action\" : { \"Cmd\" : \"BROWSE\" , \"Params\" : [ \"./\" , \"index.html\" ] } } ] }, \"Version\" : \"20190101000000\" } Metrics Metric Description FILE_BROWSE_COUNT Counter for BROWSE requests FILE_CURRENT_OPENED Counter for current opend files FILE_BROWSE_NOT_EXIST Counter for \"file not exists\" requests FILE_BROWSE_SIZE Total served file size","title":"mod_static"},{"location":"modules/mod_static/mod_static/#mod_static","text":"","title":"mod_static"},{"location":"modules/mod_static/mod_static/#introduction","text":"mod_static serves static files.","title":"Introduction"},{"location":"modules/mod_static/mod_static/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_static/mod_static/#description","text":"conf/mod_static/mod_static.conf Config Item Description Basic.DataPath String path of rule configuraiton","title":"Description"},{"location":"modules/mod_static/mod_static/#example","text":"[basic] DataPath = mod_static/static_rule.data","title":"Example"},{"location":"modules/mod_static/mod_static/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_static/mod_static/#description_1","text":"conf/mod_static/static_rule.data Config Item Description Version String Verson of config file Config Struct Static rules for each product Config{k} String Product name Config{v} Object A ordered list of static rules Config{v}[] Object A static rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Action Object A static action Config{v}[].Action.Cmd String Name of static action Config{v}[].Action.Params Object Parameters of static action","title":"Description"},{"location":"modules/mod_static/mod_static/#actions","text":"Action Description BROWSE Serve static files. The first parameter is the location of root directory. The second parameter is the name of default file.","title":"Actions"},{"location":"modules/mod_static/mod_static/#example_1","text":"{ \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"www.example.org\\\")\" , \"Action\" : { \"Cmd\" : \"BROWSE\" , \"Params\" : [ \"./\" , \"index.html\" ] } } ] }, \"Version\" : \"20190101000000\" }","title":"Example"},{"location":"modules/mod_static/mod_static/#metrics","text":"Metric Description FILE_BROWSE_COUNT Counter for BROWSE requests FILE_CURRENT_OPENED Counter for current opend files FILE_BROWSE_NOT_EXIST Counter for \"file not exists\" requests FILE_BROWSE_SIZE Total served file size","title":"Metrics"},{"location":"modules/mod_tag/mod_tag/","text":"mod_tag Introduction mod_tag sets tags for requests based on defined rules. Module Configuration Description conf/mod_tag/mod_tag.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module Example [Basic] DataPath = mod_tag/tag_rule.data [Log] OpenDebug = true Rule Configuration Description conf/mod_tag/tag_rule.data Config Item Description Version String Verson of the config file Config Object Tag rules for each product Config{k} String Product name Config{v} Object A list of tag rules Config{v}[] Object A tag rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Param.TagName String tag name Config{v}[].Param.TagValue String tag value Config{v}[].Last Boolean if true, stop to check the remaining rules Example { \"Version\" : \"20200218210000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"Param\" : { \"TagName\" : \"tag\" , \"TagValue\" : \"bfe\" }, \"Last\" : false } ] } }","title":"mod_tag"},{"location":"modules/mod_tag/mod_tag/#mod_tag","text":"","title":"mod_tag"},{"location":"modules/mod_tag/mod_tag/#introduction","text":"mod_tag sets tags for requests based on defined rules.","title":"Introduction"},{"location":"modules/mod_tag/mod_tag/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_tag/mod_tag/#description","text":"conf/mod_tag/mod_tag.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module","title":"Description"},{"location":"modules/mod_tag/mod_tag/#example","text":"[Basic] DataPath = mod_tag/tag_rule.data [Log] OpenDebug = true","title":"Example"},{"location":"modules/mod_tag/mod_tag/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_tag/mod_tag/#description_1","text":"conf/mod_tag/tag_rule.data Config Item Description Version String Verson of the config file Config Object Tag rules for each product Config{k} String Product name Config{v} Object A list of tag rules Config{v}[] Object A tag rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Param.TagName String tag name Config{v}[].Param.TagValue String tag value Config{v}[].Last Boolean if true, stop to check the remaining rules","title":"Description"},{"location":"modules/mod_tag/mod_tag/#example_1","text":"{ \"Version\" : \"20200218210000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"Param\" : { \"TagName\" : \"tag\" , \"TagValue\" : \"bfe\" }, \"Last\" : false } ] } }","title":"Example"},{"location":"modules/mod_trace/mod_trace/","text":"mod_trace Introduction mod_trace enables tracing for requests based on defined rules. Module Configuration Description conf/mod_trace/mod_trace.conf Basic Configuration Config Item Description Basic.DataPath String path of rule configuraiton Basic.ServiceName String service name Basic.TraceAgent String which trace agent to use (jaeger/zipkin) Log.OpenDebug Boolean debug flag of module Configuration about Zipkin Config Item Description Zipkin.HTTPEndpoint String http endpoint to report traces to Zipkin.SameSpan String whether to use Zipkin SameSpan RPC style traces Zipkin.ID128Bit String whether to use 128 bit root span IDs Zipkin.SampleRate Float the rate between 0.0001 and 1.0 of requests to trace Configuration about Jaeger Config Item Description Jaeger.SamplingServerURL String the address of jaeger-agent's HTTP sampling server Jaeger.SamplingType String the type of the sampler: const, probabilistic, rateLimiting, or remote Jaeger.SamplingParam Float param passed to the sampler Jaeger.LocalAgentHostPort String the address of jaeger-agent which recives spans Jaeger.Propagation String which propagation format to use (jaeger/b3) Jaeger.Gen128Bit Boolean whether to use 128 bit root span IDs Jaeger.TraceContextHeaderName String the http header name used to propagate tracing context Jaeger.CollectorEndpoint String the address of jaeger-collector Jaeger.CollectorUser String basic http authentication when sending spans to jaeger-collector Jaeger.CollectorPassword String basic http authentication when sending spans to jaeger-collector Configuration about Elastic Config Item Description Elastic.ServerURL String Set the URL of the Elastic APM server Elastic.SecretToken String Set the token used to connect to Elastic APM Server Example Example for Zipkin [Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = zipkin [Log] OpenDebug = false [Zipkin] # Zipkin, only useful when the TraceAgent is zipkin # HTTP Endpoint to report traces to HTTPEndpoint = http://127.0.0.1:9411/api/v2/spans # Use Zipkin SameSpan RPC style traces SameSpan = false # Use Zipkin 128 bit root span IDs ID128Bit = true # The rate between 0.0001 and 1.0 of requests to trace SampleRate = 1.0 Example for Jaeger [Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = jaeger [Log] OpenDebug = false [Jaeger] # Jaeger, only useful when the TraceAgent is jaeger # SamplingServerURL is the address of jaeger-agent's HTTP sampling server SamplingServerURL = http://127.0.0.1:5778/sampling # Type specifies the type of the sampler: const, probabilistic, rateLimiting, or remote SamplingType = const # Param is a value passed to the sampler. # Valid values for Param field are: # - for \"const\" sampler, 0 or 1 for always false/true respectively # - for \"probabilistic\" sampler, a probability between 0 and 1 # - for \"rateLimiting\" sampler, the number of spans per second # - for \"remote\" sampler, param is the same as for \"probabilistic\" # and indicates the initial sampling rate before the actual one # is received from the mothership. SamplingParam = 1.0 # LocalAgentHostPort instructs reporter to send spans to jaeger-agent at this address LocalAgentHostPort = 127.0.0.1:6831 # Which propagation format to use (jaeger/b3) Propagation = jaeger # Use Jaeger 128 bit root span IDs Gen128Bit = true # TraceContextHeaderName is the http header name used to propagate tracing context. TraceContextHeaderName = uber-trace-id # Instructs reporter to send spans to jaeger-collector at this URL CollectorEndpoint = \"\" # CollectorUser for basic http authentication when sending spans to jaeger-collector CollectorUser = \"\" # CollectorPassword for basic http authentication when sending spans to jaeger-collector CollectorPassword = \"\" Example for Elastic [Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = elastic [Log] OpenDebug = false [Elastic] # Elastic, only useful when TraceAgent is elastic # Set the URL of the Elastic APM server ServerURL = http://127.0.0.1:8200 # Set the token used to connect to Elastic APM Server SecretToken = \"\" Rule Configuration Description conf/mod_trace/trace_rule.data Config Item Description Version String Verson of the config file Config Object Trace rules for each product Config[k] String Product name Config[v] Object A list of trace rules Config[v][] Object A trace rule Config[v][].Cond String Condition expression, See Condition Config[v][].Enable Boolean Enable trace Example { \"Version\" : \"20200218210000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"Enable\" : true } ] } }","title":"mod_trace"},{"location":"modules/mod_trace/mod_trace/#mod_trace","text":"","title":"mod_trace"},{"location":"modules/mod_trace/mod_trace/#introduction","text":"mod_trace enables tracing for requests based on defined rules.","title":"Introduction"},{"location":"modules/mod_trace/mod_trace/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_trace/mod_trace/#description","text":"conf/mod_trace/mod_trace.conf","title":"Description"},{"location":"modules/mod_trace/mod_trace/#basic-configuration","text":"Config Item Description Basic.DataPath String path of rule configuraiton Basic.ServiceName String service name Basic.TraceAgent String which trace agent to use (jaeger/zipkin) Log.OpenDebug Boolean debug flag of module","title":"Basic Configuration"},{"location":"modules/mod_trace/mod_trace/#configuration-about-zipkin","text":"Config Item Description Zipkin.HTTPEndpoint String http endpoint to report traces to Zipkin.SameSpan String whether to use Zipkin SameSpan RPC style traces Zipkin.ID128Bit String whether to use 128 bit root span IDs Zipkin.SampleRate Float the rate between 0.0001 and 1.0 of requests to trace","title":"Configuration about Zipkin"},{"location":"modules/mod_trace/mod_trace/#configuration-about-jaeger","text":"Config Item Description Jaeger.SamplingServerURL String the address of jaeger-agent's HTTP sampling server Jaeger.SamplingType String the type of the sampler: const, probabilistic, rateLimiting, or remote Jaeger.SamplingParam Float param passed to the sampler Jaeger.LocalAgentHostPort String the address of jaeger-agent which recives spans Jaeger.Propagation String which propagation format to use (jaeger/b3) Jaeger.Gen128Bit Boolean whether to use 128 bit root span IDs Jaeger.TraceContextHeaderName String the http header name used to propagate tracing context Jaeger.CollectorEndpoint String the address of jaeger-collector Jaeger.CollectorUser String basic http authentication when sending spans to jaeger-collector Jaeger.CollectorPassword String basic http authentication when sending spans to jaeger-collector","title":"Configuration about Jaeger"},{"location":"modules/mod_trace/mod_trace/#configuration-about-elastic","text":"Config Item Description Elastic.ServerURL String Set the URL of the Elastic APM server Elastic.SecretToken String Set the token used to connect to Elastic APM Server","title":"Configuration about Elastic"},{"location":"modules/mod_trace/mod_trace/#example","text":"","title":"Example"},{"location":"modules/mod_trace/mod_trace/#example-for-zipkin","text":"[Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = zipkin [Log] OpenDebug = false [Zipkin] # Zipkin, only useful when the TraceAgent is zipkin # HTTP Endpoint to report traces to HTTPEndpoint = http://127.0.0.1:9411/api/v2/spans # Use Zipkin SameSpan RPC style traces SameSpan = false # Use Zipkin 128 bit root span IDs ID128Bit = true # The rate between 0.0001 and 1.0 of requests to trace SampleRate = 1.0","title":"Example for Zipkin"},{"location":"modules/mod_trace/mod_trace/#example-for-jaeger","text":"[Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = jaeger [Log] OpenDebug = false [Jaeger] # Jaeger, only useful when the TraceAgent is jaeger # SamplingServerURL is the address of jaeger-agent's HTTP sampling server SamplingServerURL = http://127.0.0.1:5778/sampling # Type specifies the type of the sampler: const, probabilistic, rateLimiting, or remote SamplingType = const # Param is a value passed to the sampler. # Valid values for Param field are: # - for \"const\" sampler, 0 or 1 for always false/true respectively # - for \"probabilistic\" sampler, a probability between 0 and 1 # - for \"rateLimiting\" sampler, the number of spans per second # - for \"remote\" sampler, param is the same as for \"probabilistic\" # and indicates the initial sampling rate before the actual one # is received from the mothership. SamplingParam = 1.0 # LocalAgentHostPort instructs reporter to send spans to jaeger-agent at this address LocalAgentHostPort = 127.0.0.1:6831 # Which propagation format to use (jaeger/b3) Propagation = jaeger # Use Jaeger 128 bit root span IDs Gen128Bit = true # TraceContextHeaderName is the http header name used to propagate tracing context. TraceContextHeaderName = uber-trace-id # Instructs reporter to send spans to jaeger-collector at this URL CollectorEndpoint = \"\" # CollectorUser for basic http authentication when sending spans to jaeger-collector CollectorUser = \"\" # CollectorPassword for basic http authentication when sending spans to jaeger-collector CollectorPassword = \"\"","title":"Example for Jaeger"},{"location":"modules/mod_trace/mod_trace/#example-for-elastic","text":"[Basic] DataPath = mod_trace/trace_rule.data ServiceName = bfe # Which trace agent to use (zipkin, jaeger, elastic) TraceAgent = elastic [Log] OpenDebug = false [Elastic] # Elastic, only useful when TraceAgent is elastic # Set the URL of the Elastic APM server ServerURL = http://127.0.0.1:8200 # Set the token used to connect to Elastic APM Server SecretToken = \"\"","title":"Example for Elastic"},{"location":"modules/mod_trace/mod_trace/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_trace/mod_trace/#description_1","text":"conf/mod_trace/trace_rule.data Config Item Description Version String Verson of the config file Config Object Trace rules for each product Config[k] String Product name Config[v] Object A list of trace rules Config[v][] Object A trace rule Config[v][].Cond String Condition expression, See Condition Config[v][].Enable Boolean Enable trace","title":"Description"},{"location":"modules/mod_trace/mod_trace/#example_1","text":"{ \"Version\" : \"20200218210000\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_host_in(\\\"example.org\\\")\" , \"Enable\" : true } ] } }","title":"Example"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/","text":"mod_trust_clientip Introduction mod_trust_clientip checkes the client IP of incoming request/connnection against trusted ip dictionary. If matched, the request/connection is marked as trusted. Module Configuration Description conf/mod_trust_clientip/mod_trust_clientip.conf Config Item Description Basic.DataPath String path of rule configuraiton Example [basic] DataPath = mod_trust_clientip/trust_client_ip.data Rule Configuraiton Description conf/mod_trust_clientip/trust_client_ip.data Config Item Type Description Version String Verson of config file Config Object trusted ip config Config{k} Struct label Config{v} String A list of ip segments Config{v}[] Object A ip segment Config{v}[].Begin String start ip address Config{v}[].End String end ip address Example { \"Version\" : \"20190101000000\" , \"Config\" : { \"inner-idc\" : [ { \"Begin\" : \"10.0.0.0\" , \"End\" : \"10.255.255.255\" } ] } } Metrics Metric Description CONN_ADDR_INTERNAL ^PCounter for connection from internal CONN_ADDR_INTERNAL_NOT_TRUST ^PCounter for connection from internal and not trust CONN_TOTAL ^PCounter for all connnetion checked CONN_TRUST_CLIENTIP ^PCounter for connnection from trust address","title":"mod_trust_clientip"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#mod_trust_clientip","text":"","title":"mod_trust_clientip"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#introduction","text":"mod_trust_clientip checkes the client IP of incoming request/connnection against trusted ip dictionary. If matched, the request/connection is marked as trusted.","title":"Introduction"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#description","text":"conf/mod_trust_clientip/mod_trust_clientip.conf Config Item Description Basic.DataPath String path of rule configuraiton","title":"Description"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#example","text":"[basic] DataPath = mod_trust_clientip/trust_client_ip.data","title":"Example"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#rule-configuraiton","text":"","title":"Rule Configuraiton"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#description_1","text":"conf/mod_trust_clientip/trust_client_ip.data Config Item Type Description Version String Verson of config file Config Object trusted ip config Config{k} Struct label Config{v} String A list of ip segments Config{v}[] Object A ip segment Config{v}[].Begin String start ip address Config{v}[].End String end ip address","title":"Description"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#example_1","text":"{ \"Version\" : \"20190101000000\" , \"Config\" : { \"inner-idc\" : [ { \"Begin\" : \"10.0.0.0\" , \"End\" : \"10.255.255.255\" } ] } }","title":"Example"},{"location":"modules/mod_trust_clientip/mod_trust_clientip/#metrics","text":"Metric Description CONN_ADDR_INTERNAL ^PCounter for connection from internal CONN_ADDR_INTERNAL_NOT_TRUST ^PCounter for connection from internal and not trust CONN_TOTAL ^PCounter for all connnetion checked CONN_TRUST_CLIENTIP ^PCounter for connnection from trust address","title":"Metrics"},{"location":"modules/mod_userid/mod_userid/","text":"mod_userid Introduction mod_userid generates user id for client identification. Module Configuration Description conf/mod_userid/mod_userid.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module Example [basic] DataPath = mod_userid/userid_rule.data [Log] OpenDebug = true Rule Configuration Description conf/mod_userid/userid_rule.data Config Item Description Version String Verson of config file Config Object rules for each product Config{k} String Product name Config{v} Object A list of rules Config{v}[] Object A rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Params.Name String the cookie name Config{v}[].Params.Domain String the cookie domain Config{v}[].Params.Path String the cookie path Config{v}[].Params.MaxAge Integer the cookie max age Example { \"Version\" : \"2019-12-10184356\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/abc\\\", true)\" , \"Params\" : { \"Name\" : \"bfe_userid_abc\" , \"Domain\" : \"\" , \"Path\" : \"/abc\" , \"MaxAge\" : 3153600 }, \"Generator\" : \"default\" }, { \"Cond\" : \"default_t()\" , \"Params\" : { \"Name\" : \"bfe_userid\" , \"Domain\" : \"\" , \"Path\" : \"/\" , \"MaxAge\" : 3153600 } } ] } }","title":"mod_userid"},{"location":"modules/mod_userid/mod_userid/#mod_userid","text":"","title":"mod_userid"},{"location":"modules/mod_userid/mod_userid/#introduction","text":"mod_userid generates user id for client identification.","title":"Introduction"},{"location":"modules/mod_userid/mod_userid/#module-configuration","text":"","title":"Module Configuration"},{"location":"modules/mod_userid/mod_userid/#description","text":"conf/mod_userid/mod_userid.conf Config Item Description Basic.DataPath String path of rule configuraiton Log.OpenDebug Boolean debug flag of module","title":"Description"},{"location":"modules/mod_userid/mod_userid/#example","text":"[basic] DataPath = mod_userid/userid_rule.data [Log] OpenDebug = true","title":"Example"},{"location":"modules/mod_userid/mod_userid/#rule-configuration","text":"","title":"Rule Configuration"},{"location":"modules/mod_userid/mod_userid/#description_1","text":"conf/mod_userid/userid_rule.data Config Item Description Version String Verson of config file Config Object rules for each product Config{k} String Product name Config{v} Object A list of rules Config{v}[] Object A rule Config{v}[].Cond String Condition expression, See Condition Config{v}[].Params.Name String the cookie name Config{v}[].Params.Domain String the cookie domain Config{v}[].Params.Path String the cookie path Config{v}[].Params.MaxAge Integer the cookie max age","title":"Description"},{"location":"modules/mod_userid/mod_userid/#example_1","text":"{ \"Version\" : \"2019-12-10184356\" , \"Config\" : { \"example_product\" : [ { \"Cond\" : \"req_path_prefix_in(\\\"/abc\\\", true)\" , \"Params\" : { \"Name\" : \"bfe_userid_abc\" , \"Domain\" : \"\" , \"Path\" : \"/abc\" , \"MaxAge\" : 3153600 }, \"Generator\" : \"default\" }, { \"Cond\" : \"default_t()\" , \"Params\" : { \"Name\" : \"bfe_userid\" , \"Domain\" : \"\" , \"Path\" : \"/\" , \"MaxAge\" : 3153600 } } ] } }","title":"Example"},{"location":"monitor/bal_state/","text":"Balancing Error Introduction bal_state monitor the subcluster level load balance state using gslb. Monitor Item Monitor Item Description ERR_BK_NO_BACKEND Counter for no backend found ERR_BK_NO_SUB_CLUSTER Counter for no sub-cluster found ERR_BK_NO_SUB_CLUSTER_CROSS Counter for no cross sub-cluster found ERR_BK_RETRY_TOO_MANY Counter for reaching retry max times ERR_GSLB_BLACKHOLE Counter for denying by blackhole","title":"Balance error"},{"location":"monitor/bal_state/#balancing-error","text":"","title":"Balancing Error"},{"location":"monitor/bal_state/#introduction","text":"bal_state monitor the subcluster level load balance state using gslb.","title":"Introduction"},{"location":"monitor/bal_state/#monitor-item","text":"Monitor Item Description ERR_BK_NO_BACKEND Counter for no backend found ERR_BK_NO_SUB_CLUSTER Counter for no sub-cluster found ERR_BK_NO_SUB_CLUSTER_CROSS Counter for no cross sub-cluster found ERR_BK_RETRY_TOO_MANY Counter for reaching retry max times ERR_GSLB_BLACKHOLE Counter for denying by blackhole","title":"Monitor Item"},{"location":"monitor/bal_table_status/","text":"Balancing Details Introduction bal_table_status monitor table state for maintain backend cluster. Monitor Item Monitor Item Description Balancers State of cluster, it is map data, key is cluster name, value is cluster state BackendNum Number of cluster backend cluster state Monitor Item Description SubClusters State of sub-cluster, it is map data, key is sub-cluster name, value is number of sub-cluster backend BackendNum Number of sub-cluster backend","title":"Balance details"},{"location":"monitor/bal_table_status/#balancing-details","text":"","title":"Balancing Details"},{"location":"monitor/bal_table_status/#introduction","text":"bal_table_status monitor table state for maintain backend cluster.","title":"Introduction"},{"location":"monitor/bal_table_status/#monitor-item","text":"Monitor Item Description Balancers State of cluster, it is map data, key is cluster name, value is cluster state BackendNum Number of cluster backend","title":"Monitor Item"},{"location":"monitor/bal_table_status/#cluster-state","text":"Monitor Item Description SubClusters State of sub-cluster, it is map data, key is sub-cluster name, value is number of sub-cluster backend BackendNum Number of sub-cluster backend","title":"cluster state"},{"location":"monitor/bal_table_version/","text":"Introduction bal_table_version monitor version for subcluster level load balance config Monitor Item Monitor Item Description ClusterTableConfVer Cluster table config version GslbConfTimeStamp Timestamp of gslb conf GslbConfSrc Which gslb config come from","title":"Introduction"},{"location":"monitor/bal_table_version/#introduction","text":"bal_table_version monitor version for subcluster level load balance config","title":"Introduction"},{"location":"monitor/bal_table_version/#monitor-item","text":"Monitor Item Description ClusterTableConfVer Cluster table config version GslbConfTimeStamp Timestamp of gslb conf GslbConfSrc Which gslb config come from","title":"Monitor Item"},{"location":"monitor/cluster_table_version/","text":"Introduction cluster_table_version monitor version of cluster confing. Monitor Item Monitor Item Description ClusterConfVer Version of cluster config","title":"Introduction"},{"location":"monitor/cluster_table_version/#introduction","text":"cluster_table_version monitor version of cluster confing.","title":"Introduction"},{"location":"monitor/cluster_table_version/#monitor-item","text":"Monitor Item Description ClusterConfVer Version of cluster config","title":"Monitor Item"},{"location":"monitor/host_table_status/","text":"Host table Introduction host_table_status monitor status of host table. Monitor Item Monitor Item Description HostTableSize Size of host table HostTagTableSize Size of host tag table VipTableSize Size of vip table ProductRouteTableSize Size of product route table","title":"Host table"},{"location":"monitor/host_table_status/#host-table","text":"","title":"Host table"},{"location":"monitor/host_table_status/#introduction","text":"host_table_status monitor status of host table.","title":"Introduction"},{"location":"monitor/host_table_status/#monitor-item","text":"Monitor Item Description HostTableSize Size of host table HostTagTableSize Size of host tag table VipTableSize Size of vip table ProductRouteTableSize Size of product route table","title":"Monitor Item"},{"location":"monitor/host_table_version/","text":"Introduction host_table_version monitor version of host table. Monitor Item Monitor Item Description HostTag Version of host tag Vip Version of vip rule ProductRoute Version of product route rule","title":"Introduction"},{"location":"monitor/host_table_version/#introduction","text":"host_table_version monitor version of host table.","title":"Introduction"},{"location":"monitor/host_table_version/#monitor-item","text":"Monitor Item Description HostTag Version of host tag Vip Version of vip rule ProductRoute Version of product route rule","title":"Monitor Item"},{"location":"monitor/http2_state/","text":"HTTP2 Introduction http2_state monitor state of HTTP2. Monitor Item Monitor Item Description H2_CONN_OVERLOAD Counter for exceeding connection rate limit H2_ERR_GOT_RESET Counter for gettting RST_STREAM H2_ERR_MAX_HEADER_LIST_SIZE Counter for reaching max size of header list H2_ERR_MAX_HEADER_URI_SIZE Counter for reaching max size of header URI H2_ERR_MAX_STREAM_PER_CONN Counter for reaching advertised concurrent stream limit H2_PANIC_CONN Counter for connection panic H2_PANIC_STREAM Counter for stream panic H2_REQ_HEADER_COMPRESS_SIZE Size of request header after compress H2_REQ_HEADER_ORIGINAL_SIZE Size of request header before compress H2_REQ_OVERLOAD Counter for exceeding request rate limit H2_RES_HEADER_COMPRESS_SIZE Size of response header after compress H2_RES_HEADER_ORIGINAL_SIZE Size of response header before compress H2_TIMEOUT_CONN Counter for timeout of HTTP2 connection timeout H2_TIMEOUT_PREFACE Counter for timeout of waiting for client preface H2_TIMEOUT_READ_STREAM Counter for timeout of waiting for reading stream H2_TIMEOUT_SETTING Counter for timeout of waiting for SETTINGS frames H2_TIMEOUT_WRITE_STREAM Counter for timeout of waiting for writing stream","title":"HTTP2"},{"location":"monitor/http2_state/#http2","text":"","title":"HTTP2"},{"location":"monitor/http2_state/#introduction","text":"http2_state monitor state of HTTP2.","title":"Introduction"},{"location":"monitor/http2_state/#monitor-item","text":"Monitor Item Description H2_CONN_OVERLOAD Counter for exceeding connection rate limit H2_ERR_GOT_RESET Counter for gettting RST_STREAM H2_ERR_MAX_HEADER_LIST_SIZE Counter for reaching max size of header list H2_ERR_MAX_HEADER_URI_SIZE Counter for reaching max size of header URI H2_ERR_MAX_STREAM_PER_CONN Counter for reaching advertised concurrent stream limit H2_PANIC_CONN Counter for connection panic H2_PANIC_STREAM Counter for stream panic H2_REQ_HEADER_COMPRESS_SIZE Size of request header after compress H2_REQ_HEADER_ORIGINAL_SIZE Size of request header before compress H2_REQ_OVERLOAD Counter for exceeding request rate limit H2_RES_HEADER_COMPRESS_SIZE Size of response header after compress H2_RES_HEADER_ORIGINAL_SIZE Size of response header before compress H2_TIMEOUT_CONN Counter for timeout of HTTP2 connection timeout H2_TIMEOUT_PREFACE Counter for timeout of waiting for client preface H2_TIMEOUT_READ_STREAM Counter for timeout of waiting for reading stream H2_TIMEOUT_SETTING Counter for timeout of waiting for SETTINGS frames H2_TIMEOUT_WRITE_STREAM Counter for timeout of waiting for writing stream","title":"Monitor Item"},{"location":"monitor/http_state/","text":"HTTP Introduction http_state monitor state of HTTP1.0/1.1. Monitor Item Monitor Item Description HTTP_BACKEND_CONN_ALL Counter for connecting with backend HTTP_BACKEND_CONN_SUCC Counter for connecting successfully with backend HTTP_BACKEND_REQ_ALL Counter for sending request to backend HTTP_BACKEND_REQ_SUCC Counter for sending successfully request to backend HTTP_CANCEL_ON_CLIENT_CLOSE Counter for closing connection when finding client disconnected HTTP_PANIC_BACKEND_READ Counter for reading backend panic HTTP_PANIC_BACKEND_WRITE Counter for writing backend panic HTTP_PANIC_CLIENT_FLUSH_LOOP Counter for client flushing loop panic HTTP_PANIC_CLIENT_WATCH_LOOP Counter for client watching loop panic","title":"HTTP"},{"location":"monitor/http_state/#http","text":"","title":"HTTP"},{"location":"monitor/http_state/#introduction","text":"http_state monitor state of HTTP1.0/1.1.","title":"Introduction"},{"location":"monitor/http_state/#monitor-item","text":"Monitor Item Description HTTP_BACKEND_CONN_ALL Counter for connecting with backend HTTP_BACKEND_CONN_SUCC Counter for connecting successfully with backend HTTP_BACKEND_REQ_ALL Counter for sending request to backend HTTP_BACKEND_REQ_SUCC Counter for sending successfully request to backend HTTP_CANCEL_ON_CLIENT_CLOSE Counter for closing connection when finding client disconnected HTTP_PANIC_BACKEND_READ Counter for reading backend panic HTTP_PANIC_BACKEND_WRITE Counter for writing backend panic HTTP_PANIC_CLIENT_FLUSH_LOOP Counter for client flushing loop panic HTTP_PANIC_CLIENT_WATCH_LOOP Counter for client watching loop panic","title":"Monitor Item"},{"location":"monitor/module_status/","text":"Modules Introduction module_status monitor status of modules. Monitor Item Monitor Item Description available List of available modules enabled List of enable modules For more details about metrics of each module, see BFE modules .","title":"Modules"},{"location":"monitor/module_status/#modules","text":"","title":"Modules"},{"location":"monitor/module_status/#introduction","text":"module_status monitor status of modules.","title":"Introduction"},{"location":"monitor/module_status/#monitor-item","text":"Monitor Item Description available List of available modules enabled List of enable modules For more details about metrics of each module, see BFE modules .","title":"Monitor Item"},{"location":"monitor/proxy_XXX_delay/","text":"Proxy Lentency Introduction proxy_XXX_delay monitor state of proxy delay. Monitor Item Monitor Item Description Interval Interval of get proxy delay. KeyPrefix Key prefix ProgramName Program name CurrTime Current time Current Proxy delay data of current interval time PastTime Last statistic time Past Proxy delay data of last statistic time proxy Delay Data Monitor Item Description BucketSize Size of each delay bucket, e.g., 1(ms) or 2(ms) BucketNum Number of bucket Count Total number of samples Sum Summary data, in Microsecond Ave Average data, in Microsecond Counters Counters are counters for each bucket. e.g., for bucketSize == 1ms, BucketNum == 5, counters are for 0-1, 1-2, 2-3, 3-4, 4-5, >5","title":"Lentency histogram"},{"location":"monitor/proxy_XXX_delay/#proxy-lentency","text":"","title":"Proxy Lentency"},{"location":"monitor/proxy_XXX_delay/#introduction","text":"proxy_XXX_delay monitor state of proxy delay.","title":"Introduction"},{"location":"monitor/proxy_XXX_delay/#monitor-item","text":"Monitor Item Description Interval Interval of get proxy delay. KeyPrefix Key prefix ProgramName Program name CurrTime Current time Current Proxy delay data of current interval time PastTime Last statistic time Past Proxy delay data of last statistic time","title":"Monitor Item"},{"location":"monitor/proxy_XXX_delay/#proxy-delay-data","text":"Monitor Item Description BucketSize Size of each delay bucket, e.g., 1(ms) or 2(ms) BucketNum Number of bucket Count Total number of samples Sum Summary data, in Microsecond Ave Average data, in Microsecond Counters Counters are counters for each bucket. e.g., for bucketSize == 1ms, BucketNum == 5, counters are for 0-1, 1-2, 2-3, 3-4, 4-5, >5","title":"proxy Delay Data"},{"location":"monitor/proxy_mem_stat/","text":"Introduction proxy_mem_stat monitor memory state of BFE server. Monitor Item Memory State is descriped by MemStat in runtime package in golang. Monitor Item Description Alloc Bytes allocated and still in use TotalAlloc Bytes allocated (even if freed) Sys Bytes obtained from system (sum of XxxSys below) Lookups Number of pointer lookups Mallocs Number of mallocs Frees Number of frees HeapAlloc Bytes allocated and still in use HeapSys Bytes obtained from system HeapIdle Bytes in idle spans HeapInuse Bytes in non-idle span HeapReleased Bytes released to the OS HeapObjects Total number of allocated objects StackInuse Bytes used now by stack allocator StackSys Bytes obtained from system by stack allocator MSpanInuse Mspan structures used now MSpanSys Mspan structures obtained from system MCacheInuse Mcache structures used now MCacheSys Mcache structures obtained from system BuckHashSys Profiling bucket hash table GCSys GC metadata OtherSys Other system allocations NextGC Next collection will happen when HeapAlloc \u2265 this amount LastGC End time of last collection (nanoseconds since 1970) PauseTotalNs Total time of GC pause time PauseNs Circular buffer of recent GC pause durations, most recent at [(NumGC+255)%256] PauseEnd Circular buffer of recent GC pause end times NumGC Number of GC EnableGC Enable GC or not DebugGC Enbale debug GC or not BySize Per-size allocation statistics","title":"Introduction"},{"location":"monitor/proxy_mem_stat/#introduction","text":"proxy_mem_stat monitor memory state of BFE server.","title":"Introduction"},{"location":"monitor/proxy_mem_stat/#monitor-item","text":"Memory State is descriped by MemStat in runtime package in golang. Monitor Item Description Alloc Bytes allocated and still in use TotalAlloc Bytes allocated (even if freed) Sys Bytes obtained from system (sum of XxxSys below) Lookups Number of pointer lookups Mallocs Number of mallocs Frees Number of frees HeapAlloc Bytes allocated and still in use HeapSys Bytes obtained from system HeapIdle Bytes in idle spans HeapInuse Bytes in non-idle span HeapReleased Bytes released to the OS HeapObjects Total number of allocated objects StackInuse Bytes used now by stack allocator StackSys Bytes obtained from system by stack allocator MSpanInuse Mspan structures used now MSpanSys Mspan structures obtained from system MCacheInuse Mcache structures used now MCacheSys Mcache structures obtained from system BuckHashSys Profiling bucket hash table GCSys GC metadata OtherSys Other system allocations NextGC Next collection will happen when HeapAlloc \u2265 this amount LastGC End time of last collection (nanoseconds since 1970) PauseTotalNs Total time of GC pause time PauseNs Circular buffer of recent GC pause durations, most recent at [(NumGC+255)%256] PauseEnd Circular buffer of recent GC pause end times NumGC Number of GC EnableGC Enable GC or not DebugGC Enbale debug GC or not BySize Per-size allocation statistics","title":"Monitor Item"},{"location":"monitor/proxy_state/","text":"Proxy Introduction proxy_state monitor state of proxy. Monitor Item Monitor Item Description CLIENT_CONN_ACTIVE Counter for active connection CLIENT_CONN_SERVED Counter for connection serverd CLIENT_CONN_UNFINISHED_REQ Counter for connection closed with unfinished request CLIENT_CONN_USE100_CONTINUE Counter for connection used expect 100 continue CLIENT_REQ_ACTIVE Counter for active request CLIENT_REQ_FAIL Counter for failed request CLIENT_REQ_FAIL_WITH_NO_RETRY Counter for request fail with no retry CLIENT_REQ_SERVED Counter for request serverd CLIENT_REQ_WITH_CROSS_RETRY Counter for request serverd with cross cluster retry CLIENT_REQ_WITH_RETRY Counter for request serverd with retry ERR_BK_CONNECT_BACKEND Counter for connecting backend failed ERR_BK_FIND_LOCATION Counter for finding location failed ERR_BK_FIND_PRODUCT Counter for finding product failed ERR_BK_NO_BALANCE Counter for no balance config of backend ERR_BK_NO_CLUSTER Counter for no cluster config of backend ERR_BK_READ_RESP_HEADER Counter for reading response header from backend failed ERR_BK_REQUEST_BACKEND Counter for fail in invoking backend ERR_BK_RESP_HEADER_TIMEOUT Counter for getting response header from backend timeout ERR_BK_TRANSPORT_BROKEN Counter for transport broken of backend ERR_BK_WRITE_REQUEST Counter for writing request to backend failed ERR_CLIENT_BAD_REQUEST Counter for bad request of client ERR_CLIENT_CLOSE Counter for client closing connection ERR_CLIENT_CONN_ACCEPT Counter for accepting connection from client failed ERR_CLIENT_EXPECT_FAIL Counter for expecting fail from client ERR_CLIENT_LONG_HEADER Counter for request entity too large ERR_CLIENT_LONG_URL Counter for exceeding URI length limit ERR_CLIENT_RESET Counter for reseting by client ERR_CLIENT_TIMEOUT Counter for connecting with client timeout ERR_CLIENT_WRITE Counter for writing request to client failed ERR_CLIENT_ZERO_CONTENTLEN Counter for getting empty request content from client HTTP2_CLIENT_CONN_ACTIVE Counter for active connection using HTTP2 HTTP2_CLIENT_CONN_SERVED Counter for connection serverd using HTTP2 HTTP2_CLIENT_REQ_ACTIVE Counter for active request using HTTP2 HTTP2_CLIENT_REQ_SERVED Counter for request serverd using HTTP2 HTTPS_CLIENT_CONN_ACTIVE Counter for active connection using HTTPS HTTPS_CLIENT_CONN_SERVED Counter for connection serverd using HTTPS HTTPS_CLIENT_REQ_ACTIVE Counter for active request using HTTPS HTTPS_CLIENT_REQ_SERVED Counter for request serverd using HTTPS HTTP_CLIENT_CONN_ACTIVE Counter for active connection using HTTP1.0/1.1 HTTP_CLIENT_CONN_SERVED Counter for connection serverd using HTTP1.0/1.1 HTTP_CLIENT_REQ_ACTIVE Counter for active request using HTTP1.0/1.1 HTTP_CLIENT_REQ_SERVED Counter for request serverd using HTTP1.0/1.1 PANIC_BACKEND_READ Counter for reading from backend panic PANIC_BACKEND_WRITE Counter for writing to backend panic PANIC_CLIENT_CONN_SERVE Counter for accepting from client panic SESSION_CACHE_CONN Counter for connection using session cache SESSION_CACHE_CONN_FAIL Counter for failed connection using session cache SESSION_CACHE_GET Counter for getting session cache SESSION_CACHE_GET_FAIL Counter for getting session cache failed SESSION_CACHE_HIT Counter for hittting session cache SESSION_CACHE_MISS Counter for misssing session cache SESSION_CACHE_SET Counter for setting session cache SESSION_CACHE_SET_FAIL Counter for setting session cache failed SESSION_CACHE_TYPE_NOT_BYTES Counter for type of session cache is not bytes SPDY_CLIENT_CONN_ACTIVE Counter for active connection using SPDY SPDY_CLIENT_CONN_SERVED Counter for connection serverd using SPDY SPDY_CLIENT_REQ_ACTIVE Counter for active request using SPDY SPDY_CLIENT_REQ_SERVED Counter for request serverd using SPDY STREAM_CLIENT_CONN_ACTIVE Counter for active connection using STREAM STREAM_CLIENT_CONN_SERVED Counter for connection serverd using STREAM TLS_HANDSHAKE_ALL Counter for TLS handshake TLS_HANDSHAKE_SUCC Counter for successful TLS handshake TLS_MULTI_CERT_CONN_VIP_UNKNOWN Counter for not getting TLS cert by vip TLS_MULTI_CERT_CONN_WITHOUT_SNI Counter for getting TLS cert not by SNI TLS_MULTI_CERT_CONN_WITHOUT_VIP Counter for getting TLS cert not by vip TLS_MULTI_CERT_GET Counter for getting TLS cert TLS_MULTI_CERT_UPDATE Counter for updating TLS cert TLS_MULTI_CERT_UPDATE_ERR Counter for updating TLS cert failed TLS_MULTI_CERT_USE_DEFAULT Counter for using TLS cert default WSS_CLIENT_CONN_ACTIVE Counter for active connection using WSS WSS_CLIENT_CONN_SERVED Counter for connection serverd using WSS WS_CLIENT_CONN_ACTIVE Counter for active connection using WS WS_CLIENT_CONN_SERVED Counter for connection serverd using WS","title":"Proxy state"},{"location":"monitor/proxy_state/#proxy","text":"","title":"Proxy"},{"location":"monitor/proxy_state/#introduction","text":"proxy_state monitor state of proxy.","title":"Introduction"},{"location":"monitor/proxy_state/#monitor-item","text":"Monitor Item Description CLIENT_CONN_ACTIVE Counter for active connection CLIENT_CONN_SERVED Counter for connection serverd CLIENT_CONN_UNFINISHED_REQ Counter for connection closed with unfinished request CLIENT_CONN_USE100_CONTINUE Counter for connection used expect 100 continue CLIENT_REQ_ACTIVE Counter for active request CLIENT_REQ_FAIL Counter for failed request CLIENT_REQ_FAIL_WITH_NO_RETRY Counter for request fail with no retry CLIENT_REQ_SERVED Counter for request serverd CLIENT_REQ_WITH_CROSS_RETRY Counter for request serverd with cross cluster retry CLIENT_REQ_WITH_RETRY Counter for request serverd with retry ERR_BK_CONNECT_BACKEND Counter for connecting backend failed ERR_BK_FIND_LOCATION Counter for finding location failed ERR_BK_FIND_PRODUCT Counter for finding product failed ERR_BK_NO_BALANCE Counter for no balance config of backend ERR_BK_NO_CLUSTER Counter for no cluster config of backend ERR_BK_READ_RESP_HEADER Counter for reading response header from backend failed ERR_BK_REQUEST_BACKEND Counter for fail in invoking backend ERR_BK_RESP_HEADER_TIMEOUT Counter for getting response header from backend timeout ERR_BK_TRANSPORT_BROKEN Counter for transport broken of backend ERR_BK_WRITE_REQUEST Counter for writing request to backend failed ERR_CLIENT_BAD_REQUEST Counter for bad request of client ERR_CLIENT_CLOSE Counter for client closing connection ERR_CLIENT_CONN_ACCEPT Counter for accepting connection from client failed ERR_CLIENT_EXPECT_FAIL Counter for expecting fail from client ERR_CLIENT_LONG_HEADER Counter for request entity too large ERR_CLIENT_LONG_URL Counter for exceeding URI length limit ERR_CLIENT_RESET Counter for reseting by client ERR_CLIENT_TIMEOUT Counter for connecting with client timeout ERR_CLIENT_WRITE Counter for writing request to client failed ERR_CLIENT_ZERO_CONTENTLEN Counter for getting empty request content from client HTTP2_CLIENT_CONN_ACTIVE Counter for active connection using HTTP2 HTTP2_CLIENT_CONN_SERVED Counter for connection serverd using HTTP2 HTTP2_CLIENT_REQ_ACTIVE Counter for active request using HTTP2 HTTP2_CLIENT_REQ_SERVED Counter for request serverd using HTTP2 HTTPS_CLIENT_CONN_ACTIVE Counter for active connection using HTTPS HTTPS_CLIENT_CONN_SERVED Counter for connection serverd using HTTPS HTTPS_CLIENT_REQ_ACTIVE Counter for active request using HTTPS HTTPS_CLIENT_REQ_SERVED Counter for request serverd using HTTPS HTTP_CLIENT_CONN_ACTIVE Counter for active connection using HTTP1.0/1.1 HTTP_CLIENT_CONN_SERVED Counter for connection serverd using HTTP1.0/1.1 HTTP_CLIENT_REQ_ACTIVE Counter for active request using HTTP1.0/1.1 HTTP_CLIENT_REQ_SERVED Counter for request serverd using HTTP1.0/1.1 PANIC_BACKEND_READ Counter for reading from backend panic PANIC_BACKEND_WRITE Counter for writing to backend panic PANIC_CLIENT_CONN_SERVE Counter for accepting from client panic SESSION_CACHE_CONN Counter for connection using session cache SESSION_CACHE_CONN_FAIL Counter for failed connection using session cache SESSION_CACHE_GET Counter for getting session cache SESSION_CACHE_GET_FAIL Counter for getting session cache failed SESSION_CACHE_HIT Counter for hittting session cache SESSION_CACHE_MISS Counter for misssing session cache SESSION_CACHE_SET Counter for setting session cache SESSION_CACHE_SET_FAIL Counter for setting session cache failed SESSION_CACHE_TYPE_NOT_BYTES Counter for type of session cache is not bytes SPDY_CLIENT_CONN_ACTIVE Counter for active connection using SPDY SPDY_CLIENT_CONN_SERVED Counter for connection serverd using SPDY SPDY_CLIENT_REQ_ACTIVE Counter for active request using SPDY SPDY_CLIENT_REQ_SERVED Counter for request serverd using SPDY STREAM_CLIENT_CONN_ACTIVE Counter for active connection using STREAM STREAM_CLIENT_CONN_SERVED Counter for connection serverd using STREAM TLS_HANDSHAKE_ALL Counter for TLS handshake TLS_HANDSHAKE_SUCC Counter for successful TLS handshake TLS_MULTI_CERT_CONN_VIP_UNKNOWN Counter for not getting TLS cert by vip TLS_MULTI_CERT_CONN_WITHOUT_SNI Counter for getting TLS cert not by SNI TLS_MULTI_CERT_CONN_WITHOUT_VIP Counter for getting TLS cert not by vip TLS_MULTI_CERT_GET Counter for getting TLS cert TLS_MULTI_CERT_UPDATE Counter for updating TLS cert TLS_MULTI_CERT_UPDATE_ERR Counter for updating TLS cert failed TLS_MULTI_CERT_USE_DEFAULT Counter for using TLS cert default WSS_CLIENT_CONN_ACTIVE Counter for active connection using WSS WSS_CLIENT_CONN_SERVED Counter for connection serverd using WSS WS_CLIENT_CONN_ACTIVE Counter for active connection using WS WS_CLIENT_CONN_SERVED Counter for connection serverd using WS","title":"Monitor Item"},{"location":"monitor/spdy_state/","text":"SPDY Introduction spdy_state monitor state of SPDY. Monitor Item Monitor Item Description SPDY_CONN_OVERLOAD Counter for exceeding connection rate limit SPDY_ERR_BAD_REQUEST Counter for bad request SPDY_ERR_FLOW_CONTROL Counter for flow control SPDY_ERR_GOT_RESET Counter for gettting RST_STREAM SPDY_ERR_INVALID_DATA_STREAM Counter for invalid data stream SPDY_ERR_INVALID_SYN_STREAM Counter for invalid SYN stream SPDY_ERR_MAX_STREAM_PER_CONN Counter for reaching advertised concurrent stream limit SPDY_ERR_NEW_FRAMER Counter for creating frame failed SPDY_ERR_STREAM_ALREADY_CLOSED Counter for stream already closed SPDY_ERR_STREAM_CANCEL Counter for canceling stream SPDY_PANIC_CONN Counter for connection panic SPDY_PANIC_STREAM Counter for stream panic SPDY_REQ_HEADER_COMPRESS_SIZE Size of request header before compress SPDY_REQ_HEADER_ORIGINAL_SIZE Size of request header after compress SPDY_REQ_OVERLOAD Counter for exceeding request rate limit SPDY_RES_HEADER_COMPRESS_SIZE Size of response header before compress SPDY_RES_HEADER_ORIGINAL_SIZE Size of response header after compress SPDY_TIMEOUT_CONN Timeout of SPDY connection SPDY_TIMEOUT_READ_STREAM Timeout waiting for reading stream SPDY_TIMEOUT_WRITE_STREAM Timeout waiting for writing stream SPDY_UNKNOWN_FRAME Counter for unknown frame","title":"SPDY"},{"location":"monitor/spdy_state/#spdy","text":"","title":"SPDY"},{"location":"monitor/spdy_state/#introduction","text":"spdy_state monitor state of SPDY.","title":"Introduction"},{"location":"monitor/spdy_state/#monitor-item","text":"Monitor Item Description SPDY_CONN_OVERLOAD Counter for exceeding connection rate limit SPDY_ERR_BAD_REQUEST Counter for bad request SPDY_ERR_FLOW_CONTROL Counter for flow control SPDY_ERR_GOT_RESET Counter for gettting RST_STREAM SPDY_ERR_INVALID_DATA_STREAM Counter for invalid data stream SPDY_ERR_INVALID_SYN_STREAM Counter for invalid SYN stream SPDY_ERR_MAX_STREAM_PER_CONN Counter for reaching advertised concurrent stream limit SPDY_ERR_NEW_FRAMER Counter for creating frame failed SPDY_ERR_STREAM_ALREADY_CLOSED Counter for stream already closed SPDY_ERR_STREAM_CANCEL Counter for canceling stream SPDY_PANIC_CONN Counter for connection panic SPDY_PANIC_STREAM Counter for stream panic SPDY_REQ_HEADER_COMPRESS_SIZE Size of request header before compress SPDY_REQ_HEADER_ORIGINAL_SIZE Size of request header after compress SPDY_REQ_OVERLOAD Counter for exceeding request rate limit SPDY_RES_HEADER_COMPRESS_SIZE Size of response header before compress SPDY_RES_HEADER_ORIGINAL_SIZE Size of response header after compress SPDY_TIMEOUT_CONN Timeout of SPDY connection SPDY_TIMEOUT_READ_STREAM Timeout waiting for reading stream SPDY_TIMEOUT_WRITE_STREAM Timeout waiting for writing stream SPDY_UNKNOWN_FRAME Counter for unknown frame","title":"Monitor Item"},{"location":"monitor/stream_state/","text":"Stream Introduction stream_state monitor state of STREAM. Monitor Item Monitor Item Description STREAM_BYTES_RECV Counter for receiving stream bytes STREAM_BYTES_SENT Counter for sending stream bytes STREAM_ERR_BALANCE Counter for balance error STREAM_ERR_CONNECT Counter for connecting backend error STREAM_ERR_PROXY Counter for finding backend error STREAM_ERR_TRANSFER Counter for transfer error STREAM_PANIC_CONN Counter for connection panic","title":"Stream"},{"location":"monitor/stream_state/#stream","text":"","title":"Stream"},{"location":"monitor/stream_state/#introduction","text":"stream_state monitor state of STREAM.","title":"Introduction"},{"location":"monitor/stream_state/#monitor-item","text":"Monitor Item Description STREAM_BYTES_RECV Counter for receiving stream bytes STREAM_BYTES_SENT Counter for sending stream bytes STREAM_ERR_BALANCE Counter for balance error STREAM_ERR_CONNECT Counter for connecting backend error STREAM_ERR_PROXY Counter for finding backend error STREAM_ERR_TRANSFER Counter for transfer error STREAM_PANIC_CONN Counter for connection panic","title":"Monitor Item"},{"location":"monitor/tls_state/","text":"TLS Introduction tls_state monitor state of TLS. Monitor Item Monitor Item Description TLS_HANDSHAKE_ACCEPT_ECDHE_WITHOUT_EXT Counter for proposing ECDHE without extensions TLS_HANDSHAKE_ACCEPT_SSLV2_CLIENT_HELLO Counter for accepting SSLv2 client-hello TLS_HANDSHAKE_CHECK_RESUME_SESSION_CACHE Counter for checking resume session cache TLS_HANDSHAKE_CHECK_RESUME_SESSION_TICKET Counter for checking resume session ticket TLS_HANDSHAKE_FULL_ALL Counter for full TLS handshake TLS_HANDSHAKE_FULL_SUCC Counter for successful TLS handshake TLS_HANDSHAKE_NO_SHARED_CIPHER_SUITE Counter for no cipher suite supported by both client and server TLS_HANDSHAKE_OCSP_TIME_ERR Counter for ocsp time error TLS_HANDSHAKE_READ_CLIENT_HELLO_ERR Counter for reading client-hello error TLS_HANDSHAKE_RESUME_ALL Counter for resuming session TLS_HANDSHAKE_RESUME_SUCC Counter for resuming session successfully TLS_HANDSHAKE_SHOULD_RESUME_SESSION_CACHE Counter for resuming session by session cache TLS_HANDSHAKE_SHOULD_RESUME_SESSION_TICKET Counter for resuming session by session ticket TLS_HANDSHAKE_SSLV2_NOT_SUPPORT Counter for unsupported SSLv2 handshake received TLS_HANDSHAKE_ZERO_DATA Counter for zero data TLS_STATUS_REQUEST_EXT_COUNT Counter for request extensions","title":"SSL/TLS"},{"location":"monitor/tls_state/#tls","text":"","title":"TLS"},{"location":"monitor/tls_state/#introduction","text":"tls_state monitor state of TLS.","title":"Introduction"},{"location":"monitor/tls_state/#monitor-item","text":"Monitor Item Description TLS_HANDSHAKE_ACCEPT_ECDHE_WITHOUT_EXT Counter for proposing ECDHE without extensions TLS_HANDSHAKE_ACCEPT_SSLV2_CLIENT_HELLO Counter for accepting SSLv2 client-hello TLS_HANDSHAKE_CHECK_RESUME_SESSION_CACHE Counter for checking resume session cache TLS_HANDSHAKE_CHECK_RESUME_SESSION_TICKET Counter for checking resume session ticket TLS_HANDSHAKE_FULL_ALL Counter for full TLS handshake TLS_HANDSHAKE_FULL_SUCC Counter for successful TLS handshake TLS_HANDSHAKE_NO_SHARED_CIPHER_SUITE Counter for no cipher suite supported by both client and server TLS_HANDSHAKE_OCSP_TIME_ERR Counter for ocsp time error TLS_HANDSHAKE_READ_CLIENT_HELLO_ERR Counter for reading client-hello error TLS_HANDSHAKE_RESUME_ALL Counter for resuming session TLS_HANDSHAKE_RESUME_SUCC Counter for resuming session successfully TLS_HANDSHAKE_SHOULD_RESUME_SESSION_CACHE Counter for resuming session by session cache TLS_HANDSHAKE_SHOULD_RESUME_SESSION_TICKET Counter for resuming session by session ticket TLS_HANDSHAKE_SSLV2_NOT_SUPPORT Counter for unsupported SSLv2 handshake received TLS_HANDSHAKE_ZERO_DATA Counter for zero data TLS_STATUS_REQUEST_EXT_COUNT Counter for request extensions","title":"Monitor Item"},{"location":"monitor/websocket_state/","text":"WebSocket Introduction websocket_state monitor state of websocket. Monitor Item Monitor Item Description WEB_SOCKET_BYTES_RECV Counter for receiving websocket bytes WEB_SOCKET_BYTES_SENT Counter for sending websocket bytes WEB_SOCKET_ERR_BACKEND_REJECT Counter for rejecting backend WEB_SOCKET_ERR_BALANCE Counter for balance error WEB_SOCKET_ERR_CONNECT Counter for connecting error WEB_SOCKET_ERR_HANDSHAKE Counter for handshake error WEB_SOCKET_ERR_PROXY Counter for finding backend WEB_SOCKET_ERR_TRANSFER Counter for transfer error WEB_SOCKET_PANIC_CONN Counter for connection panic","title":"WebSocket"},{"location":"monitor/websocket_state/#websocket","text":"","title":"WebSocket"},{"location":"monitor/websocket_state/#introduction","text":"websocket_state monitor state of websocket.","title":"Introduction"},{"location":"monitor/websocket_state/#monitor-item","text":"Monitor Item Description WEB_SOCKET_BYTES_RECV Counter for receiving websocket bytes WEB_SOCKET_BYTES_SENT Counter for sending websocket bytes WEB_SOCKET_ERR_BACKEND_REJECT Counter for rejecting backend WEB_SOCKET_ERR_BALANCE Counter for balance error WEB_SOCKET_ERR_CONNECT Counter for connecting error WEB_SOCKET_ERR_HANDSHAKE Counter for handshake error WEB_SOCKET_ERR_PROXY Counter for finding backend WEB_SOCKET_ERR_TRANSFER Counter for transfer error WEB_SOCKET_PANIC_CONN Counter for connection panic","title":"Monitor Item"},{"location":"operation/capture_packet/","text":"Traffic tapping Use packet capture and analysis tools to locate and analyze complex network problems Traffic capture tcpdump example\uff1a # tcpdump tcp port 8443 -i any -s -w test.pcap Traffic analysis Plaintext traffic Use wireshark to open packet capture file. Ciphertext traffic For TLS-based encrypted traffic, you can use mod_key_log and wireshark for analysis. Step1: Enable mod_key_log module and save the TLS session key to key.log file Note\uff1amodify bfe.conf and enable mod_key_log, See module configuration mod_key_log for details [Server] Modules = mod_key_log Step2: Set the path of the Master-Secret log file to key.log in wireshark Note\uff1aEdit\u2192Preferences\u2192Protocols\u2192SSL\u2192(Pre)-Master-Secret log filename Step3: Use wireshark to open and decrypt the captured data","title":"Traffic tapping"},{"location":"operation/capture_packet/#traffic-tapping","text":"Use packet capture and analysis tools to locate and analyze complex network problems","title":"Traffic tapping"},{"location":"operation/capture_packet/#traffic-capture","text":"tcpdump example\uff1a # tcpdump tcp port 8443 -i any -s -w test.pcap","title":"Traffic capture"},{"location":"operation/capture_packet/#traffic-analysis","text":"","title":"Traffic analysis"},{"location":"operation/capture_packet/#plaintext-traffic","text":"Use wireshark to open packet capture file.","title":"Plaintext traffic"},{"location":"operation/capture_packet/#ciphertext-traffic","text":"For TLS-based encrypted traffic, you can use mod_key_log and wireshark for analysis. Step1: Enable mod_key_log module and save the TLS session key to key.log file Note\uff1amodify bfe.conf and enable mod_key_log, See module configuration mod_key_log for details [Server] Modules = mod_key_log Step2: Set the path of the Master-Secret log file to key.log in wireshark Note\uff1aEdit\u2192Preferences\u2192Protocols\u2192SSL\u2192(Pre)-Master-Secret log filename Step3: Use wireshark to open and decrypt the captured data","title":"Ciphertext traffic"},{"location":"operation/command/","text":"Command line options bfe bfe [options] -c <config dir> The root directory of configuration files, default directory is ./conf -l <log dir> The root directory of log files, default directory is ./log -s Print logs to stdout. By default, this flag is set false. -d Print debug logs. By default, this flag is set false. -v Display bfe version and exit. By default, this flag is set false. -V Display verbose version information and exit. By default, this flag is set false. -h Display help infomation and exit. By default, this flag is set false.","title":"Command line pptions"},{"location":"operation/command/#command-line-options","text":"","title":"Command line options"},{"location":"operation/command/#bfe","text":"bfe [options] -c <config dir> The root directory of configuration files, default directory is ./conf -l <log dir> The root directory of log files, default directory is ./log -s Print logs to stdout. By default, this flag is set false. -d Print debug logs. By default, this flag is set false. -v Display bfe version and exit. By default, this flag is set false. -V Display verbose version information and exit. By default, this flag is set false. -h Display help infomation and exit. By default, this flag is set false.","title":"bfe"},{"location":"operation/env_var/","text":"Environment arguments GODEBUG Output verbose log about http2 header info $ export GODEBUG = \"http2debug=1\" Output verbose log about http2 header and framer info $ export GODEBUG = \"http2debug=2\"","title":"Environment variables"},{"location":"operation/env_var/#environment-arguments","text":"","title":"Environment arguments"},{"location":"operation/env_var/#godebug","text":"Output verbose log about http2 header info $ export GODEBUG = \"http2debug=1\" Output verbose log about http2 header and framer info $ export GODEBUG = \"http2debug=2\"","title":"GODEBUG"},{"location":"operation/log_rotation/","text":"Log rotation Introdution As time passes, the size of log files increases and occupies more and more disk space. BFE has a built-in feature of log file rotation which can automatically rotate log files, remove old ones and retain the recent ones. Description Name Path Rotation Configuration Server Log log/bfe.log rotate log file at midnight; retain the recent 7 log files Access Log log/access.log conf/mod_access/mod_access.conf TLS Key Log log/key.log conf/mod_key_log/mod_key_log.conf","title":"Log rotation"},{"location":"operation/log_rotation/#log-rotation","text":"","title":"Log rotation"},{"location":"operation/log_rotation/#introdution","text":"As time passes, the size of log files increases and occupies more and more disk space. BFE has a built-in feature of log file rotation which can automatically rotate log files, remove old ones and retain the recent ones.","title":"Introdution"},{"location":"operation/log_rotation/#description","text":"Name Path Rotation Configuration Server Log log/bfe.log rotate log file at midnight; retain the recent 7 log files Access Log log/access.log conf/mod_access/mod_access.conf TLS Key Log log/key.log conf/mod_key_log/mod_key_log.conf","title":"Description"},{"location":"operation/monitor/","text":"System metrics BFE has a variety of built-in metrics which can be exposed in various formats. Configure monitor port Set monitor port in the BFE core configuration file (conf/bfe.conf). [Server] MonitorPort = 8421 Fetch metric categories Visit the following address for a list of available metric categories http://<addr>:8421/monitor Fetch metrics http://<addr>:8421/monitor/<category> Fetch metric data in specified format Currently supported formats: * prometheus * kv * json (default) Specify the format of the output like below: http://<addr>:8421/monitor/proxy_state?format=prometheus","title":"System metrics"},{"location":"operation/monitor/#system-metrics","text":"BFE has a variety of built-in metrics which can be exposed in various formats.","title":"System metrics"},{"location":"operation/monitor/#configure-monitor-port","text":"Set monitor port in the BFE core configuration file (conf/bfe.conf). [Server] MonitorPort = 8421","title":"Configure monitor port"},{"location":"operation/monitor/#fetch-metric-categories","text":"Visit the following address for a list of available metric categories http://<addr>:8421/monitor","title":"Fetch metric categories"},{"location":"operation/monitor/#fetch-metrics","text":"http://<addr>:8421/monitor/<category>","title":"Fetch metrics"},{"location":"operation/monitor/#fetch-metric-data-in-specified-format","text":"Currently supported formats: * prometheus * kv * json (default) Specify the format of the output like below: http://<addr>:8421/monitor/proxy_state?format=prometheus","title":"Fetch metric data in specified format"},{"location":"operation/performance/","text":"Performance BFE has built-in CPU profile interfaces, which can be used in conjunction with the FlameGraph tool to locate and analyze performance problems. Configs Use the same port as the monitor [server] monitorPort = 8421 Tools FlameGragh $ git clone https://github.com/brendangregg/FlameGraph Which contains stackcollpase-go.pl and flamegraph.pl tools Step Get performance sampling data $ go tool pprof -seconds = 60 -raw -output = bfe.pprof http://<addr>:<port>/debug/pprof/profile Note: seconds=60 means capturing 60 seconds of stack samples Transform and draw FlameGraph $ ./stackcollpase-go.pl bfe.pporf > bfe.flame $ ./flamegraph.pl bfe.flame > bfe.svg Open bfe.svg in browser","title":"Performance"},{"location":"operation/performance/#performance","text":"BFE has built-in CPU profile interfaces, which can be used in conjunction with the FlameGraph tool to locate and analyze performance problems.","title":"Performance"},{"location":"operation/performance/#configs","text":"Use the same port as the monitor [server] monitorPort = 8421","title":"Configs"},{"location":"operation/performance/#tools","text":"FlameGragh $ git clone https://github.com/brendangregg/FlameGraph Which contains stackcollpase-go.pl and flamegraph.pl tools","title":"Tools"},{"location":"operation/performance/#step","text":"Get performance sampling data $ go tool pprof -seconds = 60 -raw -output = bfe.pprof http://<addr>:<port>/debug/pprof/profile Note: seconds=60 means capturing 60 seconds of stack samples Transform and draw FlameGraph $ ./stackcollpase-go.pl bfe.pporf > bfe.flame $ ./flamegraph.pl bfe.flame > bfe.svg Open bfe.svg in browser","title":"Step"},{"location":"operation/reload/","text":"Configuration Reload BFE has built-in feature of configuration hot-reload. A new configuration file can be reload by sending a reload request. Configure monitor port Set MonitorPort in BFE core configuration file(conf/bfe.conf) [Server] MonitorPort = 8421 How to reload Reload APIs only allows to be accessed using localhost\uff08127.0.0.1/::1\uff09and only supports GET requests # reload routing configurations $ curl http://localhost:8421/reload/server_data_conf The complete list of reload APIs can be viewed at http://localhost:8421/reload Reload APIs Basic function Function Default configuration file Reload API routing server_data_conf/host_rule.data server_data_conf/vip_rule.data server_data_conf/route_rule.data server_data_conf/cluster_conf.data /reload/server_data_conf balancing cluster_conf/cluster_table.data cluster_conf/gslb.data /reload/gslb_data_conf name conf server_data_conf/name_conf.data /reload/name_conf TLS rule tls_conf/server_cert_conf.data tls_conf/tls_rule_conf.data /reload/tls_conf TLS session ticket key tls_conf/session_ticket_key.data /reload/tls_session_ticket_key Module Module Default configuration file Reload API mod_auth_basic mod_auth_basic/auth_basic_rule.data /reload/mod_auth_basic mod_block mod_block/block_rules.data mod_block/ip_blacklist.data /reload/mod_block.product_rule_table /reload/mod_block.global_ip_table mod_compress mod_compress/compress_rule.data /reload/mod_compress mod_errors mod_errors/errors_rule.data /reload/mod_errors mod_geo mod_geo/geo.db /reload/mod_geo mod_header mod_header/header_rule.data /reload/mod_header mod_redirect mod_redirect/redirect.data /reload/mod_redirect mod_rewrite mod_rewrite/rewrite.data /reload/mod_rewrite mod_static mod_static/static_rule.data mod_static/mime_type.data /reload/mod_static /reload/mod_static.mime_type mod_trust_clientip mod_trust_clientip/trust_client_ip.data /reload/mod_trust_clientip","title":"Configuration reload"},{"location":"operation/reload/#configuration-reload","text":"BFE has built-in feature of configuration hot-reload. A new configuration file can be reload by sending a reload request.","title":"Configuration Reload"},{"location":"operation/reload/#configure-monitor-port","text":"Set MonitorPort in BFE core configuration file(conf/bfe.conf) [Server] MonitorPort = 8421","title":"Configure monitor port"},{"location":"operation/reload/#how-to-reload","text":"Reload APIs only allows to be accessed using localhost\uff08127.0.0.1/::1\uff09and only supports GET requests # reload routing configurations $ curl http://localhost:8421/reload/server_data_conf The complete list of reload APIs can be viewed at http://localhost:8421/reload","title":"How to reload"},{"location":"operation/reload/#reload-apis","text":"","title":"Reload APIs"},{"location":"operation/reload/#basic-function","text":"Function Default configuration file Reload API routing server_data_conf/host_rule.data server_data_conf/vip_rule.data server_data_conf/route_rule.data server_data_conf/cluster_conf.data /reload/server_data_conf balancing cluster_conf/cluster_table.data cluster_conf/gslb.data /reload/gslb_data_conf name conf server_data_conf/name_conf.data /reload/name_conf TLS rule tls_conf/server_cert_conf.data tls_conf/tls_rule_conf.data /reload/tls_conf TLS session ticket key tls_conf/session_ticket_key.data /reload/tls_session_ticket_key","title":"Basic function"},{"location":"operation/reload/#module","text":"Module Default configuration file Reload API mod_auth_basic mod_auth_basic/auth_basic_rule.data /reload/mod_auth_basic mod_block mod_block/block_rules.data mod_block/ip_blacklist.data /reload/mod_block.product_rule_table /reload/mod_block.global_ip_table mod_compress mod_compress/compress_rule.data /reload/mod_compress mod_errors mod_errors/errors_rule.data /reload/mod_errors mod_geo mod_geo/geo.db /reload/mod_geo mod_header mod_header/header_rule.data /reload/mod_header mod_redirect mod_redirect/redirect.data /reload/mod_redirect mod_rewrite mod_rewrite/rewrite.data /reload/mod_rewrite mod_static mod_static/static_rule.data mod_static/mime_type.data /reload/mod_static /reload/mod_static.mime_type mod_trust_clientip mod_trust_clientip/trust_client_ip.data /reload/mod_trust_clientip","title":"Module"},{"location":"operation/signal/","text":"System signals SIGQUIT Gracefully shutdown the bfe process. SIGTERM Forcefully exits the bfe process directly.","title":"System signals"},{"location":"operation/signal/#system-signals","text":"","title":"System signals"},{"location":"operation/signal/#sigquit","text":"Gracefully shutdown the bfe process.","title":"SIGQUIT"},{"location":"operation/signal/#sigterm","text":"Forcefully exits the bfe process directly.","title":"SIGTERM"}]}